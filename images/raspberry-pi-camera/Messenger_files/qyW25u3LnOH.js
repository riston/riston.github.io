if (self.CavalryLogger) { CavalryLogger.start_js(["8smNw"]); }

__d("SidebarType",[],(function a(b,c,d,e,f,g){f.exports={SIDEBAR:"sidebar",BUDDYLIST:"buddylist",BUDDYLIST_NUB:"buddylist_nub"};}),null);
__d("WorkUserAvailabilityStatusType",[],(function a(b,c,d,e,f,g){f.exports={NONE:"None",AVAILABLE:"Available",SPORADIC:"Sporadic",TENTATIVE:"Tentative",BUSY:"Busy",DO_NOT_DISTURB:"Do Not Disturb",FOCUS:"Focus"};}),null);
__d('ChatproxyPresence',['Arbiter','AvailableListConstants','AvailableListInitialData','BanzaiODS','ChannelConstants','LastActiveTimes','PresenceStatus','debounceAcrossTransitions','ClientChromeExperimentsData'],(function a(b,c,d,e,f,g){var h=c('ClientChromeExperimentsData').ClientChromeAvailableListInitialDataPreloader;function i(k){var l=k.activeList,m=k.lastActiveTimes;if(l)c('PresenceStatus').setMultiActive(l,'available_list_active');if(m&&!Array.isArray(m))c('LastActiveTimes').update(m);}function j(k){'use strict';this.$ChatproxyPresence1=k;this.$ChatproxyPresence2=false;this.$ChatproxyPresence3=c('AvailableListInitialData').chatNotif;this.$ChatproxyPresence4=false;if(h){h.onLoaded(i);}else i(c('AvailableListInitialData'));}j.prototype.subscribe=function(){'use strict';c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('chatproxy-presence'),this.updatePresenceInfo.bind(this));c('Arbiter').subscribe(c('ChannelConstants').ON_INVALID_HISTORY,function(){this.$ChatproxyPresence2=true;}.bind(this));c('Arbiter').subscribe(c('ChannelConstants').RTI_SESSION,function(k,l){if(l)this.$ChatproxyPresence4=l;}.bind(this));c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('get_debug_presence'),function(k,l){var m=c('PresenceStatus').getAllDebugInfo(),n=c('LastActiveTimes').getDebugData();for(var o in n){var p=m[o];if(p===undefined){p={};m[o]=p;}p.l=Math.floor(n[o]);}this.$ChatproxyPresence4.issueRequest('/debug_presence',{},m,function(){c('BanzaiODS').bumpEntityKey('ChatproxyPresence','debug_presence.sucess');});}.bind(this));};j.prototype.getRTISession=function(){'use strict';return this.$ChatproxyPresence4;};j.prototype.updatePresenceInfo=function(k,l){'use strict';if(this.$ChatproxyPresence2){this.$ChatproxyPresence2=false;c('PresenceStatus').resetPresenceData();}l=l.obj;var m=l.buddyList;c('PresenceStatus').setMultiChatproxy(m);var n=false;if(l.chatNotif!==undefined)n=this.$ChatproxyPresence3!==l.chatNotif;if(n)this.$ChatproxyPresence3=l.chatNotif;if(l.gamers)c('PresenceStatus').setPlayingCanvasGameFriends(l.gamers);if(n)this.$ChatproxyPresence1(c('AvailableListConstants').ON_CHAT_NOTIFICATION_CHANGED,this.$ChatproxyPresence3);c('debounceAcrossTransitions')(function(){this.$ChatproxyPresence1(c('AvailableListConstants').ON_AVAILABILITY_CHANGED);}.bind(this),0)();};j.prototype.getWebChatNotification=function(){'use strict';return this.$ChatproxyPresence3;};f.exports=j;}),null);
__d("TypingStates",[],(function a(b,c,d,e,f,g){var h={INACTIVE:0,TYPING:1,QUITTING:2};f.exports=h;}),null);
__d('AvailableList',['Arbiter','ArbiterMixin','AsyncRequest','AvailableListConstants','BanzaiODS','Bootloader','ChannelConstants','ChatConfig','ChatDispatcher','ChatproxyPresence','ChatReliabilityInstrumentation','ChatVisibility','CurrentUser','FBID','ErrorUtils','JSLogger','LastActiveTimes','PresencePrivacy','PresenceStatus','PresenceStatusActionTypes','Run','ServerTime','TypingStates','debounceAcrossTransitions','emptyFunction','requireWeak'],(function a(b,c,d,e,f,g){'use strict';c('BanzaiODS').setEntitySample('presence',.0001);var h=babelHelpers['extends']({},c('AvailableListConstants'),c('ArbiterMixin')),i=/\D/;h.subscribe([c('AvailableListConstants').ON_AVAILABILITY_CHANGED,c('AvailableListConstants').ON_UPDATE_ERROR],function(p,q){c('Arbiter').inform(p,q);});c('PresenceStatus').subscribe('change',c('debounceAcrossTransitions')(function(){h.inform(c('AvailableListConstants').ON_AVAILABILITY_CHANGED);},0));var j=c('debounceAcrossTransitions')(function(){h.inform(c('AvailableListConstants').ON_AVAILABILITY_CHANGED);c('ChatDispatcher').dispatch({type:c('PresenceStatusActionTypes').AVAILABILITY_CHANGED});},0);function k(p,q,r,s,t){if(p===c('CurrentUser').getID())return;var u=c('PresenceStatus').set(p,q,r,s,t);if(u){var v=c('debounceAcrossTransitions')(function(){h.inform(c('AvailableListConstants').ON_AVAILABILITY_CHANGED,p);c('ChatDispatcher').dispatch({type:c('PresenceStatusActionTypes').AVAILABILITY_CHANGED,id:p});},0);v();}}function l(p){var q=p.payload.availability||{};for(var r in q)k(r&&r.toString(),q[r].a,true,'mercury_tabs',q[r].c);}function m(p){if(!p||i.test(p)){c('ChatReliabilityInstrumentation').logERROR('bad id for available list: '+p);return;}new (c('AsyncRequest'))('/ajax/mercury/tabs_presence.php').setData({target_id:p}).setHandler(l).setErrorHandler(c('emptyFunction')).setAllowCrossPageTransition(true).send();}function n(p,q){q.chat_config=c('ChatConfig').getDebugInfo();q.available_list_debug_info={count:c('PresenceStatus').getOnlineIDs().length};}var o=undefined;try{o=new (c('ChatproxyPresence'))(function(event){h.inform(event);});o.subscribe();}catch(p){c('ErrorUtils').reportError&&c('ErrorUtils').reportError(p,false);c('ChatReliabilityInstrumentation').logERROR(p.getMessage());}Object.assign(h,{getChatproxyPresenceObject:function p(){return o;},get:function p(q){return c('PresenceStatus').get(q);},updateForID:function p(q){if(c('ChatConfig').get('presence_page_green_dot_sub')&&!c('FBID').isUser(q))return;m(q);if(c('PresencePrivacy').getVisibility()==c('PresencePrivacy').ONLINE)c('Run').onAfterLoad(function(){return c('Bootloader').loadModules(["ChannelManager","ChannelTransport"],function(r,s){r.startChannelManager();s.sendAdditionalBuddyRequest(r.getCompleteConfig(),q);},'AvailableList');});},getWebChatNotification:function p(){return o&&o.getWebChatNotification();},isReady:function p(){return !!o;},set:function p(q,r,s,t){k(q,r,true,s,t);}});c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,n);c('PresencePrivacy').subscribe(['privacy-changed','privacy-availability-changed','privacy-user-presence-response'],j);c('requireWeak')('ChannelConnection',function(p){return p.subscribe([p.CONNECTED,p.RECONNECTING,p.SHUTDOWN,p.MUTE_WARNING,p.UNMUTE_WARNING],j);});c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('buddylist_overlay'),function(p,q){var r={},s=q.obj.overlay;for(var t in s){h.set(t,s[t].a,s[t].s||'channel',s[t].vc);if(s[t].la)r[t]=s[t].la;}c('LastActiveTimes').update(r);});c('Arbiter').subscribe([c('ChannelConstants').getArbiterType('typ'),c('ChannelConstants').getArbiterType('ttyp')],function(p,q){var r=q.obj;if(r.st===c('TypingStates').TYPING){var s=r.from;if(c('ChatVisibility').isOnline()){c('BanzaiODS').bumpEntityKey('presence','stale_presence_check_typing');var t=c('PresenceStatus').get(s);if(t!=c('AvailableListConstants').ACTIVE){var u=c('LastActiveTimes').get(s)*1000,v=c('ServerTime').get();if(!u){c('BanzaiODS').bumpEntityKey('presence','no_detailed_presence_typing');}else if(v-u>5*60*1000){var w='stale_presence_typing',x=v-u;if(x<10*60*1000){w+='600';}else if(x<60*60*1000)w+='3600';c('BanzaiODS').bumpEntityKey('presence',w);}}}h.set(s&&s.toString(),c('AvailableListConstants').ACTIVE,'channel-typing');}});c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('messaging'),function(p,q){if(!c('ChatVisibility').isOnline())return;var r=q.obj;if(r.message&&r.message.timestamp&&r.message.sender_fbid){var s=c('ServerTime').get(),t=r.message.timestamp;if(s-t<2*60*1000){c('BanzaiODS').bumpEntityKey('presence','stale_presence_check');var u=r.message.sender_fbid,v=c('PresenceStatus').get(u);if(v==c('AvailableListConstants').ACTIVE)return;var w=c('LastActiveTimes').get(u)*1000;if(!w){c('BanzaiODS').bumpEntityKey('presence','no_detailed_presence');}else if(t-w>5*60*1000){var x='stale_presence',y=t-w;if(y<10*60*1000){x+='600';}else if(y<60*60*1000)x+='3600';c('BanzaiODS').bumpEntityKey('presence',x);}}}});f.exports=h;}),null);
__d('ChatSidebarActionTypes',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';f.exports=c('keyMirror')({INIT:null,LOADED:null,SET_ENABLED:null,SHOW:null});}),null);
__d("ChatSidebarHideReason",[],(function a(b,c,d,e,f,g){var h={VIEWPORT_INCAPABLE:0,LOW_FRIEND_COUNT:1,NOT_ENABLED:2};f.exports=h;}),null);
__d('ChatSidebarStore',['ChatDispatcher','ChatOptionsInitialData','ChatSidebarActionTypes','FluxStore','SidebarType','performanceAbsoluteNow'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;function j(){i.constructor.call(this,c('ChatDispatcher'));this.$ChatSidebarStore2={initialized:false,initTime:c('performanceAbsoluteNow')(),loaded:false,enabled:!!c('ChatOptionsInitialData').sidebar_mode,visible:null};this.$ChatSidebarStore1={};}j.prototype.__onDispatch=function(k){var l=k.type;this.$ChatSidebarStore1=babelHelpers['extends']({},this.$ChatSidebarStore2);switch(l){case c('ChatSidebarActionTypes').INIT:if(!this.$ChatSidebarStore1.initialized)this.$ChatSidebarStore2.initTime=c('performanceAbsoluteNow')();this.$ChatSidebarStore2.initialized=true;break;case c('ChatSidebarActionTypes').LOADED:this.$ChatSidebarStore2.loaded=true;break;case c('ChatSidebarActionTypes').SHOW:this.$ChatSidebarStore2.visible=k.sidebarType;break;case c('ChatSidebarActionTypes').SET_ENABLED:this.$ChatSidebarStore2.enabled=k.enabled;this.$ChatSidebarStore2.visible=k.sidebarType;break;}for(var m in this.$ChatSidebarStore2)if(Object.prototype.hasOwnProperty.call(this.$ChatSidebarStore2,m))if(this.$ChatSidebarStore2[m]!==this.$ChatSidebarStore1[m]){this.__emitChange();break;}};j.prototype.getPrevState=function(){return this.$ChatSidebarStore1;};j.prototype.getState=function(){return this.$ChatSidebarStore2;};j.prototype.isInitialized=function(){return this.$ChatSidebarStore2.initialized;};j.prototype.isLoaded=function(){return this.$ChatSidebarStore2.loaded;};j.prototype.isEnabled=function(){return this.$ChatSidebarStore2.enabled;};j.prototype.getInitTime=function(){return this.$ChatSidebarStore2.initTime;};j.prototype.getVisibleType=function(){return this.$ChatSidebarStore2.visible;};f.exports=new j();}),null);
__d('ChatProfileStore',['ChatSidebarPreloadStore'],(function a(b,c,d,e,f,g){'use strict';var h={},i={init:function j(){c('ChatSidebarPreloadStore').onLoaded(function(k){var l=k.profiles,m=k.nearby;return l.filter(function(n){return !m||m.indexOf(n.id)===-1;}).forEach(function(n){var o=new Date(),p=n.birthdate&&o.getDate()===n.birthdate.day&&o.getMonth()+1===n.birthdate.month,q=n.profile_picture&&n.profile_picture.uri?n.profile_picture.uri:null;h[n.id]={id:n.id,is_birthday:p,thumbSrc:q,name:n.name,is_messenger_only:!!n.is_messenger_only};});});},get:function j(k){return h[k];}};f.exports=i;}),null);
__d('OrderedFriendsList',['AvailableListConstants','ChatProfileStore','ChatSidebarPreloadStore','MercuryIDs','PresenceStatus','SearchableEntry','ShortProfiles','WorkModeConfig','createArrayFromMixed','isValidUniqueID'],(function a(b,c,d,e,f,g){'use strict';var h=null,i={},j=[],k={};function l(r){r=String(r);return c('MercuryIDs').isValid(r)?r:c('MercuryIDs').getParticipantIDFromUserID(r);}function m(r,s){var t=c('createArrayFromMixed')(r);s(t.filter(function(u){var v=c('ShortProfiles').getNow(u);return !v||p(v)||v.is_nonfriend_messenger_contact;}));}function n(r){h=[];var s=0;r.forEach(function(t){var u=t.slice(0,-2),v=t.slice(-1);if(c('PresenceStatus').get(u)==v){h[s]=u;i[u]=s++;}});}function o(r){var s=0;r.forEach(function(t){var u=t.slice(0,-2),v=t.slice(-1);if(v==c('AvailableListConstants').ACTIVE){j[s]=u;k[u]=s++;}});}function p(r){return r.type==='friend'||c('WorkModeConfig').is_work_user&&r.type==='fb4c';}var q={contains:function r(s){return s in i;},getList:function r(s){if(h&&h.length){m(h,s);return;}c('ChatSidebarPreloadStore').onLoaded(function(t){var u=t.buddies;n(u);m(h,s);});},getSearchableEntries:function r(s,t){q.getList(function(u){c('ChatSidebarPreloadStore').onLoaded(function(v){var w=v.groups;c('ShortProfiles').getMulti(u.slice(0,s),function(x){var y=[];for(var z in x)y.push(q.normalizeProfileEntry(x[z],z));var aa=w.map(q.normalizeThreadEntry);t(y.concat(aa).filter(function(ba){return !!ba;}).sort(function(ba,ca){return ba.getOrder()-ca.getOrder();}));});});});},normalizeProfileEntry:function r(s,t){var u=s.searchTokens||[],v=s.name,w=null;return new (c('SearchableEntry'))({uniqueID:s.id||t,keywordString:u.join(' '),order:q.getRank(s.id||t),photo:s.thumbSrc,title:v,subtitle:w,type:s.type,uri:s.uri,auxiliaryData:{isMessengerUser:s.is_messenger_user}});},normalizeThreadEntry:function r(s,t){var u=s.mercury_thread,v=s.participants_to_render.map(function(aa){return babelHelpers['extends']({},aa,{id:l(aa.id)});});u.participants=u.participants.map(l);var w=s.text,x=null;if(!w)w=u.name;var y=v.map(function(aa){return aa.name;}).join(', ');if(!w){w=y;}else x=y;var z=s.uid;if(!w||!c('isValidUniqueID')(z))return null;return new (c('SearchableEntry'))({uniqueID:z,order:t,photo:u.image_src,title:w,subtitle:x,type:'thread',auxiliaryData:{participantsToRender:v,thread:u}});},getRank:function r(s){if(s in i)return i[s];return h?h.length:0;},getActiveList:function r(s){if(j.length>0){s(j);return;}q.getList(function(t){return s(t);});},getActiveRank:function r(s){return s in k?k[s]:q.getRank(s);}};(function(){c('ChatSidebarPreloadStore').onLoaded(function(r){var s=r.buddies,t=r.shortProfiles;c('ShortProfiles').setMulti(t);o(s);n(s);});c('ChatProfileStore').init();})();f.exports=q;}),null);
__d('ChatSidebarVisibility',['ChatConfig','ChatSidebarHideReason','ChatSidebarStore','OrderedFriendsList','SidebarType','getViewportDimensions'],(function a(b,c,d,e,f,g){'use strict';var h=c('ChatConfig').get('sidebar.min_friends'),i=c('ChatConfig').get('sidebar.minimum_width'),j={getViewport:function k(){return c('getViewportDimensions').withoutScrollbars();},shouldShowSidebar:function k(l,m){j.shouldShowSidebarIgnoreEnabled(l,function(n,o){var p=c('ChatSidebarStore').isEnabled();m(n&&p,p?o:o.concat([c('ChatSidebarHideReason').NOT_ENABLED]));});},shouldShowSidebarIgnoreEnabled:function k(l,m){c('OrderedFriendsList').getActiveList(function(n){var o=l||j.getViewport(),p=o.width>i,q=n.length<h,r=true,s=[];if(!p){r=false;s.push(c('ChatSidebarHideReason').VIEWPORT_INCAPABLE);}if(q){r=false;s.push(c('ChatSidebarHideReason').LOW_FRIEND_COUNT);}m(r,s);});},isSidebarVisible:function k(){return c('ChatSidebarStore').getVisibleType()===c('SidebarType').SIDEBAR;},isBuddyListVisible:function k(){return c('ChatSidebarStore').getVisibleType()===c('SidebarType').BUDDYLIST;}};f.exports=j;}),null);
__d('ChatSidebarActions',['ChatDispatcher','ChatSidebarActionTypes','ChatSidebarVisibility','SidebarType'],(function a(b,c,d,e,f,g){'use strict';var h={init:function i(){c('ChatDispatcher').dispatch({type:c('ChatSidebarActionTypes').INIT});},loaded:function i(){c('ChatDispatcher').dispatch({type:c('ChatSidebarActionTypes').LOADED});},disable:function i(){c('ChatDispatcher').dispatch({type:c('ChatSidebarActionTypes').SET_ENABLED,enabled:false,sidebarType:c('SidebarType').BUDDYLIST});},enable:function i(j){c('ChatDispatcher').dispatch({type:c('ChatSidebarActionTypes').SET_ENABLED,enabled:true,sidebarType:j});},show:function i(j){c('ChatDispatcher').dispatch({type:c('ChatSidebarActionTypes').SHOW,sidebarType:j});}};f.exports=h;}),null);
__d('ChatOptions',['Arbiter','ChannelConstants','ChatSidebarActions','ChatSidebarVisibility','FBRTCCallBlockingStore','JSLogger','PresenceUtil','SidebarType','ChatOptionsInitialData'],(function a(b,c,d,e,f,g){var h=c('JSLogger').create('chat_options'),i={};(function(){var k=c('ChatOptionsInitialData');for(var l in k){var m=k[l];if(l==='call_blocked_until'){c('FBRTCCallBlockingStore').init(m);}else i[l]=!!m;}})();var j=Object.assign(new (c('Arbiter'))(),{getSetting:function k(l){return i[l];},setSetting:function k(l,m,n){if(l==='sidebar_mode'){c('ChatSidebarVisibility').shouldShowSidebarIgnoreEnabled(null,function(o,p){if(m){c('ChatSidebarActions').enable(o?c('SidebarType').SIDEBAR:c('SidebarType').BUDDYLIST);}else c('ChatSidebarActions').disable();});return;}if(this.getSetting(l)==m)return;if(n){n='from_'+n;h.log(n,{name:l,new_value:m,old_value:this.getSetting(l)});}i[l]=!!m;c('Arbiter').inform('chat/option-changed',{name:l,value:m});}});c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('setting'),function(k,l){var m=l.obj;if(m.window_id===c('PresenceUtil').getSessionID())return;j.setSetting(m.setting,!!m.value,'channel');});c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(k,l){l.chat_options=i;});f.exports=j;}),null);
__d('ChatActivity',['Arbiter','Event','JSLogger','MercuryConfig','PresenceState','UserActivity'],(function a(b,c,d,e,f,g){var h=c('MercuryConfig').activity_limit||60000,i=c('MercuryConfig').idle_limit||1800000,j=c('MercuryConfig').idle_poll_interval||300000,k=c('JSLogger').create('chat_activity'),l=Date.now(),m=true;function n(){var r=Date.now();return !!(m&&r-l<h);}var o=Object.assign(new (c('Arbiter'))(),{isActive:n});function p(){var r=l;l=Date.now();if(l-r>i){k.debug('idle_to_active',r);c('PresenceState').doSync();}o.inform('activity');}c('Event').listen(window,'focus',function(){m=true;p();});c('Event').listen(window,'blur',function(){m=false;});c('UserActivity').subscribe(function(){p();});function q(r){var s=r&&r.at&&c('PresenceState').verifyNumber(r.at);if(typeof s!=='number')s=null;return s||0;}setInterval(function(){var r=Date.now(),s=q(c('PresenceState').get()),t=Math.max(l,s);if(r-t>i){k.debug('idle',{cookie:s,local:l});o.inform('idle',r-t);}},j);c('PresenceState').registerStateStorer(function(r){var s=q(r);if(s<l)r.at=l;return r;});c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(r,s){s.chat_activity={activity_limit:h,idle_limit:i,idle_poll_interval:j,last_active_time:l};});f.exports=o;}),null);
__d('MercuryTimestampTracker',['MercuryActionType','MercuryDispatcher','MercuryPayloadSource','MercurySingletonProvider'],(function a(b,c,d,e,f,g){'use strict';h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};function h(j){this.$MercuryTimestampTracker1=j;this.$MercuryTimestampTracker3=0;this.$MercuryTimestampTracker2=c('MercuryDispatcher').getForFBID(this.$MercuryTimestampTracker1);this.$MercuryTimestampTracker2.subscribe('update-messages',this.$MercuryTimestampTracker4.bind(this));}h.prototype.$MercuryTimestampTracker4=function(j,k){if(!k.actions||!k.actions.length)return;if(k.payload_source===c('MercuryPayloadSource').CLIENT_SEND_MESSAGE||k.payload_source===c('MercuryPayloadSource').UNKNOWN)return;for(var l=0;l<k.actions.length;l++){var m=k.actions[l],n=m.action_type;if(n==c('MercuryActionType').USER_GENERATED_MESSAGE&&m.thread_id&&m.timestamp>this.$MercuryTimestampTracker3)this.$MercuryTimestampTracker3=m.timestamp;}};h.prototype.getLastUserMessageTimestamp=function(){return this.$MercuryTimestampTracker3;};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('ChatTitleBarBlinker',['ChatActivity','DocumentTitle','JSLogger','MercuryThreadInformer','MercuryNotificationRenderer','PresenceState','MercuryTimestampTracker'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadInformer').get(),i=c('MercuryTimestampTracker').get(),j=c('JSLogger').create('chat_title'),k=null,l=0,m=false;function n(){if(k){k.stop();k=null;return true;}return false;}function o(u){var v=u||i.getLastUserMessageTimestamp();if(l<=v){l=v;if(n()||m)c('PresenceState').doSync();}}var p={blink:function u(v,w){if(!k&&l<w)c('MercuryNotificationRenderer').renderDocumentTitle(v,function(x){if(!k)k=c('DocumentTitle').blink(x);});},stopBlinking:function u(){o();},blinkingElsewhere:function u(){m=true;}};function q(u){var v=c('PresenceState').verifyNumber(u.sb2);if(!v||v<=l)return null;return v;}function r(u){var v=u&&q(u);if(v){l=v;j.debug('load',l);n();m=false;}}function s(u){var v=q(u);if(!v){j.debug('store',l);u.sb2=l;m=false;}return u;}c('PresenceState').registerStateStorer(s);c('PresenceState').registerStateLoader(r);h.subscribe('thread-read-changed',function(u,v){var w=i.getLastUserMessageTimestamp(),x=0;for(var y in v)if(v[y].mark_as_read&&v[y].timestamp>=w&&v[y].timestamp>x)x=v[y].timestamp;x&&o(x);});c('ChatActivity').subscribe('activity',function(){return o();});var t=c('PresenceState').getInitial();if(t)l=q(t)||0;f.exports=p;}),null);
__d('MercuryBrowserAlerts',['ArbiterMixin','ChatActivity','ChatConfig','ChatOptions','ChatTitleBarBlinker','Event','Map','mercuryBlockedParticipantsRe','MercuryIDs','MercuryThreadInfo','MercuryThreads','MercuryViewer','MessagingTag','Sound','UserActivity'],(function a(b,c,d,e,f,g){'use strict';var h=c('mercuryBlockedParticipantsRe').get(),i=c('MercuryThreads').get(),j=3,k=600000,l=new (c('Map'))(),m=0;function n(){return !c('UserActivity').isOnTab()&&!c('UserActivity').hasBeenInactive();}function o(){l=new (c('Map'))();}function p(r){if(c('ChatOptions').getSetting('sound')&&!n())c('Sound').play([c('ChatConfig').get('sound.notif_ogg_url'),c('ChatConfig').get('sound.notif_mp3_url')],r,false);}var q=Object.assign({init:function r(){c('Event').listen(window,'focus',function(){o();clearInterval(m);});c('Event').listen(window,'blur',function(){m=setInterval(o,k);});},messageReceived:function r(s){if(s.author&&c('MercuryViewer').isViewer(s.author)||!s.is_unread||s.folder!=c('MessagingTag').INBOX&&s.folder!=c('MessagingTag').ARCHIVED)return;var t=s.thread_id,u=c('ChatActivity').isActive();if(u){var v=false;q.inform('before-alert',{threadID:t,cancelAlert:function w(){v=true;}});}i.getThreadMeta(t,function(w){var x=c('MercuryThreadInfo').isMuted(w),y=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID());if(x)if(!c('MercuryThreadInfo').areMentionsMuted(w)){if(!s.profile_ranges||!s.profile_ranges.some||!s.profile_ranges.some(function(ba){return ba.id===y;}))return;}else return;if(h.isPresentInGroupThread(w))return;var z=s.timestamp;if(u){!v&&p(z);}else{c('ChatTitleBarBlinker').blink(t,z);var aa=l.get(t)||0;if(aa<j){l.set(t,aa+1);p(z);}}c('ChatTitleBarBlinker').blinkingElsewhere();});}},c('ArbiterMixin'));f.exports=q;}),null);
__d('ChatEmployeeAwayWarning',['MercuryIDs','MercuryParticipants','MercuryViewer'],(function a(b,c,d,e,f,g){var h={updateEmployeeAwayWarning:function i(j,k,l){c('MercuryParticipants').get(c('MercuryViewer').getID(),function(m){var n=m.employee;if(n)c('MercuryParticipants').getMulti(j.participants,function(o){var p=false,q=c('MercuryIDs').getUserIDFromThreadID(j.thread_id);if(!q)return;var r='fbid:'+q;for(var s in o)if(r==o[s].id&&o[s].is_employee_away)p=true;if(p){k();}else l();});});}};f.exports=h;}),null);
__d('ChatPrivacyActionController',['ChatVisibility','JSLogger','PresencePrivacy'],(function a(b,c,d,e,f,g){var h=function i(j,k){this._userID=j;this._logger=c('JSLogger').create('blackbird');this._getState=function(){if(c('ChatVisibility').isOnline())return c('PresencePrivacy').allows(this._userID)?i.NORMAL:i.BLOCKED;return i.OFFLINE;};this._togglePrivacy=function(){var m=this._getState();switch(this._getState()){case i.OFFLINE:if(c('ChatVisibility').isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});c('ChatVisibility').goOnline(function(){if(!c('PresencePrivacy').allows(this._userID)){if(this._getState()!==i.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case i.BLOCKED:c('PresencePrivacy').allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case i.NORMAL:c('PresencePrivacy').disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};var l=function(){k&&k(this._getState());}.bind(this);l();this._subscribeToken=c('PresencePrivacy').subscribe('privacy-changed',l);};h.OFFLINE='offline';h.BLOCKED='blocked';h.NORMAL='normal';Object.assign(h.prototype,{togglePrivacy:function i(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function i(){this._subscribeToken&&c('PresencePrivacy').unsubscribe(this._subscribeToken);}});f.exports=h;}),null);
__d('ChatTimezoneWarning',['MercuryParticipants','MercuryViewer','MessengerBotIDs'],(function a(b,c,d,e,f,g){'use strict';var h=1,i={updateUserTimezoneWarning:function j(k,l,m){c('MercuryParticipants').get(c('MercuryViewer').getID(),function(n){var o=n.employee,p=n.timezone,q=0;if(k.timezone_warning_dismiss_count!==undefined){var r=k.timezone_warning_dismiss_count;for(var s=Object.entries(r),t=Array.isArray(s),u=0,s=t?s:s[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var v;if(t){if(u>=s.length)break;v=s[u++];}else{u=s.next();if(u.done)break;v=u.value;}var w=v,x=w[0],y=w[1];if(x===n.fbid)q=Number(y);}}else return;if(o&&p&&q<h)c('MercuryParticipants').getMulti(k.participants,function(z){var aa={},ba=true;for(var ca in z){ba=ba&&z[ca].employee;var da=!!c('MessengerBotIDs')[z[ca].fbid];if(z[ca].timezone!==undefined&&z[ca].timezone!==null&&p!==z[ca].timezone&&!da){var ea=z[ca].fbid;aa[ea]=z[ca];}}if(Object.keys(aa).length>0&&ba){aa.self=n;l(aa);}else m();});});}};f.exports=i;}),null);
__d('ChatUserFocusWarning',['MercuryParticipants','MercuryViewer','emptyFunction','ifRequired'],(function a(b,c,d,e,f,g){'use strict';var h=void 0,i=void 0,j=function m(n){if(!h)c('ifRequired')('ChatUserFocusLogging',function(o){return h=o;},c('emptyFunction'));if(h&&h.registerThreadID)h.registerThreadID(n);},k=function m(n,o,p){if(!i)c('ifRequired')('ChatSubscribeToFocusModeChanges',function(q){i=q;},c('emptyFunction'));if(i&&i.subscribe)i.subscribe(n,o,p);},l={updateUserFocusWarning:function m(n,o,p){c('MercuryParticipants').get(c('MercuryViewer').getID(),function(q){var r=q.employee;if(r)c('MercuryParticipants').getMulti(n.participants,function(s){var t=false;for(var u in s){if(q.id!==s[u].id&&s[u].is_user_focusing)t=true;if(s[u].employee&&q.fbid)k(q.fbid,n.thread_id,s[u]);}if(t){j(n.thread_id);var v=n&&n.bypass_focus_mode_until&&n.bypass_focus_mode_until>Date.now()/1000;o(v);}else p();});});}};f.exports=l;}),null);
__d('WorkDualityDismissWarning',[],(function a(b,c,d,e,f,g){'use strict';var h={},i={};f.exports={isWarningAcknowledged:function j(k){if(h[k])return true;return false;},acknowledgeWarning:function j(k){h[k]=true;},isThreadHijacked:function j(k){if(i[k])return true;return false;},setHijackedThread:function j(k){i[k]=true;}};}),null);
__d('ChatUserPersonalUserWarning',['MercuryIDs','MercuryParticipants','MercuryViewer','MercuryEmployeeDualityPreferences','WorkDualityDismissWarning'],(function a(b,c,d,e,f,g){var h=1,i={updateEmployeePersonalUserWarning:function j(k,l,m){c('MercuryParticipants').get(c('MercuryViewer').getID(),function(n){var o=this._getFriendID(k,n);if(!o){m();return;}c('MercuryParticipants').getMulti(k.participants,function(p){var q=this._getParticipant(k,Object.values(p),o);if(q){l(n,q);}else m();}.bind(this));}.bind(this));},getEmployeePersonalUserWarning:function j(k){var l=c('MercuryParticipants').getNow(c('MercuryViewer').getID()),m=this._getFriendID(k,l),n=k.participants.map(function(p){return c('MercuryParticipants').getNow(p);}),o=this._getParticipant(k,n,m);return {myself:l,participant:o};},_getParticipant:function j(k,l,m){var n=null;l.forEach(function(o){if(o.personal_id&&m===o.personal_id&&o.work_id&&o.employee&&!c('WorkDualityDismissWarning').isWarningAcknowledged(k.thread_id))n=o;});return n;},_getFriendID:function j(k,l){var m=l.employee,n=null;if(l.personal_id)n='fbid:'+l.personal_id;var o=n===l.id,p=0;if(k.work_user_warning_dismiss_count!==undefined){var q=k.work_user_warning_dismiss_count;for(var r=Object.entries(q),s=Array.isArray(r),t=0,r=s?r:r[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var u;if(s){if(t>=r.length)break;u=r[t++];}else{t=r.next();if(t.done)break;u=t.value;}var v=u,w=v[0],x=v[1];if(w===l.fbid)p=Number(x);}}else return null;var y=c('MercuryIDs').getUserIDFromThreadID(k.thread_id);if(!m||!o||!y||k.participants.length>2||!c('MercuryEmployeeDualityPreferences').duality_warning_gk_check||p>=h)return null;return y;}};f.exports=i;}),null);
__d('ChatUserWorkUserWarning',['MercuryIDs','MercuryParticipants','MercuryViewer','MercuryEmployeeDualityPreferences','WorkDualityDismissWarning'],(function a(b,c,d,e,f,g){var h=1,i={updateEmployeeWorkUserWarning:function j(k,l,m){c('MercuryParticipants').get(c('MercuryViewer').getID(),function(n){var o=this._getFriendID(k,n);if(!o){m();return;}c('MercuryParticipants').getMulti(k.participants,function(p){var q=this._getParticipant(k,Object.values(p),o);if(q){l(n,q);}else m();}.bind(this));}.bind(this));},getEmployeeWorkUserWarning:function j(k){var l=c('MercuryParticipants').getNow(c('MercuryViewer').getID()),m=this._getFriendID(k,l),n=k.participants.map(function(p){return c('MercuryParticipants').getNow(p);}),o=this._getParticipant(k,n,m);return {myself:l,participant:o};},_getParticipant:function j(k,l,m){var n=null;l.forEach(function(o){if(o.work_id&&m===o.work_id.toString()&&o.personal_id&&c('WorkDualityDismissWarning').isThreadHijacked(k.thread_id)&&o.employee&&!o.is_friend)n=o;});return n;},_getFriendID:function j(k,l){var m=l.employee,n=null;if(l.personal_id)n='fbid:'+l.personal_id;var o=n===l.id,p=0;if(k.work_user_warning_dismiss_count!==undefined){var q=k.work_user_warning_dismiss_count;for(var r=Object.entries(q),s=Array.isArray(r),t=0,r=s?r:r[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var u;if(s){if(t>=r.length)break;u=r[t++];}else{t=r.next();if(t.done)break;u=t.value;}var v=u,w=v[0],x=v[1];if(w===l.fbid)p=Number(x);}}else return null;var y=c('MercuryIDs').getUserIDFromThreadID(k.thread_id);if(!m||!o||!y||k.participants.length>2||!c('MercuryEmployeeDualityPreferences').duality_warning_gk_check||p>=h)return null;return y;}};f.exports=i;}),null);
__d('FantaMessageActions',['Bootloader','FantaDispatcher','MercuryConfig','ifRequired','keyMirror','emptyFunction','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({CANCEL_FILE_UPLOAD:null,COMPOSER_TEXT_UPDATE:null,LINK_PREVIEW:null,LOADED_SHARE_DATA:null,LOADING_SHARE_DATA:null,PREPARE_FILES_FOR_SEND:null,RECEIVED_NEW_MESSAGE:null,REMOVE_SHARE_PREVIEW:null,SEND_GROUP_MESSAGE:null,SEND_HOT_LIKE:null,SEND_MESSAGE:null,SEND_PHOTO:null,SEND_STICKER:null,UPDATE_GROUP_NAME:null,UPLOAD_FILE_FAILED:null,UPLOADED_FILE:null});function i(){var l=document.createElement('form');l.action=c('MercuryConfig').upload_url;l.method='post';return l;}function j(l,m){var n=document.createElement('input');n.type='file';n.name='attachment[]';n.multiple=true;if(m)n.onchange=m;l.appendChild(n);return n;}var k={Types:h,prepareFilesForSend:function l(m,n){this.dispatchOrBootloadUploader(function(){c('FantaDispatcher').dispatch({type:h.PREPARE_FILES_FOR_SEND,tabID:m,files:n});});},openUploadFilePicker:function l(m){var n=i(),o=j(n,function(){k.prepareFilesForSend(m,this.files);});o.click();},uploadedFile:function l(m,n,o){this.dispatchOrBootloadUploader(function(){c('FantaDispatcher').dispatch({type:h.UPLOADED_FILE,tabID:m,uploadID:n,payload:o});});},uploadFileFailed:function l(m,n){this.dispatchOrBootloadUploader(function(){c('FantaDispatcher').dispatch({type:h.UPLOAD_FILE_FAILED,tabID:m,uploadID:n});});},cancelFileUpload:function l(m,n){this.dispatchOrBootloadUploader(function(){c('FantaDispatcher').dispatch({type:h.CANCEL_FILE_UPLOAD,tabID:m,uploadID:n});});},linkPreview:function l(m,n){this.dispatchOrBootloadSharePreview(function(){c('FantaDispatcher').dispatch({type:h.LINK_PREVIEW,tabID:m,uri:n});});},loadedShareData:function l(m,n){this.dispatchOrBootloadSharePreview(function(){c('FantaDispatcher').dispatch({type:h.LOADED_SHARE_DATA,tabID:m,attachmentData:n});});},loadingShareData:function l(m){this.dispatchOrBootloadSharePreview(function(){c('FantaDispatcher').dispatch({type:h.LOADING_SHARE_DATA,tabID:m});});},removeSharePreview:function l(m){this.dispatchOrBootloadSharePreview(function(){c('FantaDispatcher').dispatch({type:h.REMOVE_SHARE_PREVIEW,tabID:m});});},receivedNewMessage:function l(m,n){c('FantaDispatcher').dispatch({type:h.RECEIVED_NEW_MESSAGE,tabID:m,message:n});},updateGroupName:function l(m,n){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.UPDATE_GROUP_NAME,threadID:m,newName:n});});},sendGroupMessage:function l(m,n){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.SEND_GROUP_MESSAGE,threadID:m,onSendSuccess:n});});},sendMessage:function l(m,n,o){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.SEND_MESSAGE,threadID:m,message:n,onSendSuccess:o});});},sendPhoto:function l(m,n,o){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.SEND_PHOTO,onSendSuccess:o,photoData:n,threadID:m});});},sendHotLike:function l(m,n,o,p,q){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.SEND_HOT_LIKE,emoji:n,onSendSuccess:q,size:o,source:p,threadID:m});});},sendSticker:function l(m,n,o){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.SEND_STICKER,threadID:m,stickerID:n,onSendSuccess:o});});},composerTextUpdate:function l(m,n){if(n.length>0)c('ifRequired')('FantaReducersSendMessages',c('emptyFunction'),function(){return this.dispatchOrBootloadSendMessages(c('emptyFunction'));}.bind(this));this.dispatchOrBootloadSharePreview(function(){c('FantaDispatcher').dispatch({type:h.COMPOSER_TEXT_UPDATE,threadID:m,message:n});});},dispatchOrBootloadSendMessages:function l(m){c('ifRequired')('FantaReducersSendMessages',function(){c('setImmediate')(m);},function(){c('Bootloader').loadModules(["FantaAppStore","FantaReducersSendMessages"],function(n,o){n.addReducers(o);c('setImmediate')(m);},'FantaMessageActions');});},dispatchOrBootloadUploader:function l(m){c('ifRequired')('FantaReducersFileUploader',function(){m();},function(){c('Bootloader').loadModules(["FantaAppStore","FantaReducersFileUploader"],function(n,o){n.addReducers(o);m();},'FantaMessageActions');});},dispatchOrBootloadSharePreview:function l(m){c('ifRequired')('FantaReducersSharePreview',function(){m();},function(){c('Bootloader').loadModules(["FantaAppStore","FantaReducersSharePreview"],function(n,o){n.addReducers(o);m();},'FantaMessageActions');});}};f.exports=k;}),null);
__d('FantaReducersCookie',['FantaMessageActions','FantaTabActions'],(function a(b,c,d,e,f,g){'use strict';var h=c('FantaMessageActions').Types,i=c('FantaTabActions').Types;function j(m,n){switch(n.type){case h.RECEIVED_NEW_MESSAGE:case i.BLUR_TAB:case i.CLOSE_ALL_TABS:case i.CLOSE_AND_TAB_NEXT:case i.CLOSE_TAB:case i.DELETE_TAB:case i.FOCUS_TAB:case i.MINIMIZE_ALL_TABS:case i.MINIMIZE_TAB:case i.OPEN_TAB:case i.OPEN_TAB_WITH_INTERSTITIAL_DATA:case i.REPLACE_TAB:case i.UNMINIMIZE_TAB:return l(m);}return m;}function k(m,n){switch(n.type){case i.LOAD_FROM_DATA:return m.mergeIn(['tabGroup'],{updatedTime:n.tabData.updatedTime});}return m;}function l(m){return m.mergeIn(['tabGroup'],{updatedTime:Date.now()});}f.exports={updateCookie:j,loadFromData:k};}),null);
__d('FantaReducersDockCalculator',['Arbiter','FantaTabActions','FantaMessageActions','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('FantaTabActions').Types,i=c('FantaMessageActions').Types,j=null;function k(n){j=n;c('setImmediate')(function(){c('Arbiter').inform('FantaReducersDockCalculator/shouldRecalculate');});}function l(n){if(!j||n.size!==j.size){k(n);}else{var o=false;n.forEach(function(p){var q=j&&j.get(p.id);if(!q||p.isMinimized!==q.isMinimized)o=true;});if(o)k(n);}}function m(n,o){var p=n.tabGroup.tabs;switch(o.type){case h.CLOSE_ALL_TABS:case h.CLOSE_AND_TAB_NEXT:case h.CLOSE_TAB:case h.DELETE_TAB:case h.MINIMIZE_ALL_TABS:case h.MINIMIZE_TAB:case h.OPEN_TAB:case h.OPEN_TAB_WITH_INTERSTITIAL_DATA:case h.UNMINIMIZE_TAB:k(p);break;case h.LOAD_FROM_DATA:case i.RECEIVED_NEW_MESSAGE:l(p);break;}return n;}f.exports={recalculateDock:m};}),null);
__d('FantaAvailableStatus',['AvailableListConstants','ChatVisibility','MercuryIDs','PresenceStatus','ShortProfiles'],(function a(b,c,d,e,f,g){'use strict';f.exports={isAvailable:function h(i,j){var k=void 0,l=this.getStatus(i,j),m=c('MercuryIDs').getUserIDFromThreadID(j);if(m)k=c('ShortProfiles').getNow(m);return l===c('AvailableListConstants').ACTIVE&&(k===undefined||k===null||!k.is_messenger_only);},getStatus:function h(i,j){var k=c('AvailableListConstants').OFFLINE,l=c('MercuryIDs').getUserIDFromThreadID(j);if(l){k=c('PresenceStatus').get(l);}else if(i){var m=i.participants.map(function(n){return c('MercuryIDs').getUserIDFromParticipantID(n);});k=c('PresenceStatus').getGroup(m);}if(!c('ChatVisibility').isOnline())k=c('AvailableListConstants').OFFLINE;return k;}};}),null);
__d('MercuryCanonicalGroupThreadManager',['Bootloader','KeyedCallbackManager','MercuryIDs','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySingletonProvider','MercuryThreads','MercuryServerDispatcher','SubscriptionsHandler'],(function a(b,c,d,e,f,g){'use strict';function h(j){this.$MercuryCanonicalGroupThreadManager1=j;this.$MercuryCanonicalGroupThreadManager2=new (c('KeyedCallbackManager'))();this.$MercuryCanonicalGroupThreadManager3=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager6=c('MercuryThreads').getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager4={};this.$MercuryCanonicalGroupThreadManager8();this.$MercuryCanonicalGroupThreadManager9();this.$MercuryCanonicalGroupThreadManager7={};}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.getCanonicalGroupThreadIDForParticipants=function(j,k){j=this.$MercuryCanonicalGroupThreadManager10(j);var l=this.$MercuryCanonicalGroupThreadManager11(j),m=this.$MercuryCanonicalGroupThreadManager2.executeOrEnqueue(l,k);this.$MercuryCanonicalGroupThreadManager12(j);return m;};h.prototype.unsubscribe=function(j){if(j)this.$MercuryCanonicalGroupThreadManager2.unsubscribe(j);};h.prototype.$MercuryCanonicalGroupThreadManager11=function(j){return j.sort().join(',');};h.prototype.$MercuryCanonicalGroupThreadManager13=function(j,k){var l=c('MercuryIDs').getThreadIDFromThreadFBID(k);this.$MercuryCanonicalGroupThreadManager2.setResource(j,l);this.$MercuryCanonicalGroupThreadManager4[l]=j;};h.prototype.$MercuryCanonicalGroupThreadManager12=function(j){var k=this.$MercuryCanonicalGroupThreadManager11(j),l={canonical_group_key:k,participants:j};c('MercuryServerDispatcher').trySend('/ajax/mercury/search_canonical_groups.php',l,null,this.$MercuryCanonicalGroupThreadManager1);};h.prototype.$MercuryCanonicalGroupThreadManager8=function(){c('MercuryServerDispatcher').registerEndpoints({'/ajax/mercury/search_canonical_groups.php':{request_user_id:this.$MercuryCanonicalGroupThreadManager1,mode:c('MercuryServerDispatcher').IMMEDIATE,handler:function(j){this.handleUpdate(j);}.bind(this)}});};h.prototype.$MercuryCanonicalGroupThreadManager10=function(j){if(j.indexOf(this.$MercuryCanonicalGroupThreadManager1)===-1)j.push(this.$MercuryCanonicalGroupThreadManager1);return j;};h.prototype.handleUpdate=function(j){if(j.mercury_payload)this.$MercuryCanonicalGroupThreadManager3.handleUpdate(j.mercury_payload);var k=j.canonical_group;if(k)for(var l in k)this.$MercuryCanonicalGroupThreadManager13(l,k[l]);};h.prototype.getNow=function(j){var k=this.$MercuryCanonicalGroupThreadManager11(this.$MercuryCanonicalGroupThreadManager10(j));return this.$MercuryCanonicalGroupThreadManager2.getResource(k);};h.prototype.$MercuryCanonicalGroupThreadManager9=function(){c('Bootloader').loadModules(["MercuryThreadInformer"],function(j){var k=j.getForFBID(this.$MercuryCanonicalGroupThreadManager1),l=new (c('SubscriptionsHandler'))();l.addSubscriptions(k.subscribe('threads-deleted',function(m,n){for(var o in n)if(this.$MercuryCanonicalGroupThreadManager4[o]){this.$MercuryCanonicalGroupThreadManager2.setResource(this.$MercuryCanonicalGroupThreadManager4[o],undefined);delete this.$MercuryCanonicalGroupThreadManager4[o];}}.bind(this)));this.$MercuryCanonicalGroupThreadManager5=l;}.bind(this),'MercuryCanonicalGroupThreadManager');};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('FantaGetMessageActions',['FantaDispatcher','MercuryCanonicalGroupThreadManager','MercuryIDs','MercuryTypeaheadConstants','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({ADD_PARTICIPANTS:null,CLEAR_PARTICIPANTS:null,CLEAR_PREVIEW:null,FETCH_MORE_MESSAGES:null,ON_BOOTLOAD_TYPEAHEAD:null,ON_GET_THREAD_PREVIEW_RESPONSE:null,ON_GET_THREAD_RESPONSE:null,ON_MESSAGE_STORE_RESPONSE:null,ON_PAGE_NULL_RESPONSE:null,ON_PRIVACY_STATE_CHANGE:null,ON_SHOW_CONTEXT_BANNER_TIMER:null,REFRESH_THREAD:null,THREADS_UPDATED:null}),i={Types:h,addParticipants:function j(k,l){var m,n=l.length===1&&l[0].getInfo().render_type===c('MercuryTypeaheadConstants').THREAD_TYPE,o=void 0;if(n){var p=l[0].getInfo().mercury_thread;if(p)o=c('MercuryIDs').getThreadIDFromThreadFBID(p.thread_fbid);}else if(l.length===1){var q=l[0].info&&l[0].info.uid;if(q)o=c('MercuryIDs').getThreadIDFromUserID(q);}else if(l.length===0){c('FantaDispatcher').dispatch({type:h.CLEAR_PARTICIPANTS,tabID:k});return;}else (function(){var r=c('MercuryCanonicalGroupThreadManager').get(),s=l.map(function(u){return u.info.uid;});c('FantaDispatcher').dispatch({type:h.CLEAR_PREVIEW,tabID:k,tokens:l});var t=r.getCanonicalGroupThreadIDForParticipants(Array.from(s),function(u){r.unsubscribe(t);if(u)c('FantaDispatcher').dispatch({type:h.ADD_PARTICIPANTS,previewTabID:u,tabID:k,tokens:l});});})();if(o)c('FantaDispatcher').dispatch({type:h.ADD_PARTICIPANTS,previewTabID:o,tabID:k,tokens:l});},onBootloadTypeahead:function j(k,l){c('FantaDispatcher').dispatch({type:h.ON_BOOTLOAD_TYPEAHEAD,tabID:k,thread:l});},fetchMoreMessages:function j(k){c('FantaDispatcher').dispatch({type:h.FETCH_MORE_MESSAGES,threadID:k});},refreshThread:function j(k){c('FantaDispatcher').dispatch({type:h.REFRESH_THREAD,threadID:k});},onGetThreadResponse:function j(k){c('FantaDispatcher').dispatch({type:h.ON_GET_THREAD_RESPONSE,thread:k});},onGetThreadPreviewResponse:function j(k,l){c('FantaDispatcher').dispatch({type:h.ON_GET_THREAD_PREVIEW_RESPONSE,tabID:k,thread:l});},onShowContextBannerTimer:function j(k){c('FantaDispatcher').dispatch({type:h.ON_SHOW_CONTEXT_BANNER_TIMER,threadID:k});},onMessageStoreResponse:function j(k,l){c('FantaDispatcher').dispatch({type:h.ON_MESSAGE_STORE_RESPONSE,messages:k,tabID:l});},threadsUpdated:function j(k){c('FantaDispatcher').dispatch({type:h.THREADS_UPDATED,threads:k});},onPrivacyStateChange:function j(k,l){c('FantaDispatcher').dispatch({type:h.ON_PRIVACY_STATE_CHANGE,threadID:k,privacyState:l});},onPageNullResponse:function j(k,l,m){c('FantaDispatcher').dispatch({type:h.ON_PAGE_NULL_RESPONSE,threadID:k,nullPageTitle:l,nullPageID:m});}};f.exports=i;}),null);
__d('FantaTabSheetActions',['FantaDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({CLOSE_ADD_FRIENDS_SHEET:null,CLOSE_ADD_MORE_FRIENDS_SHEET:null,CLOSE_EMPLOYEE_PERSONAL_USER_SHEET:null,CLOSE_EMPLOYEE_WORK_USER_SHEET:null,CLOSE_NAME_CONVERSATION_TAB_SHEET:null,CLOSE_PAGE_INDICATOR_SHEET:null,CLOSE_READ_ONLY_PERMANENT_SHEET:null,CLOSE_READ_ONLY_SHEET:null,CLOSE_USER_FOCUS_AND_BYPASS_SHEET:null,CLOSE_USER_TIMEZONE_SHEET:null,ON_BOOTLOAD_EVENT_REMINDER:null,ON_IS_PAGE_TAB:null,OPEN_ADD_MORE_FRIENDS_SHEET:null,OPEN_APPOINTMENT_SHEET:null,OPEN_BYPASS_FOCUS_SHEET:null,OPEN_EMPLOYEE_AWAY_SHEET:null,OPEN_EMPLOYEE_PERSONAL_USER_SHEET:null,OPEN_EMPLOYEE_WORK_USER_SHEET:null,OPEN_NAME_CONVERSATION_TAB_SHEET:null,OPEN_PAGE_INDICATOR_SHEET:null,OPEN_READ_ONLY_PERMANENT_SHEET:null,OPEN_READ_ONLY_SHEET:null,OPEN_USER_FOCUS_SHEET:null,OPEN_USER_TIMEZONE_SHEET:null}),i={Types:h,openUserFocusSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_USER_FOCUS_SHEET,tabID:k});},openBypassFocusSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_BYPASS_FOCUS_SHEET,tabID:k});},closeUserFocusAndBypassSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_USER_FOCUS_AND_BYPASS_SHEET,tabID:k});},openUserTimezoneSheet:function j(k,l){c('FantaDispatcher').dispatch({type:h.OPEN_USER_TIMEZONE_SHEET,tabID:k,timezoneInfo:l});},closeUserTimezoneSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_USER_TIMEZONE_SHEET,tabID:k});},openAddMoreFriendsSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_ADD_MORE_FRIENDS_SHEET,tabID:k});},closeAddMoreFriendsSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_ADD_MORE_FRIENDS_SHEET,tabID:k});},closeAddFriendsSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_ADD_FRIENDS_SHEET,tabID:k});},openNameConversationSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_NAME_CONVERSATION_TAB_SHEET,tabID:k});},closeNameConversationSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_NAME_CONVERSATION_TAB_SHEET,tabID:k});},openReadOnlySheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_READ_ONLY_SHEET,tabID:k});},closeReadOnlySheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_READ_ONLY_SHEET,tabID:k});},openReadOnlyPermanentSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_READ_ONLY_PERMANENT_SHEET,tabID:k});},closeReadOnlyPermanentSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_READ_ONLY_PERMANENT_SHEET,tabID:k});},openEmployeeAwaySheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_EMPLOYEE_AWAY_SHEET,tabID:k});},openEmployeePersonalUserSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_EMPLOYEE_PERSONAL_USER_SHEET,tabID:k});},closeEmployeePersonalUserSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_EMPLOYEE_PERSONAL_USER_SHEET,tabID:k});},openEmployeeWorkUserSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_EMPLOYEE_WORK_USER_SHEET,tabID:k});},closeEmployeeWorkUserSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_EMPLOYEE_WORK_USER_SHEET,tabID:k});},openPageIndicatorSheet:function j(k,l){c('FantaDispatcher').dispatch({type:h.OPEN_PAGE_INDICATOR_SHEET,description:l,tabID:k});},closePageIndicatorSheet:function j(k){c('FantaDispatcher').dispatch({type:h.CLOSE_PAGE_INDICATOR_SHEET,tabID:k});},onIsPageTab:function j(k,l){c('FantaDispatcher').dispatch({type:h.ON_IS_PAGE_TAB,pageIndicator:l,tabID:k});},onBootloadEventReminder:function j(k){c('FantaDispatcher').dispatch({type:h.ON_BOOTLOAD_EVENT_REMINDER,tabID:k});},openAppointmentBannerSheet:function j(k){c('FantaDispatcher').dispatch({type:h.OPEN_APPOINTMENT_SHEET,tabID:k});}};f.exports=i;}),null);
__d('FantaTypeJoinableThread',['immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={admins:[],approvalMode:0,associatedObject:null,description:null,friendsInParticipants:[],imageURL:null,isViewerSubscribed:false,joinableMode:{mode:0,link:''},linkHash:'',participants:[],threadID:null,threadFBID:null,threadName:null};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('FantaTypeTabContents',['ChatPrivacyActionController','FantaGetMessageActions','FantaTypeFileUploader','FantaTypeSharePreview','immutable','MercuryIDs','emptyFunction','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={composerText:'',fileUploader:new (c('FantaTypeFileUploader'))(),hasFetchedAll:false,id:'',isScrolledToBottom:true,messages:c('immutable').List(),messageStore:null,nullPageID:null,nullPageTitle:null,openSheet:null,pageIndicator:null,pageIndicatorDescription:null,privacyController:null,sharePreview:new (c('FantaTypeSharePreview'))(),showContextBanner:false,showUnseenMessages:c('emptyFunction'),signatureID:null,joinableInterstitialData:null,thread:null,threadPreviewID:null,threadPreviewRecipients:null,timezoneInfo:null,typeahead:null};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(l){var m=void 0,n=c('MercuryIDs').getUserIDFromThreadID(l.id);if(n)m=new (c('ChatPrivacyActionController'))(n,function(o){c('setImmediate')(function(){c('FantaGetMessageActions').onPrivacyStateChange(l.id,o);});});i.constructor.call(this,babelHelpers['extends']({privacyController:m},l));}f.exports=k;}),null);
__d('WorkFocusMode',['WorkModeConfig','WorkUserAvailabilityStatusType','emptyFunction','ifRequired'],(function a(b,c,d,e,f,g){'use strict';var h={},i={status:'AVAILABLE',end_date:0};if(c('WorkModeConfig').availability){i.status=c('WorkModeConfig').availability.status;i.end_date=c('WorkModeConfig').availability.end_date;}f.exports={updateAvailability:function j(k,l){k=Object.keys(c('WorkUserAvailabilityStatusType')).find(function(m){return c('WorkUserAvailabilityStatusType')[m]===k;});i.status=k;i.end_date=l;},currentViewerInFocusMode:function j(k){if(!c('WorkModeConfig').focus_messaging_enabled)return false;if(k){if(h[k])return false;var l=null;c('ifRequired')('MercuryThreads',function(n){l=n.get().getThreadMetaNow(k);},c('emptyFunction'));if(l&&l.bypass_focus_mode_until&&l.bypass_focus_mode_until>Date.now()/1000)return false;}var m=c('WorkUserAvailabilityStatusType')[i.status];if(m===c('WorkUserAvailabilityStatusType').FOCUS&&i.end_date*1000>Date.now())return true;return false;},addBypassFocusModeForThread:function j(k){h[k]=true;},removeBypassFocusModeForThread:function j(k){h[k]=false;}};}),null);
__d('FantaReducersMercury',['Arbiter','AsyncSignal','AvailableList','AvailableListConstants','Bootloader','FantaAvailableStatus','FantaGetMessageActions','FantaMessageActions','FantaTabActions','FantaTabSheetActions','FantaTypeJoinableThread','FantaTypeTabContents','JSLogger','MercuryIDs','MercuryThreadIDMap','WorkFocusMode','getPageIDFromThreadID','ifRequired','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadIDMap').get(),i=c('JSLogger').create('FantaReducersMercury'),j=c('FantaMessageActions').Types,k=c('FantaTabActions').Types,l=c('FantaGetMessageActions').Types;function m(){return Math.floor(Math.random()*2147483648).toString(16);}function n(ha,ia){switch(ia.type){case k.OPEN_TAB:case k.OPEN_TAB_WITH_INTERSTITIAL_DATA:var ja=ia.tabID;c('ifRequired')('FantaTabsReactApp',function(ma){if(!c('MercuryIDs').isValidThreadID(ja)){ha=ha.deleteIn(['tabGroup','tabs',ja]);v(ja);}else{da(ha,ja);ea(ja);}},function(){return ha=o(ha,ia.tabID);});ha=q(ha,ja);var ka=m();ha=ha.mergeIn(['mercury','tabContents',ja],{signatureID:ka});new (c('AsyncSignal'))('/ajax/chat/opentab_tracking.php',{threadID:ja,userID:c('MercuryIDs').getUserIDFromThreadID(ja),signatureID:ka}).send();if(ia.interstitialData){var la=new (c('FantaTypeJoinableThread'))(ia.interstitialData);ha=ha.mergeIn(['mercury','tabContents',ja],{joinableInterstitialData:la});}c('Arbiter').inform('jewel/hide');return ha;}return ha;}function o(ha,ia){c('ifRequired')('FantaTabsSlimApp',function(ja){if(!c('MercuryIDs').isValidThreadID(ia)){ha=ha.deleteIn(['tabGroup','tabs',ia]);v(ia);}else{da(ha,ia);ea(ia);}},function(){da(ha,ia);ea(ia);});return ha;}function p(ha,ia){switch(ia.type){case j.RECEIVED_NEW_MESSAGE:ha=q(ha,ia.tabID);}return ha;}function q(ha,ia){var ja,ka=ha.mercury.tabContents.get(ia);if(!ka){var ja=function(){var la=c('getPageIDFromThreadID')(ia);if(la)c('Bootloader').loadModules(["PagesMercuryChatTabIndicatorHandler"],function(ma){var na=c('AvailableListConstants').OFFLINE,oa=new ma(la,na,function(pa){c('setImmediate')(function(){c('FantaTabSheetActions').openPageIndicatorSheet(ia,pa);});},function(){c('setImmediate')(function(){return c('FantaTabSheetActions').closePageIndicatorSheet(ia);});});c('setImmediate')(function(){c('FantaTabSheetActions').onIsPageTab(ia,oa);});oa.checkResponsiveness();},'FantaReducersMercury');return {v:ha.setIn(['mercury','tabContents',ia],new (c('FantaTypeTabContents'))({id:ia}))};}();if(typeof ja==="object")return ja.v;}return ha;}function r(ha,ia){switch(ia.type){case k.REPLACE_TAB:ha=u(ha,ia.newTabID);ha=q(ha,ia.newTabID);return ha;}return ha;}function s(ha,ia){switch(ia.type){case l.ADD_PARTICIPANTS:var ja=ia.tabID,ka=ia.previewTabID;if(!ha.mercury.tabContents.get(ja))return ha;ha=ha.mergeIn(['mercury','tabContents',ja],{threadPreviewID:ka});return ha;}return ha;}function t(ha,ia){switch(ia.type){case l.CLEAR_PARTICIPANTS:var ja=ia.tabID;ha=ha.setIn(['mercury','tabContents',ja],new (c('FantaTypeTabContents'))({id:ja}));}return ha;}function u(ha,ia){c('ifRequired')('FantaTabsReactApp',function(ja){if(!c('MercuryIDs').isValidThreadID(ia)){ha=ha.deleteIn(['tabGroup','tabs',ia]);v(ia);}},function(){c('ifRequired')('FantaTabsSlimApp',function(ja){if(!c('MercuryIDs').isValidThreadID(ia)){ha=ha.deleteIn(['tabGroup','tabs',ia]);v(ia);}});});return ha;}function v(ha){h.getClientIDFromServerID(ha,function(ia){return c('setImmediate')(function(){if(c('MercuryIDs').isValidThreadID(ia)){c('FantaTabActions').openTab(ia);}else i.error('invalid id',ha);});});}function w(ha,ia){switch(ia.type){case k.FOCUS_TAB:da(ha,ia.tabID);}return ha;}function x(ha,ia){switch(ia.type){case k.CLOSE_TAB:var ja=ia.tabID;ha=z(ha,ja);}return ha;}function y(ha,ia){switch(ia.type){case k.DELETE_TAB:var ja=ia.tabID;ha=z(ha,ja);ha=ha.deleteIn(['mercury','tabContents',ja]);}return ha;}function z(ha,ia){c('ifRequired')('MessengerVideoAutoplayActions',function(ja){ja.deleteThread(ia);});c('WorkFocusMode')&&c('WorkFocusMode').removeBypassFocusModeForThread(ia);return ha;}function aa(ha,ia){switch(ia.type){case k.CLOSE_ALL_TABS:c('ifRequired')('MessengerVideoAutoplayActions',function(ja){ja.deleteAllThreads();});return ha;}return ha;}function ba(ha,ia){switch(ia.type){case k.FOCUS_NEXT_TAB:case k.FOCUS_PREVIOUS_TAB:case k.CLOSE_AND_TAB_NEXT:var ja=ha.tabGroup.focusedTabID;if(ja)da(ha,ja);}return ha;}function ca(ha,ia){switch(ia.type){case k.CLOSE_AND_TAB_NEXT:var ja=ia.tabID;c('WorkFocusMode')&&c('WorkFocusMode').removeBypassFocusModeForThread(ja);}return ha;}function da(ha,ia){var ja=c('MercuryIDs').getUserIDFromThreadID(ia);if(ja)c('AvailableList').updateForID(ja);var ka=ha.mercury.tabContents.get(ia);if(ka){var la=ka.thread,ma=ka.pageIndicator;if(ma)ma.notifyPageOnlineStatusChanged(c('FantaAvailableStatus').getStatus(la,ia));}}function ea(ha){if(!c('MercuryIDs').isValidThreadID(ha))return;c('Bootloader').loadModules(["GroupChatMessageBlockAlert","mercuryBlockedParticipantsRe","MercuryThreadActions","MercuryThreads"],function(ia,ja,ka,la){var ma=ka.get(),na=la.get(),oa=ja.get();na.getThreadMeta(ha,function(pa){if(oa.isPresentInGroupThread(pa))ia.show(oa.inGroupThread(pa),function(){c('FantaTabActions').focusTab(ha);},function(){c('FantaTabActions').closeTab(ha);ma.leaveGroup(ha);});});},'FantaReducersMercury');}function fa(ha,ia){switch(ia.type){case k.UNMINIMIZE_TAB:da(ha,ia.tabID);}return ha;}function ga(ha,ia){switch(ia.type){case k.LOAD_FROM_DATA:for(var ja=ha.tabGroup.tabs.keys(),ka=Array.isArray(ja),la=0,ja=ka?ja:ja[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ma;if(ka){if(la>=ja.length)break;ma=ja[la++];}else{la=ja.next();if(la.done)break;ma=la.value;}var na=ma;ha=q(ha,na);}}return ha;}f.exports={addParticipants:s,clearParticipants:t,closeAllTabs:aa,closeAndTabNext:ca,closeTab:x,deleteTab:y,focusTab:w,focusTabEvents:ba,loadFromData:ga,openTab:n,receivedNewMessage:p,replaceTab:r,unminimizeTab:fa};}),null);
__d('FantaReducersMessages',['FantaGetMessageActions','FantaMessageActions','FantaTabActions','MercuryBrowserAlerts'],(function a(b,c,d,e,f,g){'use strict';var h=c('FantaMessageActions').Types,i=c('FantaTabActions').Types,j=c('FantaGetMessageActions').Types;function k(r,s){switch(s.type){case h.RECEIVED_NEW_MESSAGE:var t=s.message;c('MercuryBrowserAlerts').messageReceived(t);return r;}return r;}function l(r,s){switch(s.type){case h.COMPOSER_TEXT_UPDATE:var t=s.message,u=s.threadID;if(!r.mercury.tabContents.get(u))return r;return r.mergeIn(['mercury','tabContents',u],{composerText:t});}return r;}function m(r,s){switch(s.type){case i.CLOSE_TAB:if(!r.mercury.tabContents.get(s.tabID))return r;return r.mergeIn(['mercury','tabContents',s.tabID],{composerText:''});}return r;}function n(r,s){switch(s.type){case i.CLOSE_ALL_TABS:var t=r.mercury.tabContents;t.forEach(function(u){var v=u.id;r=r.setIn(['mercury','tabContents',v],u.set('composerText',''));});return r;}return r;}function o(r,s){switch(s.type){case i.SCROLL_BOTTOM_CHANGED:var t=s.tabID,u=s.isScrolledToBottom,v=s.showUnseenMessages;if(!r.mercury.tabContents.get(t))return r;r=r.mergeIn(['mercury','tabContents',t],{isScrolledToBottom:u,showUnseenMessages:v});}return r;}function p(r,s){switch(s.type){case i.SHOW_UNSEEN_MESSAGES:var t=s.tabID,u=r.mercury.tabContents.get(t);if(u)u.showUnseenMessages();}return r;}function q(r,s){switch(s.type){case j.ON_GET_THREAD_RESPONSE:var t=s.thread,u=t.thread_id,v=r.mercury.tabContents.get(u);if(!v)return r;r=r.mergeIn(['mercury','tabContents',u],{thread:t});break;}return r;}f.exports={closeAllTabs:n,closeTab:m,composerTextUpdate:l,onGetThreadResponse:q,receivedNewMessage:k,scrollBottomChanged:o,showUnseenMessages:p};}),null);
__d('MercurySheetPolicy',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h={ChatThreadIsMutedTabSheet:{isPermanent:false,isSheetWithInput:false},ChatUserFocusSheet:{isPermanent:true,isSheetWithInput:true},ChatUserFocusBypassSheet:{isPermanent:true,isSheetWithInput:true},ChatUserTimezoneSheet:{isPermanent:true,isSheetWithInput:true},ChatUserBlockedTabSheet:{isPermanent:true,isSheetWithInput:false},ChatUploadWarningTabSheet:{isPermanent:false,isSheetWithInput:false},ChatThreadIsMessageBlockedSheet:{isPermanent:true,isSheetWithInput:false},ChatReadOnlyTabSheet:{isPermanent:false,isSheetWithInput:false},ChatReadOnlyPermanentTabSheet:{isPermanent:true,isSheetWithInput:false},ChatOfflineTabSheet:{isPermanent:true,isSheetWithInput:false},ChatNoRecipientsTabSheet:{isPermanent:true,isSheetWithInput:false},ChatNewMessagesTabSheet:{isPermanent:true,isSheetWithInput:true},ChatNameConversationTabSheet:{isPermanent:true,isSheetWithInput:true},ChatEmployeeAwaySheet:{isPermanent:true,isSheetWithInput:false},ChatUserIsPersonalUserSheet:{isPermanent:true,isSheetWithInput:false},ChatUserIsWorkUserSheet:{isPermanent:true,isSheetWithInput:true},ChatPageResponsivenessIndicator:{isPermanent:true,isSheetWithInput:false},ChatEventReminderTabSheet:{isPermanent:true,isSheetWithInput:false},ChatAppointmentBanner:{isPermanent:true,isSheetWithInput:false},ChatMontageSheet:{isPermanent:false,isSheetWithInput:false},ChatJoinCallSheet:{isPermanent:true,isSheetWithInput:false},FantaAddFriendsSheet:{isPermanent:true,isSheetWithInput:true},FantaAddMoreFriendsSheet:{isPermanent:true,isSheetWithInput:true},ChatRoomAssociatedObjectSheet:{isPermanent:false,isSheetWithInput:false}},i={canReplaceOpenSheet:function j(k,l){var m=this.getType(l),n=this.isPermanent(l),o=this.isSheetWithInput(l),p=this.getType(k),q=this.isPermanent(k),r=this.isSheetWithInput(k);if(r)return !!(m!==p&&o);if(q&&!n)return false;if(p===this.sheets.ChatThreadIsMessageBlockedSheet)return false;return true;},getType:function j(k){var l=k.getType||k.type&&k.type.getType||function(){return k;},m=l.call(k);return m;},isPermanent:function j(k){if(typeof k==='string'&&h[k])return h[k].isPermanent;var l=k.isPermanent||k.type&&k.type.isPermanent||function(){return false;},m=l.call(k);return m;},isSheetWithInput:function j(k){if(typeof k==='string'&&h[k])return h[k].isSheetWithInput;var l=k.isSheetWithInput||k.type&&k.type.isSheetWithInput||function(){return false;},m=l.call(k);return m;},sheets:c('keyMirror')(h)};f.exports=i;}),null);
__d("XNativeComponentFlowBookingRequestCountController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/pages\/platform\/native-component-flow\/booking_request_count\/",{page_id:{type:"FBID",required:true},user_id:{type:"FBID",required:true}});}),null);
__d('FantaReducersTabSheets',['AsyncRequest','Bootloader','ChatEmployeeAwayWarning','ChatPrivacyActionController','ChatTimezoneWarning','ChatUserFocusWarning','ChatUserPersonalUserWarning','ChatUserWorkUserWarning','CurrentUser','FantaGetMessageActions','FantaMessageActions','FantaTabActions','FantaTabSheetActions','FBID','ImmutableObject','mercuryBlockedParticipantsRe','MercuryConfig','MercuryDataSourceWrapper','MercuryIDs','MercuryParticipants','MercurySheetPolicy','MercuryThreadInfo','MercuryThreads','MercuryTypeaheadConstants','MercuryViewer','MessageThreadAssociatedObjectUtils','MessengerRoomPrivacyMode','XNativeComponentFlowBookingRequestCountController','emptyFunction','ifRequired','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('mercuryBlockedParticipantsRe').get(),i=c('MercuryThreads').get(),j=c('FantaTabActions').Types,k=c('FantaGetMessageActions').Types,l=c('FantaMessageActions').Types,m=c('FantaTabSheetActions').Types;function n(ub,vb){switch(vb.type){case j.CLOSE_TAB:case j.CLOSE_AND_TAB_NEXT:var wb=vb.tabID;if(!ub.mercury.tabContents.get(wb))return ub;ub=ub.mergeIn(['mercury','tabContents',wb],{typeahead:null});return o(ub,wb);}return ub;}function o(ub,vb,wb){var xb=ub.mercury.tabContents.get(vb);if(!xb)return ub;if(wb&&xb.openSheet!==wb)return ub;ub=ub.mergeIn(['mercury','tabContents',vb],{openSheet:null});if(xb.thread)ub=mb(ub,vb,xb.thread);return ub;}function p(ub,vb){switch(vb.type){case j.CLOSE_ALL_TABS:for(var wb=ub.mercury.tabContents.keys(),xb=Array.isArray(wb),yb=0,wb=xb?wb:wb[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var zb;if(xb){if(yb>=wb.length)break;zb=wb[yb++];}else{yb=wb.next();if(yb.done)break;zb=yb.value;}var ac=zb;ub=ub.mergeIn(['mercury','tabContents',ac],{typeahead:null});ub=o(ub,ac);}}return ub;}function q(ub,vb){switch(vb.type){case k.ON_GET_THREAD_RESPONSE:case k.ON_GET_THREAD_PREVIEW_RESPONSE:var wb=vb.thread,xb=vb.tabID||wb.thread_id;ub=r(ub,wb,xb);}return ub;}function r(ub,vb,wb){var xb=c('MercuryViewer').getID(),yb=vb.participants.filter(function(zb){return zb!==xb;});if(yb.length<1&&!i.isNewEmptyLocalThread(wb)){ub=z(ub,wb,c('MercurySheetPolicy').sheets.ChatNoRecipientsTabSheet);}else ub=o(ub,wb,c('MercurySheetPolicy').sheets.ChatNoRecipientsTabSheet);if(vb.participants.length===0){ub=x(ub,wb,vb);ub=z(ub,wb,c('MercurySheetPolicy').sheets.FantaAddFriendsSheet);}else ub=mb(ub,wb,vb);return ub;}function s(ub,vb){switch(vb.type){case k.THREADS_UPDATED:vb.threads.forEach(function(wb){ub=r(ub,new (c('ImmutableObject'))(wb),wb.thread_id);});}return ub;}function t(ub,vb){switch(vb.type){case j.OPEN_TAB:case j.REPLACE_TAB:var wb=vb.tabID,xb=ub.mercury.tabContents.get(wb).thread;if(xb)ub=mb(ub,wb,xb);}return ub;}function u(ub,vb,wb){if(c('MercuryThreadInfo').isMuted(wb)){return z(ub,vb,c('MercurySheetPolicy').sheets.ChatThreadIsMutedTabSheet);}else return o(ub,vb,c('MercurySheetPolicy').sheets.ChatThreadIsMutedTabSheet);}function v(ub,vb,wb){if(h.isMessageBlocked(wb)){return z(ub,vb,c('MercurySheetPolicy').sheets.ChatThreadIsMessageBlockedSheet);}else return o(ub,vb,c('MercurySheetPolicy').sheets.ChatThreadIsMessageBlockedSheet);}function w(ub,vb){switch(vb.type){case k.ON_BOOTLOAD_TYPEAHEAD:var wb=vb.thread,xb=wb.thread_id;ub=x(ub,xb,wb);}return ub;}function x(ub,vb,wb){if(ub.mercury.tabContents.get(vb).typeahead)return ub;c('ifRequired')('ChatTabTypeaheadRenderer',function(xb){c('ifRequired')('ContextualTypeaheadView',function(yb){c('ifRequired')('MercuryTypeahead',function(zb){if(!ub.mercury.tabContents.get(vb))return;var ac=!!(wb&&wb.participants&&wb.participants.length===0),bc=!!(wb&&wb.associated_object&&wb.associated_object.privacy_mode===c('MessengerRoomPrivacyMode').WHITELISTED_MODE),cc=ac?c('MercuryDataSourceWrapper').chat_typeahead_source:bc?c('MercuryDataSourceWrapper').chat_add_people_froup_source:c('MercuryDataSourceWrapper').chat_add_people_source;cc.setShowThreads(ac);if(bc)cc.setQueryData({thread_id:wb.thread_fbid});var dc=new zb(cc,yb);dc.setViewOption('renderer',xb);dc.setExcludedParticipantsFromThreadMeta(wb);ub=ub.mergeIn(['mercury','tabContents',vb],{typeahead:dc});},function(){return y(vb,wb);});},function(){return y(vb,wb);});},function(){return y(vb,wb);});return ub;}function y(ub,vb){c('Bootloader').loadModules(["ChatTabTypeaheadRenderer","ContextualTypeaheadView","MercuryTypeahead"],function(wb,xb,yb){c('FantaGetMessageActions').onBootloadTypeahead(ub,vb);},'FantaReducersTabSheets');}function z(ub,vb,wb){var xb=ub.mercury.tabContents.get(vb),yb=ub.tabGroup.tabs.get(vb);if(!yb||!xb)return ub;var zb=xb.openSheet;if(zb&&!c('MercurySheetPolicy').canReplaceOpenSheet(zb,wb))return ub;ub=ub.mergeIn(['mercury','tabContents',vb],{openSheet:wb});return ub;}function aa(ub,vb){switch(vb.type){case k.ADD_PARTICIPANTS:var wb=vb.tokens,xb=vb.tabID,yb=wb.length===1&&wb[0].getInfo().render_type===c('MercuryTypeaheadConstants').THREAD_TYPE;if(!yb)return z(ub,xb,c('MercurySheetPolicy').sheets.FantaAddFriendsSheet);}return ub;}function ba(ub,vb){return ub;}function ca(ub,vb){switch(vb.type){case m.OPEN_APPOINTMENT_SHEET:var wb=vb.tabID;return z(ub,wb,c('MercurySheetPolicy').sheets.ChatAppointmentBanner);}return ub;}function da(ub,vb){switch(vb.type){case m.OPEN_USER_FOCUS_SHEET:var wb=vb.tabID;return z(ub,wb,c('MercurySheetPolicy').sheets.ChatUserFocusSheet);}return ub;}function ea(ub,vb){switch(vb.type){case m.CLOSE_USER_FOCUS_AND_BYPASS_SHEET:var wb=vb.tabID;ub=o(ub,wb,c('MercurySheetPolicy').sheets.ChatUserFocusSheet);ub=o(ub,wb,c('MercurySheetPolicy').sheets.ChatUserFocusBypassSheet);}return ub;}function fa(ub,vb,wb){c('ChatUserFocusWarning').updateUserFocusWarning(wb,function(xb){xb?c('setImmediate')(function(){c('FantaTabSheetActions').openBypassFocusSheet(vb);}):c('setImmediate')(function(){c('FantaTabSheetActions').openUserFocusSheet(vb);});},function(){c('setImmediate')(function(){c('FantaTabSheetActions').closeUserFocusAndBypassSheet(vb);});});return ub;}function ga(ub,vb){switch(vb.type){case m.OPEN_BYPASS_FOCUS_SHEET:var wb=vb.tabID;return z(ub,wb,c('MercurySheetPolicy').sheets.ChatUserFocusBypassSheet);}return ub;}function ha(ub,vb){switch(vb.type){case m.OPEN_USER_TIMEZONE_SHEET:var wb=vb.tabID,xb=vb.timezoneInfo;if(!ub.mercury.tabContents.get(wb))return ub;ub=ub.mergeIn(['mercury','tabContents',wb],{timezoneInfo:xb});return z(ub,wb,c('MercurySheetPolicy').sheets.ChatUserTimezoneSheet);}return ub;}function ia(ub,vb){switch(vb.type){case m.CLOSE_USER_TIMEZONE_SHEET:var wb=vb.tabID;if(!ub.mercury.tabContents.get(wb))return ub;ub=ub.mergeIn(['mercury','tabContents',wb],{timezoneInfo:null});ub=o(ub,wb,c('MercurySheetPolicy').sheets.ChatUserTimezoneSheet);}return ub;}function ja(ub,vb,wb){c('ChatTimezoneWarning').updateUserTimezoneWarning(wb,function(xb){c('setImmediate')(function(){c('FantaTabSheetActions').openUserTimezoneSheet(vb,xb);});},function(){c('setImmediate')(function(){c('FantaTabSheetActions').closeUserTimezoneSheet(vb);});});return ub;}function ka(ub,vb,wb){c('ChatEmployeeAwayWarning').updateEmployeeAwayWarning(wb,function(){return c('setImmediate')(function(){c('FantaTabSheetActions').openEmployeeAwaySheet(vb);});},c('emptyFunction'));return ub;}function la(ub,vb){switch(vb.type){case m.OPEN_EMPLOYEE_AWAY_SHEET:var wb=vb.tabID;ub=z(ub,wb,c('MercurySheetPolicy').sheets.ChatEmployeeAwaySheet);}return ub;}function ma(ub,vb,wb){c('ChatUserPersonalUserWarning').updateEmployeePersonalUserWarning(wb,function(xb,yb){c('setImmediate')(function(){c('FantaTabSheetActions').openEmployeePersonalUserSheet(vb);});},c('emptyFunction'));return ub;}function na(ub,vb){switch(vb.type){case m.OPEN_EMPLOYEE_PERSONAL_USER_SHEET:var wb=vb.tabID;ub=z(ub,wb,c('MercurySheetPolicy').sheets.ChatUserIsPersonalUserSheet);}return ub;}function oa(ub,vb){switch(vb.type){case m.CLOSE_EMPLOYEE_PERSONAL_USER_SHEET:var wb=vb.tabID;ub=o(ub,wb,c('MercurySheetPolicy').sheets.ChatUserIsPersonalUserSheet);}return ub;}function pa(ub,vb){switch(vb.type){case m.OPEN_EMPLOYEE_WORK_USER_SHEET:var wb=vb.tabID;ub=z(ub,wb,c('MercurySheetPolicy').sheets.ChatUserIsWorkUserSheet);}return ub;}function qa(ub,vb){switch(vb.type){case m.CLOSE_EMPLOYEE_WORK_USER_SHEET:var wb=vb.tabID;ub=o(ub,wb,c('MercurySheetPolicy').sheets.ChatUserIsWorkUserSheet);}return ub;}function ra(ub,vb,wb){c('ChatUserWorkUserWarning').updateEmployeeWorkUserWarning(wb,function(xb,yb){c('setImmediate')(function(){c('FantaTabSheetActions').openEmployeeWorkUserSheet(vb);});},c('emptyFunction'));return ub;}function sa(ub,vb){switch(vb.type){case m.OPEN_NAME_CONVERSATION_TAB_SHEET:return z(ub,vb.tabID,c('MercurySheetPolicy').sheets.ChatNameConversationTabSheet);}return ub;}function ta(ub,vb){switch(vb.type){case m.CLOSE_NAME_CONVERSATION_TAB_SHEET:return o(ub,vb.tabID,c('MercurySheetPolicy').sheets.ChatNameConversationTabSheet);}return ub;}function ua(ub,vb){return ub;}function va(ub,vb){switch(vb.type){case m.OPEN_READ_ONLY_PERMANENT_SHEET:return z(ub,vb.tabID,c('MercurySheetPolicy').sheets.ChatReadOnlyPermanentTabSheet);}return ub;}function wa(ub,vb){switch(vb.type){case m.CLOSE_READ_ONLY_PERMANENT_SHEET:return o(ub,vb.tabID,c('MercurySheetPolicy').sheets.ChatReadOnlyPermanentTabSheet);}return ub;}function xa(ub,vb){switch(vb.type){case m.OPEN_READ_ONLY_SHEET:return z(ub,vb.tabID,c('MercurySheetPolicy').sheets.ChatReadOnlyTabSheet);}return ub;}function ya(ub,vb){switch(vb.type){case m.CLOSE_READ_ONLY_SHEET:return o(ub,vb.tabID,c('MercurySheetPolicy').sheets.ChatReadOnlyTabSheet);}return ub;}function za(ub,vb){return ub;}function ab(ub,vb){return ub;}function bb(ub,vb){return ub;}function cb(ub,vb){switch(vb.type){case m.CLOSE_ADD_FRIENDS_SHEET:var wb=vb.tabID;if(!ub.mercury.tabContents.get(wb))return ub;ub=ub.mergeIn(['mercury','tabContents',wb],{typeahead:null});return o(ub,wb,c('MercurySheetPolicy').sheets.FantaAddFriendsSheet);}return ub;}function db(ub,vb){switch(vb.type){case m.OPEN_ADD_MORE_FRIENDS_SHEET:var wb=vb.tabID,xb=ub.mercury.tabContents.get(wb).thread;if(xb){ub=x(ub,wb,xb);return z(ub,vb.tabID,c('MercurySheetPolicy').sheets.FantaAddMoreFriendsSheet);}}return ub;}function eb(ub,vb){switch(vb.type){case m.CLOSE_ADD_MORE_FRIENDS_SHEET:var wb=vb.tabID;if(!ub.mercury.tabContents.get(wb))return ub;ub=ub.mergeIn(['mercury','tabContents',wb],{typeahead:null});return o(ub,wb,c('MercurySheetPolicy').sheets.FantaAddMoreFriendsSheet);}return ub;}function fb(ub,vb){switch(vb.type){case l.SEND_GROUP_MESSAGE:var wb=vb.tabID||vb.threadID;return o(ub,wb,c('MercurySheetPolicy').sheets.FantaAddMoreFriendsSheet);}return ub;}function gb(ub,vb){switch(vb.type){case l.RECEIVED_NEW_MESSAGE:var wb=vb.tabID,xb=ub.mercury.tabContents.get(wb);if(xb&&!xb.isScrolledToBottom){ub=z(ub,wb,c('MercurySheetPolicy').sheets.ChatNewMessagesTabSheet);}else ub=o(ub,wb,c('MercurySheetPolicy').sheets.ChatNewMessagesTabSheet);}return ub;}function hb(ub,vb){switch(vb.type){case j.SCROLL_BOTTOM_CHANGED:var wb=vb.tabID,xb=vb.isScrolledToBottom;if(xb)ub=o(ub,wb,c('MercurySheetPolicy').sheets.ChatNewMessagesTabSheet);var yb=ub.mercury.tabContents.get(wb);if(yb&&yb.thread)ub=ob(ub,wb,yb.thread);}return ub;}function ib(ub,vb){switch(vb.type){case k.ON_PRIVACY_STATE_CHANGE:var wb=vb.threadID,xb=vb.privacyState;switch(xb){case c('ChatPrivacyActionController').OFFLINE:ub=o(ub,wb,c('MercurySheetPolicy').sheets.ChatUserBlockedTabSheet);ub=z(ub,wb,c('MercurySheetPolicy').sheets.ChatOfflineTabSheet);break;case c('ChatPrivacyActionController').NORMAL:ub=o(ub,wb,c('MercurySheetPolicy').sheets.ChatUserBlockedTabSheet);ub=o(ub,wb,c('MercurySheetPolicy').sheets.ChatOfflineTabSheet);break;case c('ChatPrivacyActionController').BLOCKED:ub=o(ub,wb,c('MercurySheetPolicy').sheets.ChatOfflineTabSheet);var yb=c('MercuryIDs').getUserIDFromThreadID(wb);if(yb){var zb=c('MercuryParticipants').getNow(c('MercuryIDs').getParticipantIDFromUserID(yb));zb&&zb.is_friend?(ub=z(ub,wb,c('MercurySheetPolicy').sheets.ChatUserBlockedTabSheet)):(ub=o(ub,wb,c('MercurySheetPolicy').sheets.ChatUserBlockedTabSheet));}break;}}return ub;}function jb(ub,vb){switch(vb.type){case m.OPEN_PAGE_INDICATOR_SHEET:var wb=vb.tabID,xb=vb.description;if(xb&&ub.mercury.tabContents.get(wb)){ub=ub.mergeIn(['mercury','tabContents',wb],{pageIndicatorDescription:xb});return z(ub,wb,c('MercurySheetPolicy').sheets.ChatPageResponsivenessIndicator);}}return ub;}function kb(ub,vb){switch(vb.type){case m.CLOSE_PAGE_INDICATOR_SHEET:var wb=vb.tabID;ub=o(ub,wb,c('MercurySheetPolicy').sheets.ChatPageResponsivenessIndicator);}return ub;}function lb(ub,vb){switch(vb.type){case m.ON_IS_PAGE_TAB:var wb=vb.tabID,xb=vb.pageIndicator,yb=ub.mercury.tabContents.get(wb);if(!yb)return ub;ub=ub.mergeIn(['mercury','tabContents',wb],{pageIndicator:xb});}return ub;}function mb(ub,vb,wb){ub=fa(ub,vb,wb);ub=ja(ub,vb,wb);ub=v(ub,vb,wb);ub=u(ub,vb,wb);ub=ka(ub,vb,wb);ub=ma(ub,vb,wb);ub=ra(ub,vb,wb);ub=pb(ub,vb,wb);ub=sb(ub,vb,wb);ub=ob(ub,vb,wb);ub=nb(ub,vb,wb);ub=tb(ub,vb,wb);return ub;}function nb(ub,vb,wb){var xb=wb.rtc_call_data,yb=wb.thread_fbid,zb=xb&&xb.call_state!=='NO_ONGOING_CALL'&&yb;if(zb){ub=z(ub,vb,c('MercurySheetPolicy').sheets.ChatJoinCallSheet);}else ub=o(ub,vb,c('MercurySheetPolicy').sheets.ChatJoinCallSheet);return ub;}function ob(ub,vb,wb){var xb=wb.has_montage&&c('MercuryConfig').MontageThreadViewer,yb=ub.mercury.tabContents.get(vb),zb=!!(yb&&yb.isScrolledToBottom);if(zb&&xb){ub=z(ub,vb,c('MercurySheetPolicy').sheets.ChatMontageSheet);}else ub=o(ub,vb,c('MercurySheetPolicy').sheets.ChatMontageSheet);return ub;}function pb(ub,vb,wb){c('ifRequired')('EventReminderActions',function(xb){var event=wb.lightweight_event;if(event){xb.updateEventReminder(vb,event);ub=z(ub,vb,c('MercurySheetPolicy').sheets.ChatEventReminderTabSheet);}else c('ifRequired')('EventReminderStateStore',function(yb){var zb=yb.getEvent(vb);if(zb&&zb.exists)xb.deleteEventReminder(vb);ub=o(ub,vb,c('MercurySheetPolicy').sheets.ChatEventReminderTabSheet);},function(){return qb(vb);});},function(){return qb(vb);});return ub;}function qb(ub){c('Bootloader').loadModules(["EventReminderActions","EventReminderStateStore"],function(vb,wb){c('setImmediate')(function(){c('FantaTabSheetActions').onBootloadEventReminder(ub);});},'FantaReducersTabSheets');}function rb(ub,vb){switch(vb.type){case m.ON_BOOTLOAD_EVENT_REMINDER:var wb=vb.tabID,xb=ub.mercury.tabContents.get(wb);if(!xb)return ub;var yb=xb.thread;if(yb)ub=pb(ub,wb,yb);}return ub;}function sb(ub,vb,wb){var xb=wb.other_user_fbid;if(xb&&!c('FBID').isUser(xb)&&c('MercuryConfig').ShowAppointmentBanner){var yb=c('XNativeComponentFlowBookingRequestCountController').getURIBuilder().setFBID('page_id',xb).setFBID('user_id',c('CurrentUser').getID()).getURI();new (c('AsyncRequest'))().setURI(yb).setHandler(function(zb){var ac=zb&&zb.getPayload();if(ac&&ac.confirmed+ac.pending>0)c('FantaTabSheetActions').openAppointmentBannerSheet(vb);}).send();}else ub=o(ub,vb,c('MercurySheetPolicy').sheets.ChatAppointmentBanner);return ub;}function tb(ub,vb,wb){var xb=wb.associated_object;if(c('MessageThreadAssociatedObjectUtils').shouldRender(xb))ub=z(ub,vb,c('MercurySheetPolicy').sheets.ChatRoomAssociatedObjectSheet);return ub;}f.exports={addParticipants:aa,closeAddFriends:cb,closeAddMoreFriends:eb,closeAllTabs:p,closeEmployeePersonalUserSheet:oa,closeEmployeeWorkUserSheet:qa,closeFocusUserSheet:ea,closeNameConversationSheet:ta,closePageIndicatorSheet:kb,closePermanentReadOnlySheet:wa,closeReadOnlySheet:ya,closeTab:n,closeUserTimezoneSheet:ia,onBootloadEventReminder:rb,onBootloadTypeahead:w,onGetThreadResponse:q,onIsPageTab:lb,onPrivacyStateChange:ib,openAddFriendsSheet:ba,openAddMoreFriends:db,openAppointmentBannerSheet:ca,openBypassFocusSheet:ga,openEmployeeAwaySheet:la,openEmployeePersonalUserSheet:na,openEmployeeWorkUserSheet:pa,openFocusUserSheet:da,openNameConversationSheet:sa,openNewMessagesSheet:ua,openPageIndicatorSheet:jb,openPermanentReadOnlySheet:va,openReadOnlySheet:xa,openTab:t,openUploadWarningTabSheet:za,openUserFocusSheet:ab,openUserIsPersonalUserSheet:bb,openUserTimezoneSheet:ha,receivedNewMessage:gb,scrollBottomChanged:hb,sendGroupMessage:fb,threadsUpdated:s};}),null);
__d('FantaTypeTab',['immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={focusCounter:0,id:'',isMinimized:false,openCounter:0};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('FantaTypeTabGroup',['FantaConst','immutable','MercuryConfig'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={allowedRaisedTabs:c('FantaConst').DEFAULT_ALLOWED_RAISED_TABS,focusedTabID:null,tabs:c('immutable').Map({}),updatedTime:0};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;k.prototype.getRaisedandUnraisedTabs=function(){var l=void 0,m=void 0;if(c('MercuryConfig').FantaTabOrdering){m=function q(r){return r.openCounter*-1;};l=function q(r){return r.focusCounter*-1;};}else{m=function q(r){return r.openCounter;};l=function q(r){return r.focusCounter*-1;};}var n=this.tabs.sortBy(l),o=n.slice(this.allowedRaisedTabs),p=n.take(this.allowedRaisedTabs).sortBy(m);return {raisedTabs:p,unraisedTabs:o};};function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d("isWebMessengerURI",[],(function a(b,c,d,e,f,g){function h(i){return /^(\/messages)/.test(i.getPath());}f.exports=h;}),null);
__d('FantaReducersTabs',['EventProfiler','FantaConst','FantaMessageActions','FantaTabActions','FantaTypeTab','FantaTypeTabGroup','LogHistory','PinnedConversationNubsConfig','URI','isWebMessengerURI'],(function a(b,c,d,e,f,g){'use strict';var h=c('FantaMessageActions').Types,i=c('FantaTabActions').Types,j='tab_',k=c('LogHistory').getInstance('fanta_tabs'),l=1,m=1,n=1;function o(ka,la){switch(la.type){case i.OPEN_TAB:case i.OPEN_TAB_WITH_INTERSTITIAL_DATA:k.debug(la.type,JSON.stringify({id:la.tabID}));if(m===1)c('EventProfiler').tagCurrentActiveInteractionsAs('FirstChatTabOpen');return v(ka,la.tabID||j+n++,true);}return ka;}function p(ka,la){switch(la.type){case i.REPLACE_TAB:var ma=la.tabID,na=la.newTabID,oa=ka.tabGroup,pa=oa.tabs,qa=pa.get(ma);k.debug(la.type,JSON.stringify({id:ma,isExisting:!!qa,newID:na}));if(qa){var ra=qa.id===ka.tabGroup.focusedTabID;ka=ka.setIn(['tabGroup','tabs',na],qa.merge({id:na})).deleteIn(['tabGroup','tabs',ma]);return v(ka,na,ra,true);}return v(ka,na);}return ka;}function q(ka,la){switch(la.type){case i.MINIMIZE_TAB:return w(ka,la.tabID,true);}return ka;}function r(ka,la){switch(la.type){case i.UNMINIMIZE_TAB:return w(ka,la.tabID,false);}return ka;}function s(ka,la){switch(la.type){case i.FOCUS_TAB:var ma=la.tabID;return ca(ka,ma);}return ka;}function t(ka,la){switch(la.type){case i.BLUR_TAB:return da(ka,la.tabID);}return ka;}function u(ka,la){switch(la.type){case h.RECEIVED_NEW_MESSAGE:var ma=la.tabID,na=ka.tabGroup.tabs.get(ma);k.debug(la.type,JSON.stringify({id:ma,isOpen:!!na}));if(!na){var oa=ka.tabGroup.focusedTabID;ka=v(ka,ma,false);var pa=c('URI').getNextURI();if(c('isWebMessengerURI')(pa)){return ka=w(ka,ma,true);}else if(oa)return ca(ka,oa);}}return ka;}function v(ka,la,ma,na){var oa=ka.tabGroup,pa=oa.tabs,qa=pa.get(la);if(!qa){qa=new (c('FantaTypeTab'))({id:la,focusCounter:l,openCounter:m++});ka=ka.setIn(['tabGroup','tabs',la],qa);}else if(qa.isMinimized&&ma)ka=w(ka,la,false);if(ma)return ca(ka,la);return ka;}function w(ka,la,ma){var na=ka.tabGroup,oa=na.tabs.get(la);if(oa)ka=ka.mergeIn(['tabGroup','tabs',la],{isMinimized:ma});return ka;}function x(ka,la){switch(la.type){case i.MINIMIZE_ALL_TABS:for(var ma=ka.tabGroup.tabs.keys(),na=Array.isArray(ma),oa=0,ma=na?ma:ma[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var pa;if(na){if(oa>=ma.length)break;pa=ma[oa++];}else{oa=ma.next();if(oa.done)break;pa=oa.value;}var qa=pa;ka=w(ka,qa,true);}return ka;}return ka;}function y(ka,la){switch(la.type){case i.CLOSE_TAB:case i.DELETE_TAB:var ma=la.tabID;k.debug(la.type,JSON.stringify({id:ma}));return z(ka,ma);}return ka;}function z(ka,la){ka=da(ka,la);return ka.deleteIn(['tabGroup','tabs',la]);}function aa(ka,la){switch(la.type){case i.CLOSE_ALL_TABS:k.debug(la.type);ka=da(ka,ka.tabGroup.focusedTabID);return ka.setIn(['tabGroup','tabs'],ka.tabGroup.tabs.clear());}return ka;}function ba(ka,la){switch(la.type){case i.CLOSE_AND_TAB_NEXT:k.debug(la.type,JSON.stringify({id:la.tabID}));ka=z(ka,la.tabID);return ia(ka);}return ka;}function ca(ka,la){var ma=arguments.length<=2||arguments[2]===undefined?false:arguments[2],na=ka.tabGroup,oa=na.tabs.get(la);if(oa)ka=ka.mergeIn(['tabGroup','tabs',la],{focusCounter:l++});var pa=ma?null:la;ka=ka.mergeIn(['tabGroup'],{focusedTabID:pa});return ka;}function da(ka,la){if(ka.tabGroup.focusedTabID===la)return ka.mergeIn(['tabGroup'],{focusedTabID:null});return ka;}function ea(ka,la){switch(la.type){case i.SET_ALLOWED_RAISED_TABS:var ma=la.allowedRaisedTabs;if(ma!==ka.tabGroup.allowedRaisedTabs)k.debug(la.type,JSON.stringify({count:ma}));return fa(ka,ma);}return ka;}function fa(ka){var la=arguments.length<=1||arguments[1]===undefined?c('FantaConst').DEFAULT_ALLOWED_RAISED_TABS:arguments[1];if(la===ka.tabGroup.allowedRaisedTabs)return ka;if(!c('PinnedConversationNubsConfig').chatTabTypingPriority)la=Math.max(1,la);return ka.mergeIn(['tabGroup'],{allowedRaisedTabs:la});}function ga(ka,la){switch(la.type){case i.LOAD_FROM_DATA:var ma=ka.tabGroup,na=la.tabData,oa=ma.updatedTime;if(oa>=na.updatedTime||na.updatedTime===undefined)return ka;ka=fa(ka.set('tabGroup',new (c('FantaTypeTabGroup'))()),ma.allowedRaisedTabs);var pa=[];na.tabs.sort(function(qa,ra){return qa.openCounter-ra.openCounter;}).forEach(function(qa){pa.push(qa.id);ka=v(ka,qa.id,false);if(qa.isMinimized)ka=w(ka,qa.id,qa.isMinimized);});na.tabs.sort(function(qa,ra){return qa.focusCounter-ra.focusCounter;}).forEach(function(qa){ka=ca(ka,qa.id,true);});k.debug(la.type,JSON.stringify({updatedTime:oa,newerTime:na.updatedTime,opened:pa}));ka=na.focusedTabID?ca(ka,na.focusedTabID,true):da(ka);}return ka;}function ha(ka,la){switch(la.type){case i.FOCUS_NEXT_TAB:return ia(ka);}return ka;}function ia(ka){var la=ka.tabGroup.focusedTabID,ma=ka.tabGroup.getRaisedandUnraisedTabs(),na=ma.raisedTabs,oa=na.count();if(oa===0){return ka;}else if(na.count()===1)return ca(ka,na.first().id);var pa=na.skipUntil(function(qa){return qa.id===la;}).rest();if(pa.count()===0){return ca(ka,na.first().id);}else return ca(ka,pa.first().id);}function ja(ka,la){switch(la.type){case i.FOCUS_PREVIOUS_TAB:var ma=ka.tabGroup.focusedTabID,na=ka.tabGroup.getRaisedandUnraisedTabs(),oa=na.raisedTabs;if(oa.count()<2)return ka;var pa=oa.reverse().skipUntil(function(qa){return qa.id===ma;}).rest();if(pa.count()===0){return ca(ka,oa.last().id);}else return ca(ka,pa.first().id);}return ka;}f.exports={blurTab:t,closeAllTabs:aa,closeAndTabNext:ba,closeTab:y,focusNextTab:ha,focusPreviousTab:ja,focusTab:s,loadFromData:ga,minimizAllTabs:x,minimizeTab:q,openTab:o,receivedNewMessage:u,replaceTab:p,setAllowedRaisedTabs:ea,unminimizeTab:r};}),null);
__d('FantaTypeMercuryState',['immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={tabContents:c('immutable').Map({})};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('FantaTypeAppState',['FantaTypeMercuryState','FantaTypeTabGroup','immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={tabGroup:new (c('FantaTypeTabGroup'))(),mercury:new (c('FantaTypeMercuryState'))()};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('FantaAppStore',['FantaDispatcher','FantaReducersCookie','FantaReducersDockCalculator','FantaReducersMercury','FantaReducersMessages','FantaReducersTabs','FantaReducersTabSheets','FantaTypeAppState','FluxReduceStore'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=[].concat(Object.values(c('FantaReducersTabs')),Object.values(c('FantaReducersMercury')),Object.values(c('FantaReducersMessages')),Object.values(c('FantaReducersTabSheets')),Object.values(c('FantaReducersDockCalculator')),Object.values(c('FantaReducersCookie')));h=babelHelpers.inherits(k,c('FluxReduceStore'));i=h&&h.prototype;k.prototype.getInitialState=function(){return new (c('FantaTypeAppState'))();};k.prototype.ignoreReducer=function(l){var m=Object.values(l);j=j.filter(function(n){return !m.find(function(o){return o===n;});});};k.prototype.addReducers=function(l){this.ignoreReducer(l);j=j.concat(Object.values(l));};k.prototype.reduce=function(l,m){return j.reduce(function(n,o){return o(n,m);},l);};function k(){h.apply(this,arguments);}f.exports=new k(c('FantaDispatcher'));}),null);
__d('FantaReducersSharePreview',['Bootloader','FantaMessageActions','FantaTabActions','FantaTypeSharePreview','immutable','ifRequired','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('FantaMessageActions').Types,i=c('FantaTabActions').Types,j='scraperLastPermissiveMatch';function k(r,s){switch(s.type){case h.COMPOSER_TEXT_UPDATE:var t=s.message,u=s.threadID;r=l(r,t,u);}return r;}function l(r,s,t){c('ifRequired')('URLMatcher',function(u){c('ifRequired')('DataStore',function(v){if(s.length===0){v.remove(t,j);}else{if(!r.mercury.tabContents.get(t))return r;if(!u.trigger(s+' ')){var w=u.match(s),x=u.permissiveMatch(s);if(x&&x!==v.get(t,j)){v.set(t,j,x);r=r.mergeIn(['mercury','tabContents',t,'sharePreview'],{params:null,type:null,uri:w||x});}}}});},function(){c('Bootloader').loadModules(["URLMatcher","DataStore"],function(u,v){if(s.length>0)c('setImmediate')(function(){c('FantaMessageActions').composerTextUpdate(t,s);});},'FantaReducersSharePreview');});return r;}function m(r,s){switch(s.type){case h.LINK_PREVIEW:var t=s.uri,u=s.tabID;if(!r.mercury.tabContents.get(u))return r;r=r.mergeIn(['mercury','tabContents',u,'sharePreview'],{params:null,type:null,uri:t});}return r;}function n(r,s){switch(s.type){case h.LOADED_SHARE_DATA:var t=s.attachmentData,u=s.tabID,v=t.share_data;if(!r.mercury.tabContents.get(u))return r;r=r.mergeIn(['mercury','tabContents',u,'sharePreview'],{isLoading:false,params:c('immutable').Map({data:v.share_params}),type:v.share_type});}return r;}function o(r,s){switch(s.type){case h.LOADING_SHARE_DATA:var t=s.tabID;if(!r.mercury.tabContents.get(t))return r;r=r.mergeIn(['mercury','tabContents',t,'sharePreview'],{isLoading:true,params:null,type:null});}return r;}function p(r,s){switch(s.type){case i.CLOSE_ALL_TABS:var t=r.tabGroup.tabs.keys();for(var u=t,v=Array.isArray(u),w=0,u=v?u:u[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var x;if(v){if(w>=u.length)break;x=u[w++];}else{w=u.next();if(w.done)break;x=w.value;}var y=x;r=q(r,y);}break;case i.CLOSE_TAB:case i.CLOSE_AND_TAB_NEXT:case h.REMOVE_SHARE_PREVIEW:var z=s.tabID;r=q(r,z);}return r;}function q(r,s){if(!r.mercury.tabContents.get(s))return r;return r.setIn(['mercury','tabContents',s,'sharePreview'],new (c('FantaTypeSharePreview'))());}f.exports={closeTab:p,composerTextUpdate:k,linkPreview:m,loadedShareData:n,loadingShareData:o};}),null);