if (self.CavalryLogger) { CavalryLogger.start_js(["D6a0U"]); }

__d("MessagingThreadEventType",[],(function a(b,c,d,e,f,g){f.exports={ACTIVE:"active",INACTIVE:"inactive"};}),null);
__d("MessagingThreadSourceName",[],(function a(b,c,d,e,f,g){f.exports={CHAT_NUB:"chat_nub",MESSENGER:"messenger"};}),null);
__d('MessagingThreadEventTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:MessagingThreadEventLoggerConfig',this.$MessagingThreadEventTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:MessagingThreadEventLoggerConfig',this.$MessagingThreadEventTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$MessagingThreadEventTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$MessagingThreadEventTypedLogger1=babelHelpers['extends']({},this.$MessagingThreadEventTypedLogger1,j);return this;};h.prototype.setActiveTimeMs=function(j){this.$MessagingThreadEventTypedLogger1.active_time_ms=j;return this;};h.prototype.setClientEventTimeMs=function(j){this.$MessagingThreadEventTypedLogger1.client_event_time_ms=j;return this;};h.prototype.setEvent=function(j){this.$MessagingThreadEventTypedLogger1.event=j;return this;};h.prototype.setPageData=function(j){this.$MessagingThreadEventTypedLogger1.page_data=c('GeneratedLoggerUtils').serializeMap(j);return this;};h.prototype.setPageID=function(j){this.$MessagingThreadEventTypedLogger1.page_id=j;return this;};h.prototype.setScriptPath=function(j){this.$MessagingThreadEventTypedLogger1.script_path=j;return this;};h.prototype.setSource=function(j){this.$MessagingThreadEventTypedLogger1.source=j;return this;};h.prototype.setThreadID=function(j){this.$MessagingThreadEventTypedLogger1.thread_id=j;return this;};h.prototype.setVC=function(j){this.$MessagingThreadEventTypedLogger1.vc=j;return this;};var i={active_time_ms:true,client_event_time_ms:true,event:true,page_data:true,page_id:true,script_path:true,source:true,thread_id:true,vc:true};f.exports=h;}),null);
__d('DocumentTitle',['Arbiter'],(function a(b,c,d,e,f,g){var h=document.title,i=null,j=1500,k=[],l=0,m=null,n=false;function o(){if(k.length>0){if(!n){p(k[l].title);l=++l%k.length;}else q();}else{clearInterval(m);m=null;q();}}function p(s){document.title=s;n=true;}function q(){r.set(i||h,true);n=false;}var r={get:function s(){return h;},set:function s(t,u){document.title=t;if(!u){h=t;i=null;c('Arbiter').inform('update_title',t);}else i=t;},blink:function s(t){var u={title:t};k.push(u);if(m===null)m=setInterval(o,j);return {stop:function v(){var w=k.indexOf(u);if(w>=0){k.splice(w,1);if(l>w){l--;}else if(l==w&&l==k.length)l=0;}}};}};f.exports=r;}),null);
__d('MercuryNotificationRenderer',['fbt','MercuryAssert','MercuryIDs','MercuryMessages','MercuryParticipants','MercuryThreads','MercuryViewer','MessagingGenericAdminTextType'],(function a(b,c,d,e,f,g,h){var i=c('MercuryMessages').get(),j=c('MercuryThreads').get(),k='source:messenger_growth:event_upcoming_bump';function l(m,n){c('MercuryAssert').isThreadID(m);j.getThreadMeta(m,function(o){i.getThreadMessagesRange(m,0,1,function(p){var q=p.length&&p[p.length-1],r=[];if(q.tags!==undefined)r=r.concat(q.tags);if(q.log_message_data&&(q.log_message_data.message_type==c('MessagingGenericAdminTextType').CONFIRM_FRIEND_REQUEST||q.log_message_data.message_type==c('MessagingGenericAdminTextType').WORK_INVITE_CLAIMED)){n(h._("New contact added"));}else if(r.indexOf(k)!==-1){n(h._("You have an upcoming event."));}else if(q&&q.author!=c('MercuryViewer').getID()){c('MercuryParticipants').get(q.author,function(s){var t=s.short_name,u=o.custom_nickname;if(u){var v=c('MercuryIDs').getUserIDFromParticipantID(s.id);if(u[v])t=u[v];}if(o.name){n(h._("{senderName} messaged {groupName}",[h.param('senderName',t),h.param('groupName',o.name)]));}else if(c('MercuryIDs').isGroupChat(m)){n(h._("{name} messaged your group",[h.param('name',t)]));}else n(h._("{name} messaged you",[h.param('name',t)]));});}else n(h._("New message!"));});});}f.exports={renderDocumentTitle:l};}),null);
__d('MercuryUnseenState',['MercuryFolders','KeyedCallbackManager','LogHistory','MercuryActionType','MercuryDispatcher','MercuryGlobalActionType','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInfo','MercuryThreadlistConstants','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','createObjectFrom','isEmpty'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadlistConstants').MAX_UNSEEN_COUNT,i='unseen_thread_hash',j='unseen_thread_list',k=c('LogHistory').getInstance('mercury_unseen_state');l.getForFBID=function(n){return m.getForFBID(n);};l.get=function(){return m.get();};function l(n){this.$MercuryUnseenState2=n;this.$MercuryUnseenState7=c('MercuryServerRequests').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState8=c('MercuryThreadIDMap').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState10=c('MercuryThreads').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState9=c('MercuryThreadInformer').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState1=c('MercuryDispatcher').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState3=0;this.$MercuryUnseenState4=0;this.$MercuryUnseenState5=false;this.$MercuryUnseenState6=false;this.$MercuryUnseenState11=new (c('KeyedCallbackManager'))();this.$MercuryUnseenState1.subscribe('update-unseen',function(o,p){this.$MercuryUnseenState12(p);}.bind(this));this.$MercuryUnseenState1.subscribe('update-thread-ids',function(o,p){this.$MercuryUnseenState13(p);}.bind(this));}l.prototype.getUnseenCount=function(){if(this.exceedsMaxCount()){k.error('unguarded_unseen_count_fetch','{}');return 0;}return this.$MercuryUnseenState14();};l.prototype.exceedsMaxCount=function(){return this.$MercuryUnseenState5||this.$MercuryUnseenState14()>h;};l.prototype.markAsSeen=function(){var n=this.$MercuryUnseenState14();if(n===null){this.$MercuryUnseenState6=true;}else if(n>0||this.$MercuryUnseenState5){this.$MercuryUnseenState7.markSeen();this.$MercuryUnseenState15(this.$MercuryUnseenState7.getLastActionTimestamp(),[]);}};l.prototype.$MercuryUnseenState16=function(n,o){var p;this.$MercuryUnseenState17((p={},p[n]=0,p),o);};l.prototype.$MercuryUnseenState18=function(n){this.$MercuryUnseenState11.setResource(i,n);this.$MercuryUnseenState11.setResource(j,Object.keys(n));};l.prototype.$MercuryUnseenState19=function(n){var o=this.$MercuryUnseenState11.executeOrEnqueue(i,n),p=this.$MercuryUnseenState11.getUnavailableResources(o);if(p.length)this.$MercuryUnseenState7.fetchUnseenThreadIDs();};l.prototype.$MercuryUnseenState20=function(){return this.$MercuryUnseenState11.getResource(i);};l.prototype.$MercuryUnseenState14=function(){var n=this.$MercuryUnseenState11.getResource(j);if(n){return n.length;}else return this.$MercuryUnseenState3;};l.prototype.$MercuryUnseenState12=function(n){var o,p=this,q=this.$MercuryUnseenState21(n);if(n.unseen_thread_fbids){n.unseen_thread_fbids.forEach(function(r){if(r.folder!=c('MessagingTag').INBOX)return;var s=(r.thread_fbids||[]).concat(r.other_user_fbids||[]),t=this.$MercuryUnseenState22(s),u=q.seen_timestamp?q.seen_timestamp:this.$MercuryUnseenState4;this.$MercuryUnseenState15(u,t);if(q.unseen_count>h)this.$MercuryUnseenState5=true;}.bind(this));}else if(q.seen_timestamp!==undefined){this.$MercuryUnseenState4=q.seen_timestamp;if(q.unseen_count>h){this.$MercuryUnseenState5=true;this.$MercuryUnseenState18({});}else{this.$MercuryUnseenState3=q.unseen_count;if(this.$MercuryUnseenState3===0)this.$MercuryUnseenState18({});}}else{var o=function(){var r;(n.global_actions||[]).forEach(function(x){if(x.action_type===c('MercuryGlobalActionType').MARK_ALL_SEEN)this.$MercuryUnseenState15(x.timestamp,[]);}.bind(p));if(p.$MercuryUnseenState5)return {v:void 0};var s=n.actions;if(!s||!s.length)return {v:void 0};var t={},u={},v=function x(y){var z=s[y],aa=z.action_type,ba=z.other_user_fbid?z.other_user_fbid:z.thread_fbid,ca=z.thread_id?z.thread_id:ba;if(aa===c('MercuryActionType').MARK_THREAD_SEEN){p.$MercuryUnseenState16(ca,z.persistent);return 'continue';}if(!p.$MercuryUnseenState23(z))return 'continue';if(aa===c('MercuryActionType').USER_GENERATED_MESSAGE||aa===c('MercuryActionType').LOG_MESSAGE){var da=t[ca]?z.timestamp>t[ca]:false,ea=da||!t[ca];if(z.is_unread&&ea)p.$MercuryUnseenState10.getThreadMeta(ca,function(fa){if(!c('MercuryThreadInfo').isMuted(fa)&&!(fa&&fa.last_read_timestamp>=z.timestamp))t[ca]=z.timestamp;});}else if(aa===c('MercuryActionType').CHANGE_READ_STATUS&&z.mark_as_read)u[ca]=z.timestamp;};for(var w=0;w<s.length;w++){var r=v(w);if(r==='continue')continue;}p.$MercuryUnseenState24(t);p.$MercuryUnseenState17(u);}();if(typeof o==="object")return o.v;}if(this.$MercuryUnseenState6){this.$MercuryUnseenState6=false;this.markAsSeen();}};l.prototype.$MercuryUnseenState15=function(n,o){var p=this.$MercuryUnseenState20();if(p===undefined||n>this.$MercuryUnseenState4||this.$MercuryUnseenState5){this.$MercuryUnseenState4=n;o=o||[];if(o.length<=h)this.$MercuryUnseenState5=false;var q={},r=this.$MercuryUnseenState20();for(var s in r)if(r[s]!==true){var t=r[s];if(this.$MercuryUnseenState25(t))q[s]=t;}var u=Object.assign(c('createObjectFrom')(o,true),q);this.$MercuryUnseenState18(u);this.$MercuryUnseenState9.updatedUnseenState();}};l.prototype.$MercuryUnseenState24=function(n){if(this.$MercuryUnseenState5)return;var o={},p=false;for(var q in n){var r=n[q];if(this.$MercuryUnseenState25(r)){o[q]=r;p=true;}}if(!p)return;this.$MercuryUnseenState19(function(s){for(var t in o){var u=o[t];if(!s[t]&&this.$MercuryUnseenState25(u))s[t]=o[t];}this.$MercuryUnseenState18(s);this.$MercuryUnseenState9.updatedUnseenState();}.bind(this));};l.prototype.$MercuryUnseenState17=function(n,o){if(!c('isEmpty')(n))this.$MercuryUnseenState19(function(p){var q=false;for(var r in n){var s=n[r],t=s>=p[r];if(p[r]&&(!s||t)){delete p[r];q=true;}}if(q){this.$MercuryUnseenState18(p);this.$MercuryUnseenState9.updatedUnseenState();if(o&&this.$MercuryUnseenState14()===0)this.$MercuryUnseenState7.markSeen();}}.bind(this));};l.prototype.$MercuryUnseenState25=function(n){return n>this.$MercuryUnseenState4;};l.prototype.$MercuryUnseenState22=function(n){return n.map(this.$MercuryUnseenState8.convertThreadIDIfAvailable,this.$MercuryUnseenState8);};l.prototype.$MercuryUnseenState13=function(n){var o=this.$MercuryUnseenState20();if(!o)return;for(var p in n){var q=n[p];if(o[p]){o[q]=o[p];delete o[p];}}this.$MercuryUnseenState18(o);};l.prototype.$MercuryUnseenState23=function(n){var o=n.thread_id?this.$MercuryUnseenState10.getThreadMetaNow(n.thread_id):null,p=o?c('MercuryFolders').getFromMeta(o):n.folder;return p===c('MessagingTag').INBOX||p===undefined;};l.prototype.$MercuryUnseenState21=function(n){var o=n.message_counts||[];for(var p=0;p<o.length;p++)if(o[p].folder===c('MessagingTag').INBOX)return o[p];return {};};var m=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d('MessengerDesktopNotificationPermissions',[],(function a(b,c,d,e,f,g){var h={DEFAULT:'default',DENIED:'denied',GRANTED:'granted'};f.exports=h;}),null);
__d('MessengerDesktopNotifications',['Map','MessengerDesktopNotificationPermissions','Run','UserAgent'],(function a(b,c,d,e,f,g){'use strict';var h=5000,i=new (c('Map'))();function j(){i.forEach(function(l,m,n){l.close&&l.close();});}var k={_closeTimer:null,isSupported:function l(){return !!window.Notification;},checkPermission:function l(){if(window.Notification)return window.Notification.permission;},hasDefaultSound:function l(){return c('UserAgent').isBrowser('FireFox')&&c('UserAgent').isPlatform('Mac OS X');},isDenied:function l(){return this.checkPermission()===c('MessengerDesktopNotificationPermissions').DENIED;},isGranted:function l(){return this.checkPermission()===c('MessengerDesktopNotificationPermissions').GRANTED;},requestPermission:function l(m){if(window.Notification)window.Notification.requestPermission(m);},showNotification:function l(m){if(this.isGranted()){var n=window.Notification?new window.Notification(m.title,{body:m.body,icon:m.icon,tag:m.tag}):{};i.set(m.tag,n);n.onclick=m.onClick;n.onclose=function(){i['delete'](m.tag);};this._closeTimer=setTimeout(function(){n.close();},m.closeTime||h);return n;}else return null;}};c('Run').onUnload(j);f.exports=k;}),null);
__d("XMessengerDotComSettingsEditController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/settings\/edit\/",{});}),null);
__d('MessengerSettingsActions',['AsyncRequest','CurrentEnvironment','MessengerDispatcher','MessengerDesktopNotifications','MessengerDesktopNotificationPermissions','MessengerURIConstants','XMessengerDotComSettingsEditController','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({CHANGE_SETTINGS:null,CHANGE_DESKTOP_NOTIFS:null}),i={Types:h,changeSettings:function j(k){var l=c('XMessengerDotComSettingsEditController').getURIBuilder().getURI();if(c('CurrentEnvironment').facebookdotcom)l.setPath(c('MessengerURIConstants').FACEBOOK_PREFIX+l.getPath());new (c('AsyncRequest'))().setData({settings:k}).setURI(l).send();c('MessengerDispatcher').dispatch({type:h.CHANGE_SETTINGS,newSettings:k});},changeDesktopNotifs:function j(k,l){if(k&&!c('MessengerDesktopNotifications').isGranted()){c('MessengerDesktopNotifications').requestPermission(function(m){if(m!==c('MessengerDesktopNotificationPermissions').GRANTED){if(c('MessengerDesktopNotifications').checkPermission()===c('MessengerDesktopNotificationPermissions').DENIED)l&&l();return;}c('MessengerDispatcher').dispatch({type:h.CHANGE_DESKTOP_NOTIFS,desktopNotifsEnabled:k});});}else c('MessengerDispatcher').dispatch({type:h.CHANGE_DESKTOP_NOTIFS,desktopNotifsEnabled:k});}};f.exports=i;}),null);
__d('MessengerSettingsStore',['CacheStorage','MessengerSettingsActions','MessengerStore','MessengerDotComSettingsInitialData'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=new (c('CacheStorage'))('localstorage'),k='desktopNotifsEnabled';h=babelHelpers.inherits(l,c('MessengerStore'));i=h&&h.prototype;function l(){i.constructor.call(this);this.$MessengerSettingsStore1=babelHelpers['extends']({},c('MessengerDotComSettingsInitialData'),{desktopNotifsEnabled:this.$MessengerSettingsStore2()});}l.prototype.getSettings=function(){return this.$MessengerSettingsStore1;};l.prototype.$MessengerSettingsStore2=function(){return j.get(k,false);};l.prototype.$MessengerSettingsStore3=function(m){j.set(k,m);};l.prototype.__onDispatch=function(m){switch(m.type){case c('MessengerSettingsActions').Types.CHANGE_SETTINGS:this.$MessengerSettingsStore1=babelHelpers['extends']({},this.$MessengerSettingsStore1,m.newSettings);this.emitChange();break;case c('MessengerSettingsActions').Types.CHANGE_DESKTOP_NOTIFS:this.$MessengerSettingsStore1=babelHelpers['extends']({},this.$MessengerSettingsStore1,{desktopNotifsEnabled:m.desktopNotifsEnabled});this.$MessengerSettingsStore3(m.desktopNotifsEnabled);this.emitChange();break;}};f.exports=new l();}),null);
__d('MessengerLoggerUtils',['MercuryIDs','MessagingThreadEventType','MessagingThreadEventTypedLogger','MessagingThreadSourceName','ScriptPath','pageID'],(function a(b,c,d,e,f,g){var h={logThreadChangeEvent:function i(j,k,l,m){if(l.activeThreadID&&j)this.log({activeThreadID:l.activeThreadID,event:c('MessagingThreadEventType').INACTIVE,clientEventTimeMs:k,activeTimeMs:k-j});if(m.activeThreadID)this.log({activeThreadID:m.activeThreadID,event:c('MessagingThreadEventType').ACTIVE,clientEventTimeMs:k,activeTimeMs:0});},log:function i(j){var k=c('MercuryIDs').tokenize(j.activeThreadID.toString()),l=c('ScriptPath').getPageInfo();new (c('MessagingThreadEventTypedLogger'))().setEvent(j.event).setClientEventTimeMs(j.clientEventTimeMs).setActiveTimeMs(j.activeTimeMs).setPageID(c('pageID')).setPageData(l?l.extraData:{}).setThreadID(k.value).setSource(c('MessagingThreadSourceName').MESSENGER).log();}};f.exports=h;}),null);
__d('MessengerStateStore',['MessengerActions','MessengerLoggerUtils','MessengerStore'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('MessengerStore'));i=h&&h.prototype;function j(){i.constructor.call(this);this.$MessengerStateStore1={activeThreadID:null,detailView:null,filter:null,folder:null,masterView:null,query:null,mid:null,serverThreadID:null};this.$MessengerStateStore2=babelHelpers['extends']({},this.$MessengerStateStore1);this.$MessengerStateStore4=this.$MessengerStateStore3=null;}j.prototype.getState=function(){return this.$MessengerStateStore1;};j.prototype.getPrevState=function(){return this.$MessengerStateStore2;};j.prototype.__onDispatch=function(k){switch(k.type){case c('MessengerActions').Types.REPLACE_STATE:this.$MessengerStateStore2=this.$MessengerStateStore1;this.$MessengerStateStore4=this.$MessengerStateStore3;this.$MessengerStateStore1=babelHelpers['extends']({activeThreadID:null,detailView:null,filter:null,folder:null,masterView:null,query:null,mid:null,serverThreadID:null},k.nextState);var l=Date.now();this.$MessengerStateStore3=l;c('MessengerLoggerUtils').logThreadChangeEvent(this.$MessengerStateStore4,l,this.$MessengerStateStore2,this.$MessengerStateStore1);this.emitChange();break;}};f.exports=new j();}),null);
__d('SoundSynchronizer',['SoundPlayer','WebStorage','createArrayFromMixed'],(function a(b,c,d,e,f,g){var h='fb_sounds_playing3';function i(){var m=c('WebStorage').getLocalStorage();if(m)try{var n=m[h];if(n){n=JSON.parse(n);if(Array.isArray(n))return n;}}catch(o){}return [];}function j(m){var n=c('WebStorage').getLocalStorage();if(n){var o=i();o.push(m);while(o.length>5)o.shift();try{n[h]=JSON.stringify(o);}catch(p){}}}function k(m){return i().some(function(n){return n===m;});}var l={play:function m(n,o,p){n=c('createArrayFromMixed')(n);o=o||n[0]+Math.floor(Date.now()/1000);if(k(o))return;c('SoundPlayer').play(n,{loop:!!p});j(o);},isSupported:function m(){return !!c('WebStorage').getLocalStorage();}};f.exports=l;}),null);
__d('SoundRPC',['Event','FBJSON','SoundSynchronizer'],(function a(b,c,d,e,f,g){function h(j,k,l){c('SoundSynchronizer').play(j,k,l);}var i={playLocal:h,playRemote:function j(k,l,m,n){var o={name:'SoundRPC',data:{paths:l,sync:m,loop:n}};k.postMessage(c('FBJSON').stringify(o),'*');},supportsRPC:function j(){return !!window.postMessage;},_listen:function j(){c('Event').listen(window,'message',function(k){if(!/\.facebook.com$/.test(k.origin))return;var l={};try{l=c('FBJSON').parse(k.data);}catch(m){}if(l.name==='SoundRPC')h(l.data.paths,l.data.sync,l.data.loop);});}};f.exports=i;}),null);
__d('Sound',['SoundInitialData','SoundPlayer','SoundRPC','SoundSynchronizer','URI','UserAgent_DEPRECATED','Visibility','isFacebookURI'],(function a(b,c,d,e,f,g){var h=null,i=false,j={init:function n(o){},play:function n(o,p,q){if(h){c('SoundRPC').playRemote(h.contentWindow,o,p,false);}else c('SoundRPC').playLocal(o,p,q);i=true;},hasPlayedSoundBefore:function n(){return i;},playOnlyIfImmediate:function n(o,p,q){if(!i&&c('Visibility').isHidden())return;this.play(o,p,q);},stop:function n(o){if(!h)c('SoundPlayer').stop(o);}},k=new (c('URI'))(location.href);if(k.getSubdomain()&&k.getSubdomain()!=='www')k.setSubdomain('www');var l=k.getDomain();function m(){if(c('UserAgent_DEPRECATED').ie()<9)return false;if(c('SoundInitialData').RPC_DISABLED)return false;return c('SoundSynchronizer').isSupported()&&c('SoundRPC').supportsRPC();}if(c('isFacebookURI')(k)&&location.host!==l&&m()){h=document.createElement('iframe');h.setAttribute('src','//'+l+'/sound_iframe.php');h.style.display='none';document.body.appendChild(h);}f.exports=j;}),null);
__d('mercuryBlockedParticipantsRe',['Set','utilsRe','bs_caml_obj','bs_js_boolean','MercuryIDs','CurrentUser','bs_js_primitive','MercuryDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h={};function i(p,q){var r=h[p];if(r!==undefined){var s=q.participants.filter(function(t){return c('bs_caml_obj').caml_notequal(t,c('MercuryIDs').getParticipantIDFromUserID(p));});return s.filter(function(t){return +(+r.has(t)!==0);});}else return [];}function j(p,q){return c('bs_js_boolean').to_js_boolean(1- +q.is_canonical&&+(i(p,q).length>0));}function k(p,q){if(q.is_canonical){return [];}else return i(p,q);}function l(p,q){var r=h[p],s=+q.is_canonical;if(s!==0){if(r!==undefined){var t=q.participants.filter(function(u){return c('bs_caml_obj').caml_notequal(u,c('MercuryIDs').getParticipantIDFromUserID(p));});return c('bs_js_boolean').to_js_boolean(1- +t.every(function(u){return 1- +r.has(u);}));}else return false;}else return false;}function m(p){var q=h[p];if(q===undefined){h[p]=new (c('Set'))();var r=c('MercuryDispatcher').getForFBID(p);r.subscribe("update-blocked-users",function(s,t){var u=h[p],v=t.message_blocked_ids;if(!c('bs_js_primitive').is_nil_undef(v)){var w=new (c('Set'))(v);h[p]=w;}var x=c('utilsRe').$pipe$unknown(c('bs_js_primitive').null_undefined_to_opt(t.participants),[]);x.forEach(function(y){var z=c('utilsRe').nullUndefinedBooleanToOptionBool(y.is_messenger_blocked),aa=y.fbid;if(z){if(z[0]!==0){if(!c('bs_js_primitive').is_nil_undef(aa)&&u!==undefined){u.add(c('MercuryIDs').getParticipantIDFromUserID(aa));return 0;}else return 0;}else if(!c('bs_js_primitive').is_nil_undef(aa)&&u!==undefined){+u['delete'](c('MercuryIDs').getParticipantIDFromUserID(aa));return 0;}else return 0;}else return 0;});return 0;});}return {findIntersection:function s(t){return i(p,t);},isPresentInGroupThread:function s(t){return j(p,t);},inGroupThread:function s(t){return k(p,t);},isMessageBlocked:function s(t){return l(p,t);},__fbid:p};}function n(){return m(c('CurrentUser').getID());}var o=c('utilsRe').$pipe$unknown;g.$pipe$unknown=o;g.blockedIdsPerFBID=h;g.findIntersection=i;g.isPresentInGroupThread=j;g.inGroupThread=k;g.isMessageBlocked=l;g.getForFBID=m;g.get=n;}),null);
__d('MessengerBrowserAlerts',['fbt','DocumentTitle','Event','ImageSourceRequest','ImageSourceType','Map','MercuryAttachmentSnippetRenderer','mercuryBlockedParticipantsRe','MercuryIDs','MercuryLogMessageType','MercuryParticipants','MercuryThreadInfo','MercuryThreadInformer','MercuryThreads','MercuryUnseenState','MessagingTag','MessengerActions','MessengerConfig','MessengerDesktopNotifications','MessengerEnvironment','MessengerFaviconUrls','MessengerSettingsStore','MessengerStateStore','MercuryNotificationRenderer','PhotoResizeModeConst','Sound','UserActivity'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('mercuryBlockedParticipantsRe').get(),j=8000,k=80,l=3,m=600000,n=new (c('Map'))(),o=0,p=null;function q(){n=new (c('Map'))();}function r(u){if(c('MessengerSettingsStore').getSettings().sound_enabled)c('Sound').play([c('MessengerConfig')['sound.notif_ogg_url'],c('MessengerConfig')['sound.notif_mp3_url']],u,false);}function s(u,v,w){if(!u.snippet_sender)return;var x=n.get(u.thread_id)||0;if(x>=l)return;n.set(u.thread_id,x+1);c('MercuryParticipants').get(u.snippet_sender,function(y){var z=u.snippet,aa=u.custom_nickname&&u.custom_nickname[c('MercuryIDs').getUserIDFromParticipantID(y.id)],ba=aa?aa:y.short_name;if(!z&&u.snippet_attachments&&u.snippet_attachments.length>0)z=c('MercuryAttachmentSnippetRenderer').renderAttachmentSnippetText(c('MercuryAttachmentSnippetRenderer').getAttachmentSnippetType(u.snippet_attachments),false,ba,u.snippet_attachments);var ca=aa?aa:y.name;if(!u.is_canonical)ca=u.name?h._("{sender's name} to {group name}",[h.param('sender\'s name',ba),h.param('group name',u.name)]):h._("{sender's name} to your group",[h.param('sender\'s name',ba)]);c('MessengerDesktopNotifications').showNotification({title:ca,body:z,icon:u.image_src||v||y.big_image_src||y.image_src,closeTime:null,onClick:function da(){window.focus();c('MessengerActions').selectThread(u.thread_id);},tag:w.message_id});if(!c('MessengerDesktopNotifications').hasDefaultSound())r(w.timestamp);});}var t={init:function u(v){this._viewer=v;this._threadInformer=c('MercuryThreadInformer').getForFBID(this._viewer);this._threads=c('MercuryThreads').getForFBID(this._viewer);this._unseenState=c('MercuryUnseenState').getForFBID(this._viewer);this._highResImageMap=new (c('Map'))();c('Event').listen(window,'focus',function(){q();clearInterval(o);});c('Event').listen(window,'blur',function(){o=setInterval(q,m);});this._threadInformer.subscribe('messages-received',function(w,x){for(var y in x)x[y].forEach(function(z){this.handleMessageReceived(z);}.bind(this));}.bind(this));this._threadInformer.subscribe('unseen-updated',this._handleUnseenUpdated.bind(this));},handleMessageReceived:function u(v){if(v.author===this._viewer||!v.is_unread||v.thread_id===c('MessengerStateStore').getState().activeThreadID&&c('UserActivity').isOnTab()||v.folder!=c('MessagingTag').INBOX&&v.folder!=c('MessagingTag').ARCHIVED)return;this._threads.getThreadMeta(v.thread_id,function(w){if(c('MercuryThreadInfo').isMuted(w))if(!c('MercuryThreadInfo').areMentionsMuted(w)){if(!v.profile_ranges||!v.profile_ranges.some||!v.profile_ranges.some(function(x){return x.id===this._viewer;}.bind(this)))return;}else return;if(i.isPresentInGroupThread(w))return;if(c('MessengerSettingsStore').getSettings().desktopNotifsEnabled&&!c('UserActivity').isOnTab()){this._attemptDesktopNotification(w,v);}else if(v.log_message_type!==c('MercuryLogMessageType').UNSUBSCRIBE)r(v.timestamp);if(!c('UserActivity').isOnTab()&&this._unseenState.getUnseenCount()>0)c('MercuryNotificationRenderer').renderDocumentTitle(v.thread_id,function(x){if(!p)p=c('DocumentTitle').blink(x);});}.bind(this));},showRTCNotification:function u(v,w){if(c('UserActivity').isOnTab()){w(null);return;}var x=v.peerID;if(!this._highResImageMap.has(x)){var y=function(z,aa){this._highResImageMap.set(x.toString(),aa.uri);this._displayRTCDesktopNotification(aa.uri,v,w);}.bind(this);new (c('ImageSourceRequest'))().setFBID(x).setType(c('ImageSourceType').PROFILE_PICTURE).setDimensions(k,k).setResizeMode(c('PhotoResizeModeConst').COVER).setCallback(y.bind(null,x)).send();}else this._displayRTCDesktopNotification(this._highResImageMap.get(x),v,w);},_updateFavicon:function u(v){if(c('MessengerEnvironment').facebookdotcom)return;var w=document.querySelector('link[rel*=icon][href*=".ico"]');if(v===0){w.href=c('MessengerFaviconUrls')['default'];}else w.href=c('MessengerFaviconUrls').unread;},_displayRTCDesktopNotification:function u(v,w,x){var y=c('MercuryIDs').getParticipantIDFromUserID(w.peerID),z=null;c('MercuryParticipants').get(y,function(aa){var ba=void 0;if(w.isVideoCall){ba=h._("Incoming Video Call");}else ba=h._("Incoming Audio Call");var ca=h._("{caller} is calling you. Click to answer.",[h.param('caller',aa.short_name)]);z=c('MessengerDesktopNotifications').showNotification({title:ba,body:ca,icon:v,closeTime:j,onClick:function da(){window.focus();w.onNotificationClicked();}});x(z);});},_handleUnseenUpdated:function u(){var v=this._unseenState.getUnseenCount();if(c('UserActivity').isOnTab()&&c('UserActivity').isActive()&&v>0){this._updateFavicon(0);this._unseenState.markAsSeen();return;}var w=c('DocumentTitle').get(),x=v?'('+v+') '+w:w;c('DocumentTitle').set(x,true);this._updateFavicon(v);if(p&&v===0){p.stop();p=null;}if(!this._focusToken&&v>0)this._focusToken=c('UserActivity').subscribe(function(){if(c('UserActivity').isOnTab()){this._focusToken&&this._focusToken.unsubscribe();this._focusToken=null;this._unseenState.markAsSeen();}}.bind(this));},_attemptDesktopNotification:function u(v,w){if(!v.snippet_sender)return;if(!this._highResImageMap.has(v.snippet_sender)){var x=function(y,z){this._highResImageMap.set(v.snippet_sender,z.uri);s(v,z.uri,w);}.bind(this);new (c('ImageSourceRequest'))().setFBID(c('MercuryIDs').getUserIDFromParticipantID(v.snippet_sender)).setType(c('ImageSourceType').PROFILE_PICTURE).setDimensions(k,k).setResizeMode(c('PhotoResizeModeConst').COVER).setCallback(x.bind(null,v.snippet_sender)).send();}else s(v,this._highResImageMap.get(v.snippet_sender),w);}};f.exports=t;}),null);
__d('MessengerRTCIncomingDialog.react',['cx','fbt','ImageBlock.react','MercuryIDs','MercuryParticipants','messengerDialogsRe','messengerContactImageReact','MessengerDialog.react','messengerDialogBodyReact','MessengerDialogButton.react','MessengerDialogFooter.react','MessengerDialogHeader.react','MessengerSpinner.react','React','StoreAndPropBasedStateMixin'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('messengerContactImageReact').jsComponent,k=c('messengerDialogBodyReact').jsComponent,l=c('React').PropTypes,m=50,n=c('React').createClass({displayName:'MessengerRTCIncomingDialog',mixins:[c('StoreAndPropBasedStateMixin')(c('MercuryParticipants'))],propTypes:{callerID:l.string.isRequired,onAccept:l.func.isRequired,onDecline:l.func.isRequired,isVideoCall:l.bool.isRequired},statics:{calculateState:function o(p){return {callerParticipant:c('MercuryParticipants').getOrFetch(c('MercuryIDs').getParticipantIDFromUserID(p.callerID))};}},render:function o(){return c('React').createElement(c('MessengerDialog.react'),{layerHideOnBlur:false,shown:true,onToggle:this._handleToggle,width:400},c('React').createElement(c('MessengerDialogHeader.react'),null,this._dialogTitle()),c('React').createElement(k,null,this._renderDialogBody()),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Decline"),onClick:this._handleDecline,type:'secondary'}),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Accept"),onClick:this._handleAccept,type:'primary'})));},_dialogTitle:function o(){if(this.props.isVideoCall)return i._("Incoming Video Call");return i._("Incoming Audio Call");},_renderDialogBody:function o(){var p=this.state.callerParticipant;if(!p)return c('React').createElement(c('MessengerSpinner.react'),null);return c('React').createElement(c('ImageBlock.react'),null,c('React').createElement(j,{isMessengerUser:p.is_messenger_user,size:m,src:p.big_image_src||p.image_src}),c('React').createElement('div',{className:"_2n1r"},c('React').createElement('div',{className:"_2n1s"},i._("{caller name} is calling you.",[i.param('caller name',p.name)])),c('React').createElement('div',{className:"_2n1t"},i._("The call will start as soon as you answer."))));},_handleDecline:function o(event){event.preventDefault();c('messengerDialogsRe').removeAllDialogs();this.props.onDecline();},_handleAccept:function o(event){event.preventDefault();c('messengerDialogsRe').removeAllDialogs();this.props.onAccept();},_handleToggle:function o(p){if(!p){c('messengerDialogsRe').removeAllDialogs();this.props.onDecline();}}});f.exports=n;}),null);
__d('FBRTCSoundController',['RTCConfig','Sound'],(function a(b,c,d,e,f,g){var h=[c('RTCConfig').ringtone_mp3_url,c('RTCConfig').ringtone_ogg_url],i={playIncomingRingtone:function j(k,l,m){var n=['incoming_ringtone',k.toString(),l.toString()].join('_');c('Sound').play(h,n,m);},stopIncomingRingtone:function j(){c('Sound').stop(h);}};f.exports=i;}),null);
__d('MessengerRTCIncomingDialogController',['FBRTCConstants','FBRTCSoundController','MessengerRTCIncomingDialog.react','messengerDialogsRe','MessengerBrowserAlerts','React','RTCConfig','VideoCallTypedLogger','mixInEventEmitter','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=70000;function i(j,k){this.$MessengerRTCIncomingDialogController1=j;this.$MessengerRTCIncomingDialogController2=k;this.$MessengerRTCIncomingDialogController3=null;this.$MessengerRTCIncomingDialogController4=null;this.$MessengerRTCIncomingDialogController5=false;}i.prototype.showIncomingDialog=function(j){this.timeout=c('setTimeoutAcrossTransitions')(this.$MessengerRTCIncomingDialogController6.bind(this),h);var k=j===c('FBRTCConstants').IncomingCallDialogTypes.VIDEO;c('FBRTCSoundController').playIncomingRingtone(this.$MessengerRTCIncomingDialogController2,this.$MessengerRTCIncomingDialogController1,true);c('messengerDialogsRe').showDialog(function(){return c('React').createElement(c('MessengerRTCIncomingDialog.react'),{callerID:this.$MessengerRTCIncomingDialogController1.toString(),onAccept:this.$MessengerRTCIncomingDialogController7.bind(this),onDecline:this.$MessengerRTCIncomingDialogController8.bind(this),isVideoCall:k});}.bind(this));if(c('RTCConfig').BrowserNotificationGK)this.$MessengerRTCIncomingDialogController9(k);};i.prototype.$MessengerRTCIncomingDialogController9=function(j){var k={peerID:this.$MessengerRTCIncomingDialogController1,onNotificationClicked:this.$MessengerRTCIncomingDialogController7.bind(this),isVideoCall:j};c('MessengerBrowserAlerts').showRTCNotification(k,function(l){this.$MessengerRTCIncomingDialogController4=l;if(this.$MessengerRTCIncomingDialogController5)this.$MessengerRTCIncomingDialogController10();}.bind(this));};i.prototype.cancel=function(){if(this.timeout)clearTimeout(this.timeout);c('messengerDialogsRe').removeDialog();c('FBRTCSoundController').stopIncomingRingtone();if(this.$MessengerRTCIncomingDialogController4)this.$MessengerRTCIncomingDialogController10();this.$MessengerRTCIncomingDialogController5=true;};i.prototype.isForPeer=function(j){return this.$MessengerRTCIncomingDialogController1===j;};i.prototype.isForCall=function(j){return this.$MessengerRTCIncomingDialogController2===j;};i.prototype.isForPeerAndCall=function(j,k){return this.$MessengerRTCIncomingDialogController1===j&&this.$MessengerRTCIncomingDialogController2===k;};i.prototype.$MessengerRTCIncomingDialogController7=function(){this.cancel();new (c('VideoCallTypedLogger'))().setEvent('accept_call_click').log();this.emit('answerCall',null);};i.prototype.$MessengerRTCIncomingDialogController8=function(){this.cancel();this.emit('ignoreCall');};i.prototype.$MessengerRTCIncomingDialogController6=function(){this.cancel();this.emit('timeout');};i.prototype.$MessengerRTCIncomingDialogController10=function(){this.$MessengerRTCIncomingDialogController4.close();this.$MessengerRTCIncomingDialogController4=null;};c('mixInEventEmitter')(i,{answerCall:true,ignoreCall:true,timeout:true});f.exports=i;}),null);
__d('MessengerRTCMissedCallDialog.react',['cx','fbt','ImageBlock.react','MercuryIDs','MercuryParticipants','messengerDialogsRe','messengerContactImageReact','MessengerDialog.react','messengerDialogBodyReact','MessengerDialogButton.react','MessengerDialogFooter.react','MessengerDialogHeader.react','MessengerDialogTitle.react','MessengerSpinner.react','React','MNRTCCallabilityStore','StoreAndPropBasedStateMixin','Timestamp.react'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('messengerContactImageReact').jsComponent,k=c('messengerDialogBodyReact').jsComponent,l=c('React').PropTypes,m=50,n=c('React').createClass({displayName:'MessengerRTCMissedCallDialog',mixins:[c('StoreAndPropBasedStateMixin')(c('MercuryParticipants'),c('MNRTCCallabilityStore'))],propTypes:{peerID:l.string.isRequired,timeMissed:l.number.isRequired},statics:{calculateState:function o(p){var q=p.peerID;return {calleeParticipant:c('MercuryParticipants').getOrFetch(c('MercuryIDs').getParticipantIDFromUserID(q))};}},render:function o(){return c('React').createElement(c('MessengerDialog.react'),{layerHideOnBlur:true,onToggle:this._handleToggle,shown:true,width:400},c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogTitle.react'),null,i._("Missed Call"))),c('React').createElement(k,null,this._renderBody()),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Close"),onClick:this._handleClose,type:'secondary'}),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Call Back"),onClick:this._handleCallBack,type:'primary'})));},_renderBody:function o(){var p=this.state.calleeParticipant;if(!p)return c('React').createElement(c('MessengerSpinner.react'),null);return c('React').createElement(c('ImageBlock.react'),null,c('React').createElement(j,{isMessengerUser:p.is_messenger_user,size:m,src:p.big_image_src||p.image_src}),c('React').createElement('div',{className:"_2r2t"},c('React').createElement('div',{className:"_2r2u"},i._("You missed a call from {caller name}",[i.param('caller name',p.name)])),c('React').createElement('div',{className:"_2r2v"},c('React').createElement(c('Timestamp.react'),{time:this.props.timeMissed,autoUpdate:true}))));},_handleCallBack:function o(event){event.preventDefault();c('messengerDialogsRe').removeDialog(n);var p=this.state.calleeParticipant;e(['FBRTCCore'],function(q){q.startOutgoingCall(p.fbid,'messenger_dot_com',false);});},_handleClose:function o(event){event.preventDefault();c('messengerDialogsRe').removeDialog(n);},_handleToggle:function o(p){if(!p)c('messengerDialogsRe').removeDialog(n);}});f.exports=n;}),null);
__d('MessengerRTCMissedCallDialogController',['messengerDialogsRe','MessengerRTCMissedCallDialog.react','React'],(function a(b,c,d,e,f,g){'use strict';var h={onCallMissed:function i(j){this._missedCallPeerID=j;},showDialog:function i(){if(!this._missedCallPeerID)return;c('messengerDialogsRe').showDialog(function(){return c('React').createElement(c('MessengerRTCMissedCallDialog.react'),{peerID:this._missedCallPeerID.toString(),timeMissed:Date.now()});}.bind(this));},hideDialog:c('messengerDialogsRe').removeAllDialogs};f.exports=h;}),null);
__d('MessengerRTCUnsupportedBrowserDialog.react',['cx','fbt','Link.react','messengerDialogsRe','MessengerDialog.react','messengerDialogBodyReact','MessengerDialogButton.react','MessengerDialogFooter.react','MessengerDialogHeader.react','React','UserAgent'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('messengerDialogBodyReact').jsComponent;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;m.prototype.render=function(){return c('React').createElement(c('MessengerDialog.react'),{onToggle:this.$MessengerRTCUnsupportedBrowserDialog1},c('React').createElement(c('MessengerDialogHeader.react'),null,i._("Switch Browsers to Make Calls")),c('React').createElement(l,null,i._("Unfortunately, {browser name, i.e. Internet Explorer or Safari} doesn't support our new video calling feature yet. To make a call, open Messenger.com in {link to install chrome} or {link to install firefox} .",[i.param('browser name, i.e. Internet Explorer or Safari',this.$MessengerRTCUnsupportedBrowserDialog2()),i.param('link to install chrome',this.$MessengerRTCUnsupportedBrowserDialog3()),i.param('link to install firefox',this.$MessengerRTCUnsupportedBrowserDialog4())])),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogButton.react'),{className:"_30vt",label:i._("Learn More"),onClick:this.$MessengerRTCUnsupportedBrowserDialog5,type:'secondary',href:'https://www.facebook.com/help/211644178877843',target:'_blank'}),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("OK"),onClick:this.$MessengerRTCUnsupportedBrowserDialog6,type:'primary'})));};m.prototype.$MessengerRTCUnsupportedBrowserDialog3=function(){return c('React').createElement(c('Link.react'),{onClick:this.$MessengerRTCUnsupportedBrowserDialog6,href:'https://www.google.com/chrome/index.html',target:'_blank'},'Google Chrome');};m.prototype.$MessengerRTCUnsupportedBrowserDialog4=function(){return c('React').createElement(c('Link.react'),{onClick:this.$MessengerRTCUnsupportedBrowserDialog6,href:'https://www.mozilla.org/en-US/firefox/new/',target:'_blank'},'Mozilla Firefox');};m.prototype.$MessengerRTCUnsupportedBrowserDialog2=function(){if(c('UserAgent').isBrowser('IE'))return 'Internet Explorer';if(c('UserAgent').isBrowser('Safari'))return 'Safari';return 'your browser';};m.prototype.$MessengerRTCUnsupportedBrowserDialog5=function(){c('messengerDialogsRe').removeAllDialogs();};m.prototype.$MessengerRTCUnsupportedBrowserDialog6=function(){c('messengerDialogsRe').removeAllDialogs();};m.prototype.$MessengerRTCUnsupportedBrowserDialog1=function(n){if(!n)c('messengerDialogsRe').removeAllDialogs();};function m(){j.apply(this,arguments);}f.exports=m;}),null);
__d('MessengerRTCUnsupportedBrowserDialogController',['messengerDialogsRe','MessengerRTCUnsupportedBrowserDialog.react','React'],(function a(b,c,d,e,f,g){'use strict';var h={_dialog:null,showForIncomingCall:function i(j,k){c('messengerDialogsRe').showDialog(function(){return c('React').createElement(c('MessengerRTCUnsupportedBrowserDialog.react'),null);});},dismiss:c('messengerDialogsRe').removeAllDialogs};f.exports=h;}),null);
__d('FBRTCStore',['FBRTCDispatcher','FluxStore'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;function j(){i.constructor.call(this,c('FBRTCDispatcher'));}j.prototype.__emitChange=function(){this.__emitter.emit(this.__changeEvent);};f.exports=j;}),null);
__d('FBRTCCallBlockingStore',['Arbiter','AsyncRequest','ChannelConstants','FBRTCDispatcher','FBRTCStore','VideoCallTypedLogger','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=false,k=0,l=null,m='call_block_setting_changed';h=babelHelpers.inherits(n,c('FBRTCStore'));i=h&&h.prototype;n.prototype.init=function(o){this.$FBRTCCallBlockingStore1(o);c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('videocall_block_setting'),this.$FBRTCCallBlockingStore2.bind(this));};n.prototype.__onDispatch=function(o){if(o.type!==m)return;this.$FBRTCCallBlockingStore1(o.data);};n.prototype.$FBRTCCallBlockingStore1=function(o){switch(o){case 0:j=false;this.$FBRTCCallBlockingStore3();break;case -1:j=true;this.$FBRTCCallBlockingStore3();break;default:j=true;this.$FBRTCCallBlockingStore4(o);}this.__emitChange();};n.prototype.$FBRTCCallBlockingStore4=function(o){if(l===null)l=c('setTimeoutAcrossTransitions')(this.turnOnVideoCalling.bind(this),o*1000);};n.prototype.getBlockingStatus=function(){return j;};n.prototype.turnOnVideoCalling=function(){new (c('AsyncRequest'))('/ajax/chat/settings.php').setHandler(this.$FBRTCCallBlockingStore5.bind(this)).setData({call_blocked_until:0}).send();};n.prototype.turnOffVideoCalling=function(o){k=o;new (c('AsyncRequest'))('/ajax/chat/settings.php').setHandler(this.$FBRTCCallBlockingStore6.bind(this)).setData({call_blocked_until:o}).send();};n.prototype.$FBRTCCallBlockingStore3=function(){if(l){clearTimeout(l);l=null;}};n.prototype.$FBRTCCallBlockingStore5=function(){c('FBRTCDispatcher').dispatch({type:m,data:0});new (c('VideoCallTypedLogger'))().setEvent(m).setMessage('enable').log();};n.prototype.$FBRTCCallBlockingStore6=function(){c('FBRTCDispatcher').dispatch({type:m,data:k});new (c('VideoCallTypedLogger'))().setEvent(m).setMessage('disable_'+k).log();};n.prototype.$FBRTCCallBlockingStore2=function(o,p){c('FBRTCDispatcher').dispatch({type:m,data:p.obj.value});};function n(){h.apply(this,arguments);}f.exports=new n();}),null);
__d('FBRTCSdpUtils',['UserAgent'],(function a(b,c,d,e,f,g){var h='m=video 0',i='m=video 0 NULL/NULL 0',j=function n(o){return o.match(/^a=rtpmap:(\d+)\s/)[1];},k=function n(o,p,q){var r=j(o[p]),s=o[q].split('RTP/SAVPF'),t=s[1].split(/\s+/),u=t.indexOf(r);t.splice(u,1);s[1]=t.join(' ');o[q]=s.join('RTP/SAVPF');o.splice(p,1);},l=function n(o,p,q){var r=j(o[p]);k(o,p,q);var s=new RegExp('^a=(rtcp-fb|fmtp):'+r+' ');o=o.filter(function(w){return !s.test(w);});var t=new RegExp('^a=fmtp:(\\d+)\\s+apt='+r+'($|;)'),u=o.reduce(function(w,x,y){var z=x.match(t);return z?[].concat(w,[z[1]]):w;},[]).join('|'),v=new RegExp('^a=rtpmap:('+u+')\\s+rtx/|^a=fmtp:('+u+')\\s+apt=');return o.filter(function(w){return !v.test(w);});},m={replaceRTPSAVPFProfile:function n(o){var p='UDP/TLS/RTP/SAVPF',q='RTP/SAVPF';while(o.indexOf(p)>=0)o=o.replace(p,q);return o;},addIceOptionToSdp:function n(o,p){"use strict";var q="a=ice-options:",r=o.indexOf(q);if(r>=0){var s=o.indexOf("\r",r);return [o.slice(0,s)," ",p,o.slice(s)].join('');}var t=q+p,u=o.split("\r\n"),v=false,w=-1;for(var x=0;x<u.length;x++){var y=u[x].slice(0,2);if(y=="s="){v=true;continue;}if(v&&y=="a="){w=x;break;}}if(w>=0){u.splice(w,0,t);return u.join("\r\n");}return [o,t,"\r\n"].join('');},preferIsac:function n(o){var p=o.split("\r\n"),q=-1,r=-1,s=-1;for(var t=0;t<p.length;t++){var u=p[t];if(u.match(/m=audio\s+\d+\s+RTP\/SAVPF(\s+\d+)+/))q=t;if(s===-1&&q>-1&&u.match(/^a=rtpmap:/))s=t;if(u.match(/^a=rtpmap:\d+\s+ISAC\/16000/))r=t;}if(q===-1||r===-1||s===-1)return p.join("\r\n");var v=p[r];k(p,r,q);p.splice(s,0,v);p[q]=p[q].replace('RTP/SAVPF','RTP/SAVPF '+j(v));return p.join("\r\n");},preferCodec:function n(o,p,q){var r=o.split('\r\n'),s=new RegExp('m='+(q?'video':'audio')+'\\s+\\d+\\s+RTP/SAVPF(\\s+\\d+)+'),t=r.findIndex(function(z){return s.test(z);}),u=new RegExp('^a=rtpmap:\\d+\\s+'+p),v=r.findIndex(function(z){return u.test(z);}),w=/^a=rtpmap:/,x=r.findIndex(function(z,aa){return aa>t&&w.test(z);});if(t!==-1&&v!==-1&&x!==-1){var y=r[v];k(r,v,t);r.splice(x,0,y);r[t]=r[t].replace('RTP/SAVPF','RTP/SAVPF '+j(y));}return r.join('\r\n');},disableVideo:function n(o){var p=/m=video\s+\S+/;o=o.replace(p,h);if(c('UserAgent').isBrowser('Firefox <= 37'))o=this._makeDisabledVideoReceiveOnly(o);return o;},_makeDisabledVideoReceiveOnly:function n(o){if(o.indexOf(h)>-1){var p=o.split(h);p[1]=p[1].replace(/send(recv|only)/,'recvonly');o=p.join(h);}return o;},fixMobileIceSdp:function n(o){o=o.replace(/^a=/,'');o=o.split(/\s+username\s+.+password.+/)[0];var p=o.match(/\s+relay\s+|\s+srflx\s+/),q=o.match(/raddr.+rport.+/);if(p&&!q){p=p[0];var r=o.split(p),s=r[1].match(/^(\d+\.\d+\.\d+\.\d+)\s+(\d+)\s+/),t=void 0,u=void 0;if(s){t=s[1];u=s[2];r[1]=r[1].replace(s[0],'');}else{s=r[0].split(/\s+/);t=s[4];u=s[5];}o=''+r[0]+p+'raddr '+t+' rport '+u+' '+r[1];}return o;},addAudioNack:function n(o){var p=[];o=o.split('\r\n').map(function(q){var r='';if(p.length>0&&(/^a=rtpmap:(\d+)/.test(q)||/^a=ssrc/.test(q)||/^m=/.test(q))){r+=this._getrtcpFeedbackLinesFromAudioFMTs(p)+'\r\n';p=[];}if(/^m=audio/.test(q))p=q.match(/^m=audio\s+[\d\/]+\s+[\w\/]+([\s+\d+]+)/)[1].trim().split(' ');return r+q;}.bind(this)).join('\r\n');if(p.length>0)o+='\r\n'+this._getrtcpFeedbackLinesFromAudioFMTs(p);return o;},_getrtcpFeedbackLinesFromAudioFMTs:function n(o){return o.map(function(p){return 'a=rtcp-fb:'+p+' nack';}).join('\r\n');},removeFEC:function n(o){var p=o.split('\r\n'),q=void 0,r=void 0;for(var s=0;s<p.length;s++){if(p[s].match(/^a=rtpmap:\d+\s+red\//))q=s;if(p[s].match(/^m=video/))r=s;}if(q&&r)k(p,q,r);return p.join('\r\n');},removeH264:function n(o){var p=o.split('\r\n'),q=/^a=rtpmap:\d+\s+H264\//,r=p.findIndex(function(u){return q.test(u);}),s=/^m=video/,t=p.findIndex(function(u){return s.test(u);});return r!==-1&&t!==-1?l(p,r,t).join('\r\n'):o;},removeVP9:function n(o){var p=o.split('\r\n'),q=/^a=rtpmap:\d+\s+VP9\//,r=p.findIndex(function(u){return q.test(u);}),s=/^m=video/,t=p.findIndex(function(u){return s.test(u);});return r!==-1&&t!==-1?l(p,r,t).join('\r\n'):o;},isVideoSupported:function n(o){return o&&o.indexOf('m=video')!==-1&&(o.indexOf(h)===-1||o.indexOf(i)!==-1);},setDtlsRole:function n(o,p){if(!o.match(/setup:(active|passive|actpass)/)){return o.replace(/(a=fingerprint:.+)/g,'$1\r\na=setup:'+p);}else return o.replace(/setup:actpass/g,'setup:'+p);},setVideoBitrateConstraint:function n(o){var p=720;if(o.match(/^b=AS:/m))return o;o=o.replace(/^a=mid:video\r\n/m,'a=mid:video\r\nb=AS:'+p+'\r\n');return o;},removeSdparta:function n(o){var p=o.split('\r\n'),q='audio',r=false,s=-1;for(var t=0;t<p.length;t++){var u=p[t];if(u.indexOf('m=audio')===0)q='audio';if(u.indexOf('m=video')===0){r=true;q='video';}if(u.indexOf('a=mid:sdparta_')===0)p[t]='a=mid:'+q;if(u.indexOf('a=group:BUNDLE sdparta_')===0)s=t;}if(s>-1)if(r){p[s]='a=group:BUNDLE audio video';}else p[s]='a=group:BUNDLE audio';return p.join('\r\n');},useDTLSOverCrypto:function n(o){if(!(c('UserAgent').isBrowser('Chrome >= 57')||c('UserAgent').isBrowser('Opera >= 44')))return o;if(!/^a=fingerprint:/m.test(o))return o;return o.split('\r\n').filter(function(p){return p.indexOf('a=crypto:')!==0;}).join('\r\n');},validateOfferSdp:function n(o,p){var q;if(o.split(':')[0]==='LIVE'){var q=function(){var r=/^m=/,s=/^m=audio/,t=/^m=video/,u=/^a=ssrc:/,v=p.split('\r\n'),w=[];for(var x=v.length-1;x>=0;x--)if(r.test(v[x]))w.push(v.splice(x));var y=false,z=false;w.forEach(function(aa){if(s.test(aa[0])&&!y){y=aa.some(function(ba){return u.test(ba);});}else if(t.test(aa[0])&&!z)z=aa.some(function(ba){return u.test(ba);});});return {v:y&&z};}();if(typeof q==="object")return q.v;}return true;},addNullVideo:function n(o){if(o.indexOf('m=video')!==-1)return o;if(o.indexOf('m=audio')===-1)return o+'\r\n'+i;var p=o.split('\r\n'),q=-1;for(var r=0;r<p.length;r++){var s=p[r];if(q>-1){if(!/^[abcik]=/.test(s))break;q=r;}else if(s.indexOf('m=audio')===0)q=r;}p.splice(q+1,0,i);return p.join('\r\n');},hasNullVideo:function n(o){return o.indexOf(i)!==-1;}};f.exports=m;}),null);
__d('FBRTCMessage',['FBRTCConstants','FBRTCExperiment','FBRTCSdpUtils','FBRTCSupport','UserAgent'],(function a(b,c,d,e,f,g){var h='mobile';function i(j){'use strict';if(!this.$FBRTCMessage1(j))throw new Error('invalid webrtc message');this.originalMessageData=j;this.peerID=j.from;this.callID=parseInt(j.call_id,10);this.msg=JSON.parse(j.payload);this.msgType=this.msg.type;this.msgID=this.msg.msg_id;this.ackID=this.msg.ack_id;this.source=j.source;this.peerSupportsVideoInterop=!!this.msg.supports_video_interop;this.$FBRTCMessage2();this.$FBRTCMessage3();this.$FBRTCMessage4();this.$FBRTCMessage5();}i.prototype.$FBRTCMessage1=function(j){'use strict';return j.from&&j.call_id&&j.payload;};i.prototype.$FBRTCMessage2=function(){'use strict';if(c('FBRTCSupport').isVideoInteropSupported()&&this.peerSupportsVideoInterop)return;if(this.isFromMobile())this.disableVideo();};i.prototype.disableVideo=function(){'use strict';if(this.msg.sdp)this.msg.sdp=c('FBRTCSdpUtils').disableVideo(this.msg.sdp);if(this.msgType===c('FBRTCConstants').PayloadType.SET_VIDEO||this.msgType===c('FBRTCConstants').PayloadType.OFFER||this.msgType===c('FBRTCConstants').PayloadType.ICERESTART_OFFER||this.msgType===c('FBRTCConstants').PayloadType.ANSWER||this.msgType===c('FBRTCConstants').PayloadType.ICERESTART_ANSWER)this.msg.videoon=false;};i.prototype.$FBRTCMessage3=function(){'use strict';if(this.isFromMobile()&&this.msg.sdp&&this.msgType!==c('FBRTCConstants').PayloadType.ICE_CANDIDATE)this.msg.sdp=c('FBRTCSdpUtils').removeFEC(this.msg.sdp);};i.prototype.$FBRTCMessage4=function(){'use strict';if(this.isFromMobile()&&c('FBRTCSupport').isWebrtcSupported()&&this.msg.sdp&&this.msgType!==c('FBRTCConstants').PayloadType.ICE_CANDIDATE){var j=c('FBRTCExperiment').gen('rtc_browser_use_h264'),k=j.getParam('allow_h264','no');if(k!=='yes')this.msg.sdp=c('FBRTCSdpUtils').removeH264(this.msg.sdp);}};i.prototype.$FBRTCMessage5=function(){'use strict';if(this.isFromMobile()&&c('FBRTCSupport').isWebrtcSupported()&&this.msg.sdp&&this.msgType!==c('FBRTCConstants').PayloadType.ICE_CANDIDATE){var j=c('FBRTCExperiment').gen('rtc_browser_use_vp9'),k=j.getParam('allow_vp9','no');if(k!=='yes')this.msg.sdp=c('FBRTCSdpUtils').removeVP9(this.msg.sdp);}};i.prototype.isOffer=function(){'use strict';return this.msgType===c('FBRTCConstants').PayloadType.OFFER;};i.prototype.isFromMobile=function(){'use strict';return this.source===h;};i.prototype.isRemoteVideoSupported=function(){'use strict';if(!this.msg.sdp||this.msgType===c('FBRTCConstants').PayloadType.ICE_CANDIDATE)return true;return c('FBRTCSdpUtils').isVideoSupported(this.msg.sdp);};i.prototype.isRetry=function(){'use strict';return !!this.msg.flag;};i.prototype.isForCall=function(j){'use strict';return !j||j===this.callID||this.msgType===c('FBRTCConstants').PayloadType.OFFER||this.msgType===c('FBRTCConstants').PayloadType.ICERESTART_OFFER||this.msgType===c('FBRTCConstants').PayloadType.PCRESTART_OFFER||this.msgType===c('FBRTCConstants').PayloadType.ICE_CANDIDATE;};i.prototype.getSignalingExperiments=function(){'use strict';if(this.isFromMobile()&&!this.msg.experiments)return ['sdp_update'];return this.msg.experiments;};f.exports=i;}),null);
__d("FBRTCMessageDedup",[],(function a(b,c,d,e,f,g){var h={},i={check:function j(k,l,m){if(!h[k])h[k]={};if(!h[k][l])h[k][l]={};if(h[k][l][m])return false;h[k][l][m]=true;return true;}};f.exports=i;}),null);
__d('BanzaiScribe',['Banzai'],(function a(b,c,d,e,f,g){function h(j){return {log:function k(l,m,n){var o=[m];if(n!=null)o.push(n);c('Banzai').post('scribe:'+l,o,j);}};}var i=h({});i.create=h;f.exports=i;}),null);
__d('SamplingPolicyBase',[],(function a(b,c,d,e,f,g){function h(){'use strict';throw new Error('Tried to instantiate SamplingPolicyBase');}h.prototype.getName=function(){'use strict';return this.name;};h.prototype.isSampled=function(){'use strict';if(typeof this.sampled=='undefined')this.sampled=this.decideIfSampled();return this.sampled;};f.exports=h;}),null);
__d('FbtraceForcedByServerPolicy',['FbtraceForcedByServer','SamplingPolicyBase'],(function a(b,c,d,e,f,g){'use strict';var h=void 0;function i(){this.name='FbtraceForcedByServerPolicy';}i.get=function(){if(typeof h=='undefined')h=new i();return h;};function j(){return c('FbtraceForcedByServer').forced;}Object.assign(i.prototype,c('SamplingPolicyBase').prototype,{decideIfSampled:j});f.exports=i;}),null);
__d("guardFunction",[],(function a(b,c,d,e,f,g){function h(i,j,k){return function(){if(i.apply(k||this,arguments))j.apply(k||this,arguments);};}f.exports=h;}),null);
__d('Fbtrace',['Arbiter','ArtilleryTraceIDUtils','BanzaiScribe','FbtraceForcedByServer','FbtraceForcedByServerPolicy','SiteData','guardFunction'],(function a(b,c,d,e,f,g){'use strict';function h(){Object.assign(this,h);}Object.assign(h,{isOn:function s(){return false;},replySend:function s(t,u){},requestSend:function s(t,u,v){m(t,u);return {metadata:function w(){return undefined;},replyReceive:function w(x){}};}});var i=new h();function j(s,t,u){if(!s)throw {name:'ArgumentError',message:'no valid service name specified'};if(!t)throw {name:'ArgumentError',message:'no valid version specified'};var v=c('BanzaiScribe'),w=0,x=c('ArtilleryTraceIDUtils').newTraceId(),y=c('ArtilleryTraceIDUtils').newObjectId(),z=c('ArtilleryTraceIDUtils').traceIdToBucket(x),aa={service:s,version:t},ba=function ga(ha){if(typeof ha=='undefined')return 'undefined';if(typeof ha!='string')ha=ga(JSON.stringify(ha));return ha;},ca=function ga(ha){var ia='';for(var ja in ha){if(ia.length>0)ia+='\x02';ia+=ba(ja)+'\x03'+ba(ha[ja]);}return ia;},da=function ga(ha,ia,event,ja,ka){w++;return [ka,w,x,ha,ia,ba(event),ca(ja)].join('\x01');},ea=function ga(ha,ia,event,ja,ka){if(!ka&&typeof ka=='undefined')ka=Date.now()*1000;var la=da(ha,ia,event,ja,ka);v.log('fbtrace',la,z);},fa=function ga(){return y;};ea(c('ArtilleryTraceIDUtils').getDummyId(),y,'#rqrecv',Object.assign(u||{},aa));Object.assign(this,j,{replySend:function ga(ha,ia){ia=babelHelpers['extends']({},ia,aa,{success:ha?'true':'false'});ea(c('ArtilleryTraceIDUtils').getDummyId(),y,'#rpsend',ia);},requestSend:function ga(ha,ia,ja){m(ha,ia);var ka=fa(),la=c('ArtilleryTraceIDUtils').newObjectId();ja=babelHelpers['extends']({},ja,aa,{op:ha,'remote:service':ia});ea(ka,la,'#rqsend',ja);return {metadata:function ma(){return x+la;},replyReceive:function ma(na){ea(ka,la,'#rprecv',Object.assign(na||{},aa));},parentNode:this};}});}Object.assign(j,{isOn:function s(){return true;}});function k(){return i;}function l(s,t,u){u=u||{};u.init=true;var v=c('FbtraceForcedByServerPolicy').get();if(v.isSampled()){return new j(s,t,u);}else return new h();}function m(s,t){if(!s)throw {name:'ArgumentError',message:'no valid operation specified'};if(!t)throw {name:'ArgumentError',message:'no valid remote:service specified'};}function n(s,t){var u=i,v=void 0;i=s;try{v=t();}finally{i=u;}return v;}var o=function s(t,u){var v=k(),w=u.request,x=false;if(!v.isOn()&&c('FbtraceForcedByServer').forced&&/\/upload\/(?:composer|photos)\/|\/ajax\/composerx\/attachment\/media\//.test(w.uri.toString())){v=l('photo_upload_kludge',String(c('SiteData').client_revision||'dev'),{policy:'PhotoUpload'});x=true;}if(v.isOn()){var y=x?{policy:'PhotoUpload'}:{};if(w.userActionId)y.user_action_id=w.userActionId;var z=v.requestSend(w.uri.toString(),'www',y);w.fbtraceRemoteNode=z;w.transport.setRequestHeader('X-Fbtrace-Meta',z.metadata());}},p=function s(t,u){u.request.fbtraceRemoteNode.replyReceive({is_last:u.response.is_last,success:true});setTimeout(function(){u.request.fbtraceRemoteNode.parentNode.replySend(true,{});},0);},q=function s(t,u){u.request.fbtraceRemoteNode.replyReceive({is_last:u.response.is_last,success:false,error_code:u.response.error,error_summary:u.response.errorSummary,error_description:u.response.errorDescription});setTimeout(function(){u.request.fbtraceRemoteNode.parentNode.replySend(false,{});},0);},r=function s(t,u){return u.request.fbtraceRemoteNode;};c('Arbiter').subscribe('AsyncRequest/will_send',o);c('Arbiter').subscribe('AsyncRequest/response',c('guardFunction')(r,p));c('Arbiter').subscribe('AsyncRequest/error',c('guardFunction')(r,q));f.exports={defaultNode:k,requestReceive:l,withDefaultNode:n};}),null);
__d("XCollabCallSendMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/collab\/sendmessage\/",{recipient_id:{type:"Int",required:true},msg_id:{type:"Int",required:true},message_info:{type:"String",required:true},webrtc_fbtrace:{type:"Int"}});}),null);
__d("XVideoCallSendMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/sendmessage\/",{recipient_id:{type:"Int",required:true},msg_id:{type:"Int",required:true},message_info:{type:"String",required:true},webrtc_fbtrace:{type:"Int"}});}),null);
__d('FBRTCMessageSender',['errorCode','CurrentUser','FBRTCConfig','FBRTCConstants','FBRTCLogger','FBRTCUtils','Fbtrace','Map','SiteData','FBRTCSupport','XVideoCallSendMessageController','XCollabCallSendMessageController'],(function a(b,c,d,e,f,g,h){var i=0;function j(){'use strict';this.onSendFailure=null;this.$FBRTCMessageSender1=c('FBRTCLogger').getInstance();}j.prototype.sendOffer=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.OFFER,k,l,m,n,o);};j.prototype.sendAnswer=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.ANSWER,k,l,m,n,o);};j.prototype.sendPCRestartOffer=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.PCRESTART_OFFER,k,l,m,n,o);};j.prototype.sendSdpUpdate=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.SDP_UPDATE,k,l,m,n,o);};j.prototype.resendSdpMessage=function(k,l){'use strict';l.flag=1;this.$FBRTCMessageSender3(k,l);};j.prototype.resendPayload=function(k,l){'use strict';l.flag=1;this.$FBRTCMessageSender4(k,l);};j.prototype.$FBRTCMessageSender2=function(k,l,m,n,o,p){'use strict';var q=this.$FBRTCMessageSender5(m,k);q.sdp=n;if(k===c('FBRTCConstants').PayloadType.OFFER){q.handlescollision=true;q.pranswer=false;}if(k===c('FBRTCConstants').PayloadType.OFFER||k===c('FBRTCConstants').PayloadType.ANSWER){q.icerestart=false;q.experiments=c('FBRTCConfig').supportedSignalingExperiments();}q.videoon=o;q.attributes=p;q.ull=c('FBRTCConstants').convertFromUploadLogLevel(c('FBRTCUtils').getLocalUploadLogLevel());this.$FBRTCMessageSender3(l,q);return q;};j.prototype.sendIceCandidate=function(k,l,m){'use strict';var n=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.ICE_CANDIDATE);n.sdp_mid=m.sdpMid;n.label=m.sdpMLineIndex;n.sdp=m.candidate;if(m.isDirectScreenShareFromRecipient){n.attributes={};n.attributes.isDirectScreenShareFromRecipient=m.isDirectScreenShareFromRecipient;}this.$FBRTCMessageSender4(k,n);};j.prototype.sendHangup=function(k,l,m,n,o){'use strict';var p=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.HANGUP);p.reason=c('FBRTCConstants').callEndReasonString(m);p.subreason=o||'';this.$FBRTCMessageSender4(k,p,n);};j.prototype.sendOtherDismiss=function(k){'use strict';var l=this.$FBRTCMessageSender5(k,c('FBRTCConstants').PayloadType.OTHER_DISMISS);this.$FBRTCMessageSender4(c('CurrentUser').getID(),l);};j.prototype.sendOfferAck=function(k,l,m){var n=arguments.length<=3||arguments[3]===undefined?new (c('Map'))():arguments[3];'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.OFFER_ACK,n);};j.prototype.sendOfferNack=function(k,l,m){'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.OFFER_NACK,new (c('Map'))([['error_code',1356043]]));};j.prototype.sendAnswerAck=function(k,l,m){'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.ANSWER_ACK);};j.prototype.sendAck=function(k,l,m){'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.ACK,new (c('Map'))([['ack_type',m.type]]));};j.prototype.sendMuteStateUpdate=function(k,l,m){'use strict';var n=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.SET_VIDEO);n.videoon=m;this.$FBRTCMessageSender4(k,n);};j.prototype.sendVideoEscalationRequest=function(k,l,m){'use strict';return this.sendVideoRequestResponse(k,l,0,m);};j.prototype.sendVideoRequestResponse=function(k,l,m,n){'use strict';var o=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.VIDEO_REQUEST);o.ack_id=m;o.videoon=n;o.capability=c('FBRTCSupport').getCapabilities();this.$FBRTCMessageSender4(k,o);return o;};j.prototype.sendMsgAck=function(){'use strict';};j.prototype.sendOk=function(){'use strict';};j.prototype.sendPranswer=function(){'use strict';};j.prototype.sendIcerestartAnswer=function(){'use strict';};j.prototype.$FBRTCMessageSender5=function(k,l){'use strict';var m=c('FBRTCUtils').generateRandomInt(),n={version:i,type:l,call_id:k,msg_id:m};if(this.$FBRTCMessageSender7(l))n.supports_video_interop=true;return n;};j.prototype.$FBRTCMessageSender7=function(k){'use strict';if(c('FBRTCSupport').isVideoInteropSupported())return k===c('FBRTCConstants').PayloadType.OFFER||k===c('FBRTCConstants').PayloadType.ANSWER||k===c('FBRTCConstants').PayloadType.PRANSWER||k===c('FBRTCConstants').PayloadType.ICERESTART_OFFER||k===c('FBRTCConstants').PayloadType.ICERESTART_ANSWER||k===c('FBRTCConstants').PayloadType.PCRESTART_OFFER||k===c('FBRTCConstants').PayloadType.PCRESTART_ANSWER||k===c('FBRTCConstants').PayloadType.SDP_UPDATE||k===c('FBRTCConstants').PayloadType.SET_VIDEO||k===c('FBRTCConstants').PayloadType.VIDEO_REQUEST;return false;};j.prototype.$FBRTCMessageSender3=function(k,l){'use strict';this.$FBRTCMessageSender4(k,l,false,true,true);};j.prototype.$FBRTCMessageSender6=function(k,l,m,n){'use strict';var o=(arguments.length<=4?undefined:arguments[4])||new (c('Map'))(),p=this.$FBRTCMessageSender5(l,n);p.ack_id=m.msg_id;if(m.flag===1)p.flag=1;p.ull=c('FBRTCConstants').convertFromUploadLogLevel(c('FBRTCUtils').getLocalUploadLogLevel());o.forEach(function(q,r,s){p[r]=q;});this.$FBRTCMessageSender4(k,p);};j.prototype.$FBRTCMessageSender4=function(k,l,m,n,o){'use strict';var p=l.msg_id,q={peer_id:k,call_id:l.call_id,msg_id:p,msg_type:l.type},r={call_id:l.call_id,msg_id:p,user_id:c('CurrentUser').getID(),recipient_id:k,msg_type:l.type,app_id:256281040558,app_version:String(c('SiteData').client_revision||'dev'),op:'sendServerRequest:'+l.type,policy:'WebRTC'},s=c('Fbtrace').requestReceive('browser',String(c('SiteData').client_revision||'dev'),r),t=(c('FBRTCUtils').isPeerVCEndpoint(k)?c('XCollabCallSendMessageController'):c('XVideoCallSendMessageController')).getURIBuilder().setInt('recipient_id',k).setInt('msg_id',p).setString('message_info',JSON.stringify(l)).setInt('webrtc_fbtrace',s.isOn()?1:0).getURI();if(n)var u=this.$FBRTCMessageSender4.bind(this,k,l,m,false,o);var v=this.$FBRTCMessageSender8.bind(this,q),w=this.$FBRTCMessageSender9.bind(this,q,u,o);c('Fbtrace').withDefaultNode(s,function(){c('FBRTCUtils').sendServerRequest(t,v,w,m);});if(this.onMessageSent)this.onMessageSent(k,l);this.$FBRTCMessageSender1.logSentMessage(k,l.call_id,l);};j.prototype.$FBRTCMessageSender8=function(k){'use strict';this.$FBRTCMessageSender1.logSentMessageSuccess(k.peer_id,k.call_id,k.msg_type,k.msg_id);};j.prototype.$FBRTCMessageSender9=function(k,l,m,n){'use strict';if(n)var o=n.getError?n.getError():n;this.$FBRTCMessageSender1.logSentMessageFailure(k.peer_id,k.call_id,k.msg_type,k.msg_id,o);var p=null;if(o===1356001||o===1356049){p=c('FBRTCConstants').CallEndReason.NO_PERMISSION;}else if(o===1356046||o===1356045){p=c('FBRTCConstants').CallEndReason.CALLER_NOT_VISIBLE;}else if(o===1356003||o===1356002||o===1356044)p=c('FBRTCConstants').CallEndReason.OTHER_NOT_CAPABLE;if(!p&&l){l();return;}if(m&&this.onSendFailure){if(!p)p=c('FBRTCConstants').CallEndReason.SIGNALING_MESSAGE_FAILED;this.onSendFailure(p,o,k.msg_type);}};f.exports=j;}),null);
__d('FBRTCScreenSharingActions',['FBRTCDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({END_SESSION:null}),i=c('keyMirror')({CONNECTED:null,SDP_CREATED:null,REMOTE_DESCRIPTION_SET:null,LOCAL_ICE_CANDIDATE_CREATED:null,REMOTE_STREAM_ADDED:null,OFFER_ACK:null}),j={ConnectionEventTypes:i,ControlEventTypes:h,endSession:function k(){c('FBRTCDispatcher').dispatch({type:h.END_SESSION});},sdpCreated:function k(l){c('FBRTCDispatcher').dispatch({type:i.SDP_CREATED,description:l});},remoteDescriptionSet:function k(){c('FBRTCDispatcher').dispatch({type:i.REMOTE_DESCRIPTION_SET});},localIceCandidateCreated:function k(l){c('FBRTCDispatcher').dispatch({type:i.LOCAL_ICE_CANDIDATE_CREATED,candidate:l});},remoteStreamAdded:function k(l){c('FBRTCDispatcher').dispatch({type:i.REMOTE_STREAM_ADDED,stream:l});},offerAckReceived:function k(){c('FBRTCDispatcher').dispatch({type:i.OFFER_ACK});},connected:function k(){c('FBRTCDispatcher').dispatch({type:i.CONNECTED});}};f.exports=j;}),null);
__d('FBRTCIncomingCallController',['fbt','Bootloader','Cache','DocumentTitle','FBRTCCallBlockingStore','FBRTCCallSummary','FBRTCCallSummaryStore','FBRTCCallUIWrapper','FBRTCConstants','FBRTCLocalMessageQueue','FBRTCLogger','FBRTCMessage','FBRTCMessageDedup','FBRTCMessageSender','FBRTCScreenSharingActions','FBRTCUtils','Map','MercuryIDs','MercuryParticipants','UserActivity','FBRTCSupport'],(function a(b,c,d,e,f,g,h){var i=30;function j(k,l,m){'use strict';this.$FBRTCIncomingCallController1=k;this.$FBRTCIncomingCallController2=l;this.$FBRTCIncomingCallController3=m;this.$FBRTCIncomingCallController4=null;this.$FBRTCIncomingCallController5=null;this.$FBRTCIncomingCallController6=new (c('FBRTCMessageSender'))();this.$FBRTCIncomingCallController7=new (c('FBRTCLocalMessageQueue'))();this.$FBRTCIncomingCallController8=c('FBRTCCallSummaryStore').getInstance();this.$FBRTCIncomingCallController9=c('FBRTCLogger').getInstance();this.$FBRTCIncomingCallController10=null;this.$FBRTCIncomingCallController11=new (c('Cache'))();}j.prototype.onMessageReceived=function(k){'use strict';var l;try{l=new (c('FBRTCMessage'))(k);}catch(m){this.$FBRTCIncomingCallController9.logErrorWithoutID('Unknown data: '+JSON.stringify(k));return;}if(!c('FBRTCMessageDedup').check(l.peerID,l.callID,l.msgID)){if(l.isOffer()&&this.$FBRTCIncomingCallController12(l))this.$FBRTCIncomingCallController6.sendOfferAck(l.peerID,l.callID,l.msg);this.$FBRTCIncomingCallController9.logInfo(l.peerID,l.callID,'Ignoring message (duplicate): '+l.msgID);return;}this.$FBRTCIncomingCallController9.logReceivedMessage(l.peerID,l.callID,l.msg);if(c('FBRTCSupport').isWebrtcSupported()&&l.msgType!==c('FBRTCConstants').PayloadType.OFFER)this.$FBRTCIncomingCallController7.enqueueMessage(l.peerID,l.callID,l.msgID,k);switch(l.msgType){case c('FBRTCConstants').PayloadType.OFFER:this.$FBRTCIncomingCallController13(l);break;case c('FBRTCConstants').PayloadType.HANGUP:this.$FBRTCIncomingCallController14(l);break;case c('FBRTCConstants').PayloadType.OTHER_DISMISS:this.$FBRTCIncomingCallController15(l);break;case c('FBRTCConstants').PayloadType.SDP_UPDATE:this.$FBRTCIncomingCallController16(l);break;case c('FBRTCConstants').PayloadType.OFFER_ACK:this.$FBRTCIncomingCallController17(l);break;case c('FBRTCConstants').PayloadType.ICE_CANDIDATE:case c('FBRTCConstants').PayloadType.ANSWER:case c('FBRTCConstants').PayloadType.MSG_ACK:case c('FBRTCConstants').PayloadType.OK:case c('FBRTCConstants').PayloadType.PING:case c('FBRTCConstants').PayloadType.PRANSWER:case c('FBRTCConstants').PayloadType.ICERESTART_OFFER:case c('FBRTCConstants').PayloadType.ICERESTART_ANSWER:case c('FBRTCConstants').PayloadType.PCRESTART_ANSWER:case c('FBRTCConstants').PayloadType.PCRESTART_OFFER:case c('FBRTCConstants').PayloadType.ANSWER_ACK:case c('FBRTCConstants').PayloadType.SET_VIDEO:case c('FBRTCConstants').PayloadType.OFFER_NACK:case c('FBRTCConstants').PayloadType.VIDEO_REQUEST:case c('FBRTCConstants').PayloadType.ACK:break;default:break;}};j.prototype.$FBRTCIncomingCallController13=function(k){'use strict';var l=k.callID,m,n=k.msg,o=k.peerID,p=n.attributes&&Object.prototype.hasOwnProperty.call(n.attributes,'isDirectScreenShareFromRecipient');if(this.$FBRTCIncomingCallController18(l))return;if(n.calltype){this.$FBRTCIncomingCallController6.sendOfferNack(o,l,n);return;}if(this.$FBRTCIncomingCallController12(k)){var q=p?new (c('Map'))([['isDirectScreenShareFromRecipient',true]]):new (c('Map'))();this.$FBRTCIncomingCallController6.sendOfferAck(o,l,n,q);}else if(!c('FBRTCSupport').isWebrtcSupported()&&!p)this.$FBRTCIncomingCallController6.sendOfferNack(o,l,n);this.$FBRTCIncomingCallController9.logCallAction(o,l,c('FBRTCLogger').CallAction.RECEIVED_CALL);var r=this.$FBRTCIncomingCallController19(o,l,k);r.setUploadLogLevel(c('FBRTCUtils').getUploadLogLevel(c('FBRTCConstants').convertToUploadLogLevel(n.ull)));if(c('FBRTCCallBlockingStore').getBlockingStatus()){this.$FBRTCIncomingCallController20(o,l,r,c('FBRTCConstants').CallEndReason.IGNORE_CALL,false,false,false,'calling disabled');return;}if(this.$FBRTCIncomingCallController4!==null&&!this.$FBRTCIncomingCallController4.isForPeer(o)){this.$FBRTCIncomingCallController20(o,l,r,c('FBRTCConstants').CallEndReason.IN_ANOTHER_CALL,false,false,true);this.$FBRTCIncomingCallController3.onCallMissed(o);return;}if(!c('FBRTCSupport').isWebrtcSupported()){this.$FBRTCIncomingCallController20(o,l,r,c('FBRTCConstants').CallEndReason.UNSUPPORTED_VERSION,false,false,false);this.$FBRTCIncomingCallController2.showForIncomingCall(l,o);return;}this.$FBRTCIncomingCallController4=new this.$FBRTCIncomingCallController1(o,l);this.$FBRTCIncomingCallController5=r;this.$FBRTCIncomingCallController4.addListener('answerCall',function(s){this.$FBRTCIncomingCallController21(o,l,k,r,s);}.bind(this));this.$FBRTCIncomingCallController4.addListener('ignoreCall',function(){this.$FBRTCIncomingCallController22(o,l,r);}.bind(this));this.$FBRTCIncomingCallController4.addListener('timeout',function(){this.$FBRTCIncomingCallController23(o,l,r,p,!p);}.bind(this));this.$FBRTCIncomingCallController3.hideDialog();if(p){m=c('FBRTCConstants').IncomingCallDialogTypes.SCREEN_SHARE;}else m=n.videoon?c('FBRTCConstants').IncomingCallDialogTypes.VIDEO:c('FBRTCConstants').IncomingCallDialogTypes.AUDIO;this.$FBRTCIncomingCallController4.showIncomingDialog(m);this.$FBRTCIncomingCallController9.logEvent(o,l,'Incoming call dialog shown');this.$FBRTCIncomingCallController24(o);};j.prototype.$FBRTCIncomingCallController17=function(k){'use strict';var l=Object.prototype.hasOwnProperty.call(k.msg,'isDirectScreenShareFromRecipient');if(l||c('FBRTCUtils').isPeerVCEndpoint(k.peerID))c('FBRTCScreenSharingActions').offerAckReceived();};j.prototype.$FBRTCIncomingCallController24=function(k){'use strict';if(!document.hasFocus())this.$FBRTCIncomingCallController25(k);};j.prototype.$FBRTCIncomingCallController26=function(){'use strict';this.$FBRTCIncomingCallController27();};j.prototype.$FBRTCIncomingCallController25=function(k){'use strict';var l=c('MercuryIDs').getParticipantIDFromUserID(k);c('MercuryParticipants').get(l,function(m){if(!this.$FBRTCIncomingCallController4)return;this.$FBRTCIncomingCallController10=c('DocumentTitle').blink(h._("{name} is calling",[h.param('name',m.short_name)]));}.bind(this));c('UserActivity').subscribeOnce(this.$FBRTCIncomingCallController27.bind(this));};j.prototype.$FBRTCIncomingCallController27=function(){'use strict';if(this.$FBRTCIncomingCallController10){this.$FBRTCIncomingCallController10.stop();this.$FBRTCIncomingCallController10=null;}};j.prototype.$FBRTCIncomingCallController28=function(){'use strict';if(this.$FBRTCIncomingCallController4)this.$FBRTCIncomingCallController4.cancel();this.$FBRTCIncomingCallController4=null;this.$FBRTCIncomingCallController5=null;this.$FBRTCIncomingCallController26();};j.prototype.$FBRTCIncomingCallController14=function(k){'use strict';var l=k.peerID,m=k.callID,n=k.msg;this.$FBRTCIncomingCallController29(m);if(this.$FBRTCIncomingCallController4&&this.$FBRTCIncomingCallController4.isForPeerAndCall(l,m)){var o=n.reason;if(typeof o=='string'||o instanceof String)o=c('FBRTCConstants').endCallReasonFromString(o);this.$FBRTCIncomingCallController20(l,m,this.$FBRTCIncomingCallController5,o,true,true,false);this.$FBRTCIncomingCallController28();if(o!==c('FBRTCConstants').CallEndReason.OTHER_INSTANCE_HANDLED){this.$FBRTCIncomingCallController3.onCallMissed(l);this.$FBRTCIncomingCallController3.showDialog();}}if(this.$FBRTCIncomingCallController30)this.$FBRTCIncomingCallController30.onDirectScreenSharingEndSession();};j.prototype.$FBRTCIncomingCallController12=function(k){'use strict';return c('FBRTCSupport').isWebrtcSupported();};j.prototype.$FBRTCIncomingCallController15=function(k){'use strict';var l=k.callID;this.$FBRTCIncomingCallController29(l);this.$FBRTCIncomingCallController2.dismiss();if(this.$FBRTCIncomingCallController4&&this.$FBRTCIncomingCallController4.isForCall(l))this.$FBRTCIncomingCallController28();};j.prototype.$FBRTCIncomingCallController29=function(k){'use strict';this.$FBRTCIncomingCallController11.set(k,true,null,i);};j.prototype.$FBRTCIncomingCallController18=function(k){'use strict';return this.$FBRTCIncomingCallController11.has(k);};j.prototype.$FBRTCIncomingCallController19=function(k,l,m){'use strict';var n=new (c('FBRTCCallSummary'))({peerID:k,callID:l,isCaller:false});n.onFullMessageReceived(m);n.onOfferAckSent(m.msg);return n;};j.prototype.$FBRTCIncomingCallController21=function(k,l,m,n,o){'use strict';if(m.msg.attributes&&Object.prototype.hasOwnProperty.call(m.msg.attributes,'isDirectScreenShareFromRecipient')){this.$FBRTCIncomingCallController31(k,l,m.msg.sdp);}else{var p=!m.msg.videoon;this.$FBRTCIncomingCallController9.logCallAction(k,l,c('FBRTCLogger').CallAction.ANSWER_CALL);this.$FBRTCIncomingCallController6.sendOtherDismiss(l);this.$FBRTCIncomingCallController7.enqueueOffer(k,m.originalMessageData);c('FBRTCCallUIWrapper').openAsCallee(k,l,n,o,p);}this.$FBRTCIncomingCallController28();};j.prototype.$FBRTCIncomingCallController31=function(k,l,m){'use strict';c('Bootloader').loadModules(["FBRTCScreenSharingController"],function(n){this.$FBRTCIncomingCallController30=new n(k,l,true);this.$FBRTCIncomingCallController30.initPromise.done(function(){this.$FBRTCIncomingCallController30.initializeAsReceiver(m,this.$FBRTCIncomingCallController7);}.bind(this));}.bind(this),'FBRTCIncomingCallController');};j.prototype.$FBRTCIncomingCallController22=function(k,l,m){'use strict';this.$FBRTCIncomingCallController20(k,l,m,c('FBRTCConstants').CallEndReason.IGNORE_CALL,false,true,true);this.$FBRTCIncomingCallController28();};j.prototype.$FBRTCIncomingCallController23=function(k,l,m,n,o){'use strict';this.$FBRTCIncomingCallController20(k,l,m,c('FBRTCConstants').CallEndReason.NO_ANSWER_TIMEOUT,false,false,n);this.$FBRTCIncomingCallController28();if(o){this.$FBRTCIncomingCallController3.onCallMissed(k);this.$FBRTCIncomingCallController3.showDialog();}};j.prototype.$FBRTCIncomingCallController20=function(k,l,m,n,o,p,q){var r=arguments.length<=7||arguments[7]===undefined?null:arguments[7];'use strict';if(q)this.$FBRTCIncomingCallController6.sendHangup(k,l,n);if(p)this.$FBRTCIncomingCallController6.sendOtherDismiss(l);m.onCallEnded(n,o,null,r);m.save(this.$FBRTCIncomingCallController8);var s=c('FBRTCConstants').fullCallEndReasonString(n,o);this.$FBRTCIncomingCallController9.logCallAction(k,l,c('FBRTCLogger').CallAction.END_CALL,s);};j.prototype.$FBRTCIncomingCallController16=function(k){'use strict';var l=k.msg,m=l.attributes&&Object.prototype.hasOwnProperty.call(l.attributes,'isDirectScreenShareFromRecipient');if(m&&this.$FBRTCIncomingCallController30)this.$FBRTCIncomingCallController30.onSdpUpdateReceived(l.sdp);};f.exports=j;}),null);