if (self.CavalryLogger) { CavalryLogger.start_js(["y6gsH"]); }

__d("PUWErrorCodes",[],(function a(b,c,d,e,f,g){f.exports={BAD_JPEG:9901,WORKER_TERMINATED:9902,UNKNOWN_RESIZE_ERROR:9903,WORKER_ABORT:9904};}),null);
__d('AudioMimeTypes',[],(function a(b,c,d,e,f,g){var h={_extToMimeType:{aac:'audio/aac',mp1:'audio/mpeg',mp2:'audio/mpeg',mp3:'audio/mpeg',mpeg:'audio/mpeg',mpg:'audio/mpeg',ogg:'audio/mp4',mp4:'audio/mp4',m4a:'audio/mp4',wav:'audio/wav'},getMimeFromExt:function j(k){return this._extToMimeType[k];},isAudio:function j(k){return i(k)[0]==='audio';}};function i(j){return j.split('/');}f.exports=h;}),null);
__d('FileFormResetOnSubmit',['DOMQuery','Event','emptyFunction'],(function a(b,c,d,e,f,g){function h(j,k){var l=c('Event').listen(j,'change',c('emptyFunction').thatReturnsFalse,c('Event').Priority.URGENT);try{k();}catch(m){throw m;}finally{l.remove();}}function i(j){'use strict';this._form=j;}i.prototype.enable=function(){'use strict';var j=this._reset.bind(this);this._subscription=this._form.subscribe('submit',function(){setTimeout(j,0);});};i.prototype.disable=function(){'use strict';this._subscription.unsubscribe();this._subscription=null;};i.prototype._reset=function(){'use strict';var j=this._form.getRoot();h(j,function(){var k=c('DOMQuery').scry(j,'input[type="file"]');k.forEach(function(l){l.value='';});});};f.exports=i;}),null);
__d('submitForm',['DOM'],(function a(b,c,d,e,f,g){var h=function i(j){var k=c('DOM').scry(j,'input[type="submit"]')[0];if(k){k.click();}else{k=c('DOM').create('input',{type:'submit',className:'hidden_elem'});c('DOM').appendContent(j,k);k.click();c('DOM').remove(k);}};f.exports=h;}),null);
__d('FormSubmitOnChange',['Event','submitForm'],(function a(b,c,d,e,f,g){function h(i){'use strict';this._form=i;}h.prototype.enable=function(){'use strict';this._listener=c('Event').listen(this._form.getRoot(),'change',this._submit.bind(this));};h.prototype.disable=function(){'use strict';this._listener.remove();this._listener=null;};h.prototype._submit=function(){'use strict';c('submitForm')(this._form.getRoot());};Object.assign(h.prototype,{_listener:null});f.exports=h;}),null);
__d('Emscripten',[],(function a(b,c,d,e,f,g){f.exports={isSupported:function h(){return typeof Int32Array!=='undefined'&&typeof Float64Array!=='undefined'&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set;}};}),null);
__d('BlobFactory',['emptyFunction'],(function a(b,c,d,e,f,g){var h=void 0,i=void 0;function j(){try{new b.Blob();i=true;}catch(l){i=false;}}var k=b.BlobBuilder||b.WebKitBlobBuilder||b.MozBlobBuilder||b.MSBlobBuilder;if(b.Blob){h={getBlob:function l(m,n){m=m||[];n=n||{};if(i===undefined)j();if(i){return new b.Blob(m,n);}else{var o=new k();for(var p=0;p<m.length;p++)o.append(m[p]);return o.getBlob(n.type);}},isSupported:c('emptyFunction').thatReturnsTrue};}else h={getBlob:function l(){},isSupported:c('emptyFunction').thatReturnsFalse};f.exports=h;}),null);
__d('WebWorker',['invariant','BanzaiLogger','BlobFactory','EventListener','SubscriptionsHandler','URI','WebWorkerConfig','XHRRequest','areSameOrigin','arrayContains','destroyOnUnload','emptyFunction','filterObject','getCrossOriginTransport','memoize','performanceNow'],(function a(b,c,d,e,f,g,h){var i=b.URL||b.webkitURL;function j(p){'use strict';this.$WebWorker1=false;this.$WebWorker2=null;this.$WebWorker3=p;this.$WebWorker4=null;this.$WebWorker5=c('emptyFunction');this.$WebWorker6=c('emptyFunction');this.$WebWorker7=[];this.$WebWorker8=false;this.$WebWorker9=new (c('SubscriptionsHandler'))();c('destroyOnUnload')(function(){if(!this.$WebWorker8)this.terminate();}.bind(this));this.$WebWorker10('constructed');}j.prototype.setMessageHandler=function(p){'use strict';this.$WebWorker5=p||c('emptyFunction');return this;};j.prototype.setErrorHandler=function(p){'use strict';this.$WebWorker6=p||c('emptyFunction');return this;};j.prototype.postMessage=function(p,q){'use strict';!this.isCurrentState('constructed')||h(0);!this.isCurrentState('terminated')||h(0);if(this.isCurrentState('preparing')){this.$WebWorker7.push(this.postMessage.bind(this,p,q));return this;}var r={type:'message',message:p};if(q){this.$WebWorker4.postMessage(r,q);}else this.$WebWorker4.postMessage(r);return this;};j.prototype.terminate=function(){'use strict';if(this.isCurrentState('executing'))this.$WebWorker4.terminate();if(!this.isCurrentState('terminated')){this.$WebWorker10('terminated');this.$WebWorker4=null;this.$WebWorker11();this.$WebWorker7=[];}return this;};j.prototype.execute=function(){'use strict';!this.isCurrentState('terminated')||h(0);if(['preparing','executing'].some(this.isCurrentState,this))return this;this.$WebWorker10('preparing');j.prepareResource(this.$WebWorker3,this.$WebWorker12.bind(this));return this;};j.prototype.setAllowCrossPageTransition=function(p){'use strict';this.$WebWorker8=p;return this;};j.prototype.isCurrentState=function(p){'use strict';c('arrayContains')(j.states,p)||h(0);return p===this.$WebWorker2;};j.prototype.$WebWorker12=function(){'use strict';!this.isCurrentState('executing')||h(0);if(this.isCurrentState('terminated'))return;this.$WebWorker3.sameOriginURL||this.$WebWorker3.source||h(0);if(this.$WebWorker3.sameOriginURL){this.$WebWorker4=new b.Worker(this.$WebWorker3.sameOriginURL);}else{this.$WebWorker4=new b.Worker(j.evalWorkerURL);this.$WebWorker4.postMessage(this.$WebWorker3.source);}this.$WebWorker13('ping',Date.now());if(this.$WebWorker3.dynamicModules)try{this.$WebWorker13('defineModules',this.$WebWorker3.dynamicModules);}catch(p){this.terminate();this.$WebWorker14('define_error',{message:p.message});throw p;}this.$WebWorker15();this.$WebWorker10('executing');this.$WebWorker7.forEach(function(p){return p();});this.$WebWorker7=null;};j.prototype.$WebWorker11=function(){'use strict';this.$WebWorker9.release();};j.prototype.$WebWorker13=function(p){for(var q=arguments.length,r=Array(q>1?q-1:0),s=1;s<q;s++)r[s-1]=arguments[s];'use strict';this.$WebWorker4.postMessage({type:p,args:r});};j.prototype.$WebWorker14=function(event,p){'use strict';j.$WebWorker14(event,this.$WebWorker3.name,babelHelpers['extends']({},p,{cross_page_transition:!!this.$WebWorker8,state:this.$WebWorker2}));};j.$WebWorker16=function(){'use strict';return Object.keys(c('filterObject')({object_url:j.$WebWorker17(),eval_url:n(),data_url:j.$WebWorker18(),worker:j.isSupported(),transferables:j.areTransferablesSupported()},function(p){return !!p;}));};j.prototype.$WebWorker15=function(){'use strict';this.$WebWorker9.addSubscriptions(c('EventListener').listen(this.$WebWorker4,'message',this.$WebWorker19.bind(this)),c('EventListener').listen(this.$WebWorker4,'error',this.$WebWorker20.bind(this)));};j.prototype.$WebWorker20=function(p){'use strict';var q=this.$WebWorker6(p);if(!q&&!p.defaultPrevented)this.$WebWorker14('exception',{message:p.message});};j.prototype.$WebWorker19=function(event){'use strict';var p=event.data;switch(p.type){case 'message':this.$WebWorker5(p.message);break;case 'pong':this.$WebWorker1=true;this.$WebWorker14('executed',{dt:Math.floor(p.args[1]-p.args[0]),bytes:this.$WebWorker3.source?this.$WebWorker3.source.length:-1});break;case 'terminate':this.terminate();break;case 'haste-error':this.terminate();this.$WebWorker14('haste_error',{message:p.message});break;case 'console':var q=p.args.shift();c('arrayContains')(['log','error','info','debug','warn'],q)||h(0);b.console[q].apply(b.console,p.args);break;}};j.prototype.$WebWorker10=function(p){'use strict';c('arrayContains')(j.states,p)||h(0);this.$WebWorker14('transition',{next_state:p});this.$WebWorker2=p;};j.prepareResource=function(p,q){'use strict';q=q||c('emptyFunction');p.sameOriginURL||p.url||p.source||h(0);!!j.isSupported()||h(0);if(p.sameOriginURL){q();}else if(p.url&&c('areSameOrigin')(new (c('URI'))(p.url),new (c('URI'))(b.location.href))){p.sameOriginURL=p.url;q();}else if(p.source){if(j.$WebWorker21())p.sameOriginURL=j.$WebWorker22(p.source);q();}else if(!p.loading){var r=c('performanceNow')();p.loading=[q];j.$WebWorker23(p.url,function(s){if(s){p.source=s;if(j.$WebWorker21())p.sameOriginURL=j.$WebWorker22(s);}j.$WebWorker14('prepared',p.name,{dt:Math.floor(c('performanceNow')()-r),bytes:s.length});p.loading.forEach(function(t){return t();});p.loading=false;});}else p.loading.push(q);return p;};j.releaseResource=function(p){'use strict';if(p.sameOriginURL.indexOf('blob:')===0){if(i.revokeObjectURL)i.revokeObjectURL(p.sameOriginURL);p.sameOriginURL=null;}return p;};j.isSupported=function(){'use strict';return m&&(j.$WebWorker21()||n());};j.areTransferablesSupported=function(){'use strict';return j.isSupported()&&o();};j.$WebWorker23=function(p,q){'use strict';new (c('XHRRequest'))(p).setTransportBuilder(c('getCrossOriginTransport')).setMethod('GET').setResponseHandler(function(r){q(r);}).setErrorHandler(q.bind(null,null)).send();};j.$WebWorker22=function(p){'use strict';j.$WebWorker21()||h(0);if(j.$WebWorker17()){var q=c('BlobFactory').getBlob([p],{type:'application/javascript'});return i.createObjectURL(q);}if(j.$WebWorker18())return 'data:application/javascript,'+encodeURIComponent(p);};j.$WebWorker17=function(){'use strict';return c('BlobFactory').isSupported()&&k();};j.$WebWorker18=function(){'use strict';return l();};j.$WebWorker21=function(){'use strict';return j.$WebWorker17()||j.$WebWorker18();};j.$WebWorker14=function(event,p,q){'use strict';if(!c('WebWorkerConfig').logging.enabled)return;c('BanzaiLogger').log(c('WebWorkerConfig').logging.config,babelHelpers['extends']({},q,{features_array:j.$WebWorker16(),event:event,resource:p}));};var k=c('memoize')(function(){var p,q;if(!i||!i.createObjectURL)return false;try{p=i.createObjectURL(c('BlobFactory').getBlob([''],{type:'application/javascript'}));var r=new b.Worker(p);r.terminate();q=true;}catch(s){q=false;}finally{if(i.revokeObjectURL)i.revokeObjectURL(p);}return q;}),l=c('memoize')(function(){var p;try{var q=new b.Worker('data:application/javascript,');q.terminate();p=true;}catch(r){p=false;}return p;}),m=!!b.Worker,n=c('memoize')(function(){var p;try{var q=new b.Worker(j.evalWorkerURL);q.terminate();p=true;}catch(r){p=false;}return p;}),o=c('memoize')(function(){var p;try{var q=new b.Worker(j.evalWorkerURL),r=new ArrayBuffer(0);q.postMessage({buffer:r},[r]);q.terminate();p=true;}catch(s){p=false;}return p;});j.states=['constructed','preparing','executing','terminated'];j.evalWorkerURL=c('WebWorkerConfig').evalWorkerURL;f.exports=j;}),null);
__d('PooledWebWorker',['WebWorker'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('WebWorker'));i=h&&h.prototype;function j(k,l,m){'use strict';i.constructor.call(this,m);this.$PooledWebWorker1=l;this.$PooledWebWorker2=k;}j.prototype.getIndex=function(){'use strict';return this.$PooledWebWorker1;};j.prototype.getPool=function(){'use strict';return this.$PooledWebWorker2;};f.exports=j;}),null);
__d('WebWorkerPool',['PooledWebWorker','emptyFunction'],(function a(b,c,d,e,f,g){h.isSupported=function(){'use strict';return c('PooledWebWorker').isSupported();};function h(i,j){'use strict';this.$WebWorkerPool1=[];for(var k=0;k<j;k++)this.$WebWorkerPool1.push(new (c('PooledWebWorker'))(this,k,i).setErrorHandler(this.$WebWorkerPool2).setMessageHandler(this.$WebWorkerPool3).execute());this.$WebWorkerPool4=0;}h.prototype.setMessageHandler=function(i){'use strict';this.$WebWorkerPool5=i||c('emptyFunction');return this;};h.prototype.setAllowCrossPageTransition=function(i){'use strict';this.$WebWorkerPool1.forEach(function(j){return j.setAllowCrossPageTransition(i);});return this;};h.prototype.setErrorHandler=function(i){'use strict';this.$WebWorkerPool6=i||c('emptyFunction');return this;};h.prototype.postMessage=function(){'use strict';var i=this.getWorker();for(var j=arguments.length,k=Array(j),l=0;l<j;l++)k[l]=arguments[l];i.postMessage.apply(i,k);return i;};h.prototype.$WebWorkerPool3=function(){'use strict';for(var i=arguments.length,j=Array(i),k=0;k<i;k++)j[k]=arguments[k];j.unshift(this);this.getPool().$WebWorkerPool5.apply(this.getPool(),j);};h.prototype.$WebWorkerPool2=function(){'use strict';for(var i=arguments.length,j=Array(i),k=0;k<i;k++)j[k]=arguments[k];j.unshift(this);return this.getPool().$WebWorkerPool6.apply(this.getPool(),j);};h.prototype.getWorker=function(){'use strict';var i=this.$WebWorkerPool1[this.$WebWorkerPool4];this.$WebWorkerPool4=(this.$WebWorkerPool4+1)%this.$WebWorkerPool1.length;return i;};f.exports=h;}),null);
__d('JpegResizer',['Emscripten','JpegResizerConfig','JpegResizeWorkerResource','PUWErrorCodes','WebWorker','WebWorkerPool'],(function a(b,c,d,e,f,g){var h=null;i.isSupported=function(){'use strict';return c('WebWorkerPool').isSupported()&&c('Emscripten').isSupported()&&!c('JpegResizerConfig').isGKBlacklisted;};i.getSingleton=function(j){'use strict';if(!h)h=new i(j||i.DEFAULT_POOL_SIZE).setAllowCrossPageTransition(true);return h;};i.prepareResource=function(j){'use strict';c('WebWorker').prepareResource(c('JpegResizeWorkerResource'),j);};function i(j){'use strict';j=j||i.DEFAULT_POOL_SIZE;c('WebWorker').prepareResource(c('JpegResizeWorkerResource'));this.$JpegResizer1=new (c('WebWorkerPool'))(c('JpegResizeWorkerResource'),j).setErrorHandler(this.$JpegResizer2.bind(this)).setMessageHandler(this.$JpegResizer3.bind(this));this.$JpegResizer4={};this.$JpegResizer5=i.DEFAULT_RESIZE_HEIGHT;this.$JpegResizer6=i.DEFAULT_RESIZE_WIDTH;}i.prototype.setHighQuality=function(j){'use strict';if(j){this.$JpegResizer5=i.DEFAULT_RESIZE_HEIGHT;this.$JpegResizer6=i.DEFAULT_RESIZE_WIDTH;}else{this.$JpegResizer5=i.LOW_QUALITY_RESIZE_HEIGHT;this.$JpegResizer6=i.LOW_QUALITY_RESIZE_WIDTH;}return this;};i.prototype.setAllowCrossPageTransition=function(j){'use strict';this.$JpegResizer1.setAllowCrossPageTransition(j);return this;};i.prototype.resizeBlob=function(j,k,l){'use strict';return this.$JpegResizer7(j,this.$JpegResizer6,this.$JpegResizer5,k,l);};i.prototype.resize360Blob=function(j,k,l,m){'use strict';var n=this.$JpegResizer6*3,o=this.$JpegResizer5*3;if(m){n=m;o=m;}return this.$JpegResizer7(j,n,o,k,l);};i.prototype.$JpegResizer7=function(j,k,l,m,n){'use strict';var o=this.$JpegResizer1.getWorker();if(o.isCurrentState('terminated')){var p=new Error('Worker terminated');p.code=c('PUWErrorCodes').WORKER_TERMINATED;m(p);return this;}var q=o.postMessage({blob:j,height:l,width:k}).getIndex();this.$JpegResizer8(q).unshift({done:m,progress:n});return this;};i.prototype.$JpegResizer8=function(j){'use strict';if(!Object.prototype.hasOwnProperty.call(this.$JpegResizer4,j))this.$JpegResizer4[j]=[];return this.$JpegResizer4[j];};i.prototype.$JpegResizer2=function(j,k){'use strict';j.terminate();var l=this.$JpegResizer8(j.getIndex());this.$JpegResizer9(k);l.forEach(function(m){return m.done(k);});l.length=0;};i.prototype.$JpegResizer3=function(j,k){'use strict';if(k.error)this.$JpegResizer9(k.error);if(k.done){this.$JpegResizer8(j.getIndex()).pop().done(k.error,k.blob,k.skipped);}else{var l=this.$JpegResizer8(j.getIndex()),m=l[l.length-1].progress;if(m)m({written:k.written,total:k.total});}};i.prototype.$JpegResizer9=function(j){'use strict';var k=j.message;if(k&&k.indexOf('Not a JPEG file')!==-1){j.code=c('PUWErrorCodes').BAD_JPEG;}else if(k&&k.indexOf('abort()')!==-1){j.code=c('PUWErrorCodes').WORKER_ABORT;}else j.code=c('PUWErrorCodes').UNKNOWN_RESIZE_ERROR;};i.DEFAULT_POOL_SIZE=3;i.DEFAULT_RESIZE_HEIGHT=2048;i.DEFAULT_RESIZE_WIDTH=2048;i.LOW_QUALITY_RESIZE_HEIGHT=960;i.LOW_QUALITY_RESIZE_WIDTH=960;f.exports=i;}),null);
__d('PhotosMimeType',[],(function a(b,c,d,e,f,g){var h={isImage:function j(k){return i(k)[0]==='image';},isJpeg:function j(k){var l=i(k);return h.isImage(k)&&(l[1]==='jpeg'||l[1]==='pjpeg');}};function i(j){return j.split('/');}f.exports=h;}),null);
__d("PhotosUploadID",[],(function a(b,c,d,e,f,g){var h=1024,i={getNewID:function j(){return (h++).toString();}};f.exports=i;}),null);
__d('DataViewPolyfill',[],(function a(b,c,d,e,f,g){'use strict';function h(i,j,k){if(j===undefined){this.$DataViewPolyfill1=new Uint8Array(i);}else if(k===undefined){this.$DataViewPolyfill1=new Uint8Array(i,j);}else this.$DataViewPolyfill1=new Uint8Array(i,j,k);this.byteLength=this.$DataViewPolyfill1.byteLength;}h.prototype.getUint8=function(i){if(i>=this.$DataViewPolyfill1.length)throw new Error('Trying to read beyond bounds of DataViewPolyfill');return this.$DataViewPolyfill1[i];};h.prototype.getUint16=function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1);return j?l*256+k:k*256+l;};h.prototype.getUint32=function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1),m=this.getUint8(i+2),n=this.getUint8(i+3);return j?((n*256+m)*256+l)*256+k:((k*256+l)*256+m)*256+n;};h.isSupported=function(){return !!b.Uint8Array;};f.exports=h;}),null);
__d('getImageSize',['DataViewPolyfill'],(function a(b,c,d,e,f,g){var h=b.DataView||c('DataViewPolyfill');function i(m){return {width:m.getUint16(6,true),height:m.getUint16(8,true)};}function j(m){return {width:m.getUint32(16,false),height:m.getUint32(20,false)};}function k(m){var n=m.byteLength,o=2;while(o<n){var p=m.getUint16(o,false);o+=2;if(p==65472||p==65474){return {width:m.getUint16(o+5,false),height:m.getUint16(o+3,false)};}else o+=m.getUint16(o,false);}return null;}function l(m){var n=new h(m);if(n.getUint8(0)==255&&n.getUint8(1)==216)return k(n);if(n.getUint8(0)==71&&n.getUint8(1)==73&&n.getUint8(2)==70)return i(n);if(n.getUint8(0)==137&&n.getUint8(1)==80&&n.getUint8(2)==78&&n.getUint8(3)==71)return j(n);return null;}f.exports=l;l.gif=i;l.png=j;l.jpeg=k;}),null);
__d('ChatAutoSendPhotoUploader',['csx','fbt','invariant','ArbiterMixin','AsyncUploadRequest','AsyncRequest','AudioMimeTypes','DOM','Event','FileForm','FileFormResetOnSubmit','FileInput','FormSubmitOnChange','JpegResizer','MercuryAttachmentType','MercuryConstants','PhotosMimeType','PhotosUploadID','Run','SubscriptionsHandler','URI','arrayContains','getImageSize','getObjectValues','isEmpty','mixin'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;function m(){return 'upload_'+c('PhotosUploadID').getNewID();}function n(p){return Array.prototype.reduce.call(p,function(q,r){var s=m();q[s]=r;return q;},{});}k=babelHelpers.inherits(o,c('mixin')(c('ArbiterMixin')));l=k&&k.prototype;function o(p,q,r,s){l.constructor.call(this);this.$ChatAutoSendPhotoUploader1=r;this.$ChatAutoSendPhotoUploader2=q;this.$ChatAutoSendPhotoUploader3=s;this.$ChatAutoSendPhotoUploader4=new (c('SubscriptionsHandler'))();this.$ChatAutoSendPhotoUploader5={};this.$ChatAutoSendPhotoUploader6={};this.$ChatAutoSendPhotoUploader7=false;this.$ChatAutoSendPhotoUploader8=p.getAttribute('action');this.$ChatAutoSendPhotoUploader9=new (c('FileForm'))(p,[c('FormSubmitOnChange'),c('FileFormResetOnSubmit')]);this.$ChatAutoSendPhotoUploader9.setAllowCrossOrigin(true);this.$ChatAutoSendPhotoUploader9.setUploadInParallel(true);if(s)this.$ChatAutoSendPhotoUploader9.setCustomHttpHeader('X-MSGR-Region',s);var t=c('DOM').find(p,"._4q60"),u=c('DOM').find(t,"._4q61");this.$ChatAutoSendPhotoUploader10=new (c('FileInput'))(t,u,q);this.$ChatAutoSendPhotoUploader4.addSubscriptions(c('Run').onBeforeUnload(this.onBeforeUnload.bind(this)),this.$ChatAutoSendPhotoUploader9.subscribe('submit',this.$ChatAutoSendPhotoUploader11.bind(this)),this.$ChatAutoSendPhotoUploader9.subscribe('success',this.$ChatAutoSendPhotoUploader12.bind(this)),this.$ChatAutoSendPhotoUploader9.subscribe('failure',this.$ChatAutoSendPhotoUploader13.bind(this)),this.$ChatAutoSendPhotoUploader9.subscribe('progress',this.$ChatAutoSendPhotoUploader14.bind(this)),c('Event').listen(u,'click',function(){if(this.$ChatAutoSendPhotoUploader15===undefined)this.$ChatAutoSendPhotoUploader16();if(this.$ChatAutoSendPhotoUploader15)if(c('JpegResizer').prepareResource)c('JpegResizer').prepareResource();this.inform('open');}.bind(this)));}o.prototype.$ChatAutoSendPhotoUploader16=function(){this.$ChatAutoSendPhotoUploader15=c('JpegResizer').isSupported();if(this.$ChatAutoSendPhotoUploader15)this.$ChatAutoSendPhotoUploader9.setPreprocessHandler(this.$ChatAutoSendPhotoUploader17.bind(this));};o.prototype.onBeforeUnload=function(){if(this.isUploading()&&!this.$ChatAutoSendPhotoUploader7)return i._("You haven't sent your message yet. Do you want to leave without sending?");};o.prototype.isUploading=function(){return !c('isEmpty')(this.$ChatAutoSendPhotoUploader5);};o.prototype.destroy=function(){this.$ChatAutoSendPhotoUploader4.release();this.$ChatAutoSendPhotoUploader9.destroy();this.$ChatAutoSendPhotoUploader5={};this.$ChatAutoSendPhotoUploader6={};};o.prototype.$ChatAutoSendPhotoUploader18=function(p,q){var r=this.$ChatAutoSendPhotoUploader19(p);if(q){r.preview_width=q.width;r.preview_height=q.height;}return r;};o.prototype.$ChatAutoSendPhotoUploader19=function(p){var q={upload_id:p,on_progress:function(r){this.$ChatAutoSendPhotoUploader4.addSubscriptions(this.subscribe('progress',r));}.bind(this),on_resizing_progress:function(r){this.$ChatAutoSendPhotoUploader4.addSubscriptions(this.subscribe('resize_progress',r));}.bind(this),on_success:function(r){this.$ChatAutoSendPhotoUploader4.addSubscriptions(this.subscribe('success',r));}.bind(this),upload_canceled:this.$ChatAutoSendPhotoUploader20.bind(this),attach_type:c('MercuryAttachmentType').PHOTO,preview_uploading:true};return q;};o.prototype.$ChatAutoSendPhotoUploader17=function(p,q){var r=p.getFile();if(!c('PhotosMimeType').isJpeg(r.type))return q(p);c('JpegResizer').getSingleton().resizeBlob(r,function(s,t,u){if(t)p.setFile(t);q(p);},this.$ChatAutoSendPhotoUploader21.bind(this,p));};o.prototype.$ChatAutoSendPhotoUploader11=function(){this.uploadFiles(this.$ChatAutoSendPhotoUploader2.files);return false;};o.prototype.$ChatAutoSendPhotoUploader22=function(p){if(!p)return false;var q=0;for(var r=0;r<p.length;r++){var s=p[r];q+=s.size;if(q>c('MercuryConstants').AttachmentMaxSize){this.inform('file-upload-error',{error:'size-exceeded'});return false;}if(s.type==='application/x-msdownload'||s.type==='application/x-msdownload-x64'){this.inform('file-upload-error',{error:'wrong-type'});return false;}}return true;};o.prototype.$ChatAutoSendPhotoUploader23=function(p,q){var r,s=this,t,u=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];if(typeof FileReader!=='undefined'&&FileReader.prototype.readAsArrayBuffer&&q&&q.length===1){(function(){s.$ChatAutoSendPhotoUploader5[p]=p;u[p]=q[0];var v=new FileReader();v.onload=function(){this.inform('submit',{upload_id:p,preview_attachments:[this.$ChatAutoSendPhotoUploader18(p,c('getImageSize')(v.result))]});}.bind(s);v.onerror=function(){this.inform('submit',{upload_id:p,preview_attachments:[this.$ChatAutoSendPhotoUploader19(p)]});}.bind(s);if(q[0].size){v.readAsArrayBuffer(q[0]);}else{var w=babelHelpers['extends']({},s.$ChatAutoSendPhotoUploader18(p,q[0].source),{preview_url:q[0].preview_url});s.inform('submit',{upload_id:p,preview_attachments:[w]});}})();}else (function(){var v=[];if(!q){s.$ChatAutoSendPhotoUploader5[p]=p;s.$ChatAutoSendPhotoUploader1.value=p;v.push(s.$ChatAutoSendPhotoUploader19(p));}else{var w=Object.keys(u);if(w.length>0){w.forEach(function(z){this.$ChatAutoSendPhotoUploader5[z]=p;v.push(this.$ChatAutoSendPhotoUploader19(z));}.bind(s));}else for(var x=0;x<q.length;++x){var y=m();u[y]=q[x];s.$ChatAutoSendPhotoUploader5[y]=p;v.push(s.$ChatAutoSendPhotoUploader19(y));}}s.inform('submit',{upload_id:p,preview_attachments:v});})();if(Object.keys(u).length>0)this.$ChatAutoSendPhotoUploader9.setFiles(u);};o.prototype.$ChatAutoSendPhotoUploader12=function(event,p){var q=this.$ChatAutoSendPhotoUploader24(p);if(this.$ChatAutoSendPhotoUploader5[q]){var r=this.$ChatAutoSendPhotoUploader5[q];delete this.$ChatAutoSendPhotoUploader5[q];var s=p.response.getPayload();if(!this.$ChatAutoSendPhotoUploader6[r])this.$ChatAutoSendPhotoUploader6[r]=[];this.$ChatAutoSendPhotoUploader6[r].push({id:q,audio_id:s.metadata[0].audio_id,image_id:s.metadata[0].image_id,file_id:s.metadata[0].file_id,gif_id:s.metadata[0].gif_id,video_id:s.metadata[0].video_id});this.inform('success',{upload_id:q});if(!this.$ChatAutoSendPhotoUploader25(r))this.$ChatAutoSendPhotoUploader26(r);this.$ChatAutoSendPhotoUploader10.clear();this.$ChatAutoSendPhotoUploader2=this.$ChatAutoSendPhotoUploader10.getInput();}};o.prototype.$ChatAutoSendPhotoUploader26=function(p){!this.$ChatAutoSendPhotoUploader25(p)||j(0);this.$ChatAutoSendPhotoUploader6[p].sort(function(q,r){return q.id<r.id?-1:1;});this.inform('all-uploads-completed',{upload_id:p,audio_ids:this.$ChatAutoSendPhotoUploader6[p].map(function(q){return q.audio_id;}),image_ids:this.$ChatAutoSendPhotoUploader6[p].map(function(q){return q.image_id;}),file_ids:this.$ChatAutoSendPhotoUploader6[p].map(function(q){return q.file_id;}),gif_ids:this.$ChatAutoSendPhotoUploader6[p].map(function(q){return q.gif_id;}),video_ids:this.$ChatAutoSendPhotoUploader6[p].map(function(q){return q.video_id;})});delete this.$ChatAutoSendPhotoUploader6[p];};o.prototype.$ChatAutoSendPhotoUploader14=function(event,p){this.inform('progress',{upload_id:p.upload.getName(),event:p.event});};o.prototype.$ChatAutoSendPhotoUploader21=function(p,event){this.inform('resize_progress',{upload_id:p.getName(),event:event});};o.prototype.$ChatAutoSendPhotoUploader25=function(p){return c('arrayContains')(c('getObjectValues')(this.$ChatAutoSendPhotoUploader5),p);};o.prototype.$ChatAutoSendPhotoUploader13=function(event,p){var q=this.$ChatAutoSendPhotoUploader24(p);this.$ChatAutoSendPhotoUploader27(q,'last-upload-failed',p.additionalParams);this.$ChatAutoSendPhotoUploader10.clear();this.$ChatAutoSendPhotoUploader2=this.$ChatAutoSendPhotoUploader10.getInput();return false;};o.prototype.$ChatAutoSendPhotoUploader20=function(p){this.$ChatAutoSendPhotoUploader27(p,'last-upload-canceled');};o.prototype.$ChatAutoSendPhotoUploader27=function(p,q,r){if(!this.$ChatAutoSendPhotoUploader5[p])return;var s=this.$ChatAutoSendPhotoUploader5[p];delete this.$ChatAutoSendPhotoUploader5[p];if(!this.$ChatAutoSendPhotoUploader25(s))if(this.$ChatAutoSendPhotoUploader6[s]){this.$ChatAutoSendPhotoUploader26(s);}else this.inform(q,babelHelpers['extends']({upload_id:s},r));};o.prototype.$ChatAutoSendPhotoUploader24=function(p){if(p.upload){return p.upload.getName();}else return p.response&&p.response.getPayload().uploadID||p.getName();};o.prototype.uploadFiles=function(p){if(!this.$ChatAutoSendPhotoUploader22(p))return;var q=m(),r=void 0;if(p.length===1){var s;r=(s={},s[q]=p[0],s);}else r=n(p);var t=new (c('AsyncUploadRequest'))(this.$ChatAutoSendPhotoUploader8).setAllowCrossOrigin(true).setAllowCrossPageTransition(this.$ChatAutoSendPhotoUploader7).setRelativeTo(this.$ChatAutoSendPhotoUploader9.getRoot()).setFiles(r);if(this.$ChatAutoSendPhotoUploader3)t.setCustomHttpHeader('X-MSGR-Region',this.$ChatAutoSendPhotoUploader3);var u=Array.prototype.some.call(p,function(v){return c('AudioMimeTypes').isAudio(v.type);});if(u)t.setData({voice_clip:true});this.$ChatAutoSendPhotoUploader4.addSubscriptions(t.subscribe('success',function(event,v){this.$ChatAutoSendPhotoUploader12(event,{upload:v,response:v.getResponse()});}.bind(this)),t.subscribe('failure',this.$ChatAutoSendPhotoUploader13.bind(this)));t.send();this.$ChatAutoSendPhotoUploader23(q,p,r);};o.prototype.uploadURL=function(p){var q=m(),r=p.errorDialogParams;delete p.errorDialogParams;var s=new (c('AsyncRequest'))().setURI(new (c('URI'))(this.$ChatAutoSendPhotoUploader8).getPath()).setAllowCrossPageTransition(this.$ChatAutoSendPhotoUploader7).setData(babelHelpers['extends']({},p,{attach_id:q})).setErrorHandler(function(t){this.$ChatAutoSendPhotoUploader13(null,{additionalParams:{errorDialogParams:r},response:{getPayload:function u(){return {uploadID:q};}}});}.bind(this)).setHandler(function(t){this.$ChatAutoSendPhotoUploader12(null,{response:t});}.bind(this));s.send();this.$ChatAutoSendPhotoUploader23(q,[p]);};o.prototype.setAllowCrossPage=function(p){this.$ChatAutoSendPhotoUploader7=p;this.$ChatAutoSendPhotoUploader9.setAllowCrossPageTransition(p);};f.exports=o;}),null);